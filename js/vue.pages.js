window.$app.defineComponent("pages","vue-pages-blocks-form-addons",{props:{disabled:{type:Boolean,default:!1},values:Object,variants_block:{type:Object,default:[]},variants_addons:{type:Object,default:[]},block_id:Number,block_type_id:Number,loading:{type:Boolean,default:!1},addons:{type:Object,default:null},addonsLoadingEndpoint:{type:String,default:"pages/blocks/addons"},addons_values:Object,parent:Object,addon_target_need:{type:Array,default:[]}},watch:{values:{handler:function(){this.checkFields()},deep:!0}},created:function(){var s=this;this.addonsLoadingEndpoint&&null==this.addons&&(this.loading=!0,this.$api.get(this.addonsLoadingEndpoint,{block_id:this.block_id,block_type_id:this.block_type_id}).then(function(e){var t;"success"==e.result&&(t=e.response.pages.block,s.addons=t.addons,_.each(t.addons_fields,function(e,t){s.values.fields_extended.push({title:t,fields:e})}),s.variants_addons=null!=t.variants.addons?t.variants.addons:{},_.each(t.addons_values,function(e,t){s.$set(s.addons_values,t,e)}),s.checkFields(),t.addons.phrases&&window.i18n.extend(t.addons.phrases)),s.loading=!1}).catch(function(){s.loading=!1}))},methods:{chooseAddon:function(){this.checkFields()},checkFields:function(){var t,s,a=this;null!=this.values.fields&&(t=_.map(this.values.fields,function(e){return e.idx}),_.each(this.values.fields_extended,function(e){_.each(e.fields,function(e){return t.push(e.idx)})}),_.each(this.addons_values,function(e){if(null!=e.options&&null!=e.options.fields)for(i=0;i<e.options.fields.length;i++)-1==t.indexOf(e.options.fields[i].idx)&&(e.options.fields[i].idx=null)})),-1!=[3,6,2,15,10].indexOf(this.block_type_id)&&(_.each(this.addons_values,function(e,t){e.on&&null!=a.addons.addons[t]&&_.intersection(["link","banner","socialnetworks","messenger","form"],a.addons.addons[t].target).length&&(null==e.options&&(e.options={}),null==e.options.slots&&(e.options.slots={}))}),3!=this.block_type_id&&6!=this.block_type_id||(_.each(this.addons_values,function(e,t){null==e.options&&a.$set(e,"options",{}),null!=e.options.slots&&_.size(e.options.slots)||a.$set(e.options,"slots",{})}),s={},_.each(this.variants_block.list,function(e){_.each(e.items,function(e,t){return s[t]=e})}),this.$set(this.variants_block,"slots",{}),_.each(this.values.items,function(e){a.$set(a.variants_block.slots,e.n,s[e.n].title)})),-1!=[2,15,10].indexOf(this.block_type_id)&&this.$set(this.variants_block,"slots",{link:""}))},loadEntry:function(e){return e="vue-addons-catalog-"+e+"-entry",window.$app.loadComponent(e),e},getVariants:function(e){return null!=this.variants_addons[e]?this.variants_addons[e]:{}}},template:'<section class="modal-card-body-blocks"> <section class="message is-warning" v-if="addons && addons.addons_amount"> <div class="message-body"><slot name="message"></slot></div> </section> <section> <div v-if="addons && addons.addons_amount"> <div class="label-pro-container"> <div v-for="(f, addon_id) in addons.addons" v-if="f.addon_id != undefined && (!f.target || (_.intersect(f.target, addon_target_need).length))" class="form-fields-item" :class="{in: (addons_values[addon_id] != undefined) && addons_values[addon_id].on, disabled: f.is_active == 0 || disabled}"> <div class="form-fields-item-title"> <span style="margin-left: 0"> <b-checkbox v-model="addons_values[addon_id].on" :disabled="f.is_active == 0 || disabled" @input="chooseAddon(addon_id)"><b>{{f.addon_title}}</b></b-checkbox> </span> </div> <div class="form-fields-item-options" v-if="f.is_has_options && (addons_values[addon_id] != undefined) && addons_values[addon_id].on && f.is_active != 0"> <component v-bind:is="loadEntry(f.addon_name)" :values="values" :addons="addons" :addon="f" :variants="getVariants(f.addon_name)" :variants_block="variants_block" :options.sync="addons_values[addon_id].options"></component> </div> </div> </div> </div> <div v-else class="has-pt-4 has-pb-4 has-text-centered" :class="{disabled: disabled}"> <div class="has-mb-2"><i class="fa fal fa-cog fa-5x has-text-grey-light" :class="{\'is-invisible\': loading}"></i></div> <div v-if="loading" class="has-text-grey">{{\'Загрузка данных\'|gettext}}</div> <div v-else><slot name="empty"></slot></div> <router-link v-if="!loading" :to="{name: \'addons.index\'}" @click.native="parent.close()">{{\'Посмотреть доступные модули\'|gettext}}</router-link> </div> <b-loading :is-full-page="false" :active.sync="loading"></b-loading> </section> </section>'}),window.$app.defineComponent("pages","vue-pages-blocks-form-animations",{data:function(){return{has_animation:!1,last_animation:"blink"}},props:["values","info","variants"],created:function(){this.has_animation=""!=this.values.animation,this.has_animation&&(this.last_animation=this.values.animation)},watch:{has_animation:function(e){!this.values.animation&&e&&(this.values.animation=this.last_animation),e||(this.last_animation=this.values.animation,this.values.animation="")}},template:'<div> <div class="has-mb-2"> <mx-toggle v-model="has_animation" :title="\'Анимация\'|gettext" :disabled="info.is_readonly"></mx-toggle> </div> <div class="buttons-chooser-list is-animation has-mb-2 row row-small" v-if="has_animation"> <div v-for="(v, id) in variants.animations" class="col-xs-6 col-sm-4 col-md-4"> <div class="buttons-chooser" :class="[{in: values.animation == id, \'has-animation\': values.animation == id}, (values.animation == id)?(\'has-animation-\'+id):\'\']" @click="values.animation = id">{{v}}</div> </div> </div> </div>'}),window.$app.defineComponent("pages","vue-pages-blocks-form-design-link",{props:["values","info"],created:function(){var e=this.$account.theme;this.values.text||(this.values.text=e.link.color),this.values.subtitle||(this.values.subtitle=e.link.subtitle.color),this.values.bg||(this.values.bg=e.link.bg)},template:'<div class="label-pro-container"> <div class="tag is-pro" v-if="!$auth.isAllowTariff(\'pro\')" v-tippy :content="\'Эта возможность доступна<br>на pro тарифе\'|gettext">pro</div> <div :class="{disabled: !$auth.isAllowTariff(\'pro\')}"> <div class="has-mb-2"><mx-toggle v-model=\'values.on\' :title="\'Свои настройки дизайна\'|gettext" :disabled="info.is_readonly"></mx-toggle></div> <div v-if="values.on"> <div class="has-mb-2"> <vue-component-colorpicker v-model="values.bg" :label="\'Цвет фона ссылки\'|gettext" :disabled="info.is_readonly" :colors="[$account.theme.link.bg]"></vue-component-colorpicker> </div> <div class="has-mb-2"> <vue-component-colorpicker v-model="values.text" :label="\'Цвет заголовка ссылки\'|gettext" :disabled="info.is_readonly" :colors="[$account.theme.link.color]"></vue-component-colorpicker> </div> <div class="has-mb-2"> <vue-component-colorpicker v-model="values.subtitle" :label="\'Цвет подзаголовка ссылки\'|gettext" :disabled="info.is_readonly" :colors="[$account.theme.link.subtitle.color]"></vue-component-colorpicker> </div> <slot></slot> </div> </div> </div>'}),window.$app.defineComponent("pages","vue-pages-blocks-form-design",{props:["values","info"],created:function(){var e=this.$account.theme;this.values.text||(this.values.text=e.link.color),this.values.bg||(this.values.bg=e.link.bg)},template:'<div class="label-pro-container"> <div class="tag is-pro" v-if="!$auth.isAllowTariff(\'pro\')" v-tippy :content="\'Эта возможность доступна<br>на pro тарифе\'|gettext">pro</div> <div :class="{disabled: !$auth.isAllowTariff(\'pro\')}"> <div class="has-mb-2"><mx-toggle v-model=\'values.on\' :title="\'Свои настройки дизайна\'|gettext" :disabled="info.is_readonly"></mx-toggle></div> <div v-if="values.on"> <div class="has-mb-2"> <vue-component-colorpicker v-model="values.bg" :label="\'Цвет фона кнопки\'|gettext" :disabled="info.is_readonly" :colors="[$account.theme.link.bg]"></vue-component-colorpicker> </div> <div class="has-mb-2"> <vue-component-colorpicker v-model="values.text" :label="\'Цвет текста кнопки\'|gettext" :disabled="info.is_readonly" :colors="[$account.theme.link.color]"></vue-component-colorpicker> </div> <slot></slot> </div> </div> </div>'}),window.$app.defineComponent("pages","vue-pages-blocks-form-modal",{data:function(){return{isUpdating:!1,isDeleting:!1,isFetching:!1,isFetchingBlockType:null,canDelete:!1,tabs:[],defaultsTabs:[],currentTab:"common",currentBlock:null,tariff:null,modify:{values:!1,options:!1,section:!1,addons:!1},baseValues:{},baseOptions:{},baseSection:{},baseAddonsValues:{},values:{},options:{},variants:{},section:{on:!1},block:{title:null},permit:{},archives:[],archivesLoaded:!1,info:{},types:[],typesKeys:[],isAnimatedTariff:!1,allowSave:!0,block_type_id:null,block_type_name:null,addon_target_additional:null,addons_values:{}}},created:function(){var t=this;this.block_id?(this.$events.fire("statistic:event",{name:"block_edit"}),this.fetchData(!0)):(this.$events.fire("statistic:event",{name:"block_add"}),this.defaultsTabs=this.tabs=[{name:"common",title:this.$gettext("Стандартные блоки")},{name:"archives",title:this.$gettext("Из архива")}],this.types=this.$account.blocks,this.typesKeys=[],_.each(this.types,function(e){t.typesKeys[e.block_type_id]=e}))},watch:{currentTab:function(e){for(var t=this,s=0,s=0;s<this.tabs.length&&this.tabs[s].name!=e;s++);var i=this.$refs.menu.children[s];scrollIt(i.offsetLeft-(this.$refs.menu.offsetWidth-i.offsetWidth)/2,"x",this.$refs.menu,300),"archives"!=e||this.archivesLoaded||(this.isFetching=!0,this.$api.get("pages/blocks/archives").then(function(e){t.archives=e.response.pages.blocks.archives,t.isFetching=!1,t.archivesLoaded=!0}))},values:{handler:function(e){this.modify.values=0<_.size(_.differenceWith(this.baseValues,e))},deep:!0},options:{handler:function(e){this.modify.options=0<_.size(_.differenceWith(this.baseOptions,e))},deep:!0},section:{handler:function(e){this.modify.section=0<_.size(_.differenceWith(this.baseSection,e))},deep:!0},addons_values:{handler:function(e){_.size(e)&&!_.size(this.baseAddonsValues)?this.baseAddonsValues=this.$clone(e):this.modify.addons_values=0<_.size(_.differenceWith(this.baseAddonsValues,e))},deep:!0}},computed:{isChoosingForm:function(){return!this.block_type_id&&!this.block_id&&this.$device.mobile},isModify:function(){return _.sum(_.map(this.modify,function(e){return e?1:0}))},isAllowTariff:function(){return this.$auth.isAllowTariff(this.tariff)}},props:["block_id","page_id","before_block_id","before_section_id"],mixins:[FormModel],methods:{setTabs:function(e){var t={options:{name:"options",title:this.$gettext("Настройки")},addons:{name:"addons",title:this.$gettext("Модули")},section:{name:"section",title:this.$gettext("Секция")},statistics:this.block_id&&this.info.is_allow_statistics?{name:"statistics",title:this.$gettext("Статистика")}:null};this.tabs=_.filter(_.map(e,function(e){return"string"==typeof e?t[e]:e}))},fetchData:function(e){var s=this;this.isFetching=e,this.$api.get("pages/blocks/get",{page_id:this.page_id,block_id:this.block_id}).then(function(e){s.isFetching=!1;var t=e.response.pages.block;s.permit=t.permit,s.values=t.values,s.section=t.section,s.options=t.options,s.variants=t.variants,s.tariff=t.tariff,s.info=t.info,s.page_id=t.page_id,s.block_type_id=t.block_type_id,s.block_type_name=t.block_type_name,s.addon_target_additional=null,s.$nextTick(function(){s.baseValues=s.$clone(s.values),s.baseOptions=s.$clone(s.options),s.baseSection=s.$clone(s.section)}),s.$auth.isAllowTariff(t.tariff)||(s.info.is_readonly=!0,s.canDelete=!0),s.currentBlock="vue-pages-blocks-"+t.block_type_name})},close:function(){this.isModify?this.$confirm(this.$gettext("У вас есть несохраненные изменения. Вы действительно хотите выйти?"),"is-danger",{yes:this.$gettext("Выйти без сохранения"),no:this.$gettext("Вернуться назад")}).then(this.$parent.close):this.$parent.close()},action:function(e,t){return this.$api.get("pages/blocks/action",{block_id:this.block_id,name:e,params:t},this)},chooseType:function(e){var s=this;this.isFetchingBlockType=e.block_type_id,this.$api.get("pages/blocks/info",{block_type_id:e.block_type_id}).then(function(e){s.isFetchingBlockType=null;var t=e.response.pages.block;s.variants=t.variants,s.values=t.defaults.values,s.section={id:null},s.options=t.defaults.options,s.block_type_id=t.block_type_id,s.block_type_name=t.block_type_name,s.addon_target_additional=null,s.info=t.info,s.tariff=t.tariff,s.$nextTick(function(){s.baseValues=s.$clone(s.values),s.baseOptions=s.$clone(s.options),s.baseSection=s.$clone(s.section)}),s.$auth.isAllowTariff(t.tariff)||(s.info.is_readonly=!0),s.currentBlock="vue-pages-blocks-"+t.block_type_name})},back:function(){this.currentBlock=null,this.currentTab="common",this.block_type_id=null,this.tariff=null,this.tabs=this.defaultsTabs,this.info=[],this.values=[],this.addons_values={},this.variants={}},restoreBlock:function(t,e){var s=this;this.isUpdating=!0,this.$api.get("pages/blocks/restore",{block_id:t,page_id:this.page_id,before_block_id:this.before_block_id,before_section_id:this.before_section_id,weight:this.$page.getWeight([e])},this).then(function(e){s.isUpdating=!1,"success"==e.result&&(s.$parent.close(),s.$events.fire("statistic:event",{name:"block_add_done"}),s.$parent.$parent.scrollToBlock(t))}).catch(function(){s.isUpdating=!1})},onAction:function(e){switch(e){case"delete":this.deleteBlock("delete");break;case"archive":this.deleteBlock("archive");break;case"clone":this.cloneBlock()}},cloneBlock:function(){var t=this;this.isUpdating=!0,this.$api.get("pages/blocks/clone",{block_id:this.block_id,page_id:this.page_id,weight:this.$page.getWeight([this.block_type_id])},this.$refs.model).then(function(e){t.isUpdating=!1,"success"==e.result&&(t.$events.fire("statistic:event",{name:"page_edit"}),t.$parent.close())})},deleteBlock:function(t){var s=this;this.$confirm("delete"==t?this.$gettext("Вы уверены что хотите удалить этот блок?"):this.$gettext("Вы уверены что хотите отправить этот блок в архив?"),"delete"==t?"is-danger":"is-warning","delete"==t?{yes:this.$gettext("Удалить")}:{}).then(function(){s.isDeleting=!0;var e=s.$page.data.mustchange.indexOf(s.block_id);s.$api.get("pages/blocks/"+t,{block_id:s.block_id,page_id:s.page_id,is_mustchange:-1!=e,weight:s.$page.getWeight(void 0,[s.block_type_id])},s.$refs.model).then(function(e){s.isDeleting=!1,"success"==e.result&&(s.$events.fire("statistic:event",{name:"block_delete"}),s.$events.fire("statistic:event",{name:"page_edit"}),s.$parent.close())}).catch(function(){s.isDeleting=!1})})},save:function(){var e,t,s=this,i=this.$refs.model.prepareValues();null!=i&&(this.isUpdating=!0,e=this.$refs.section.prepareValues(),t=this.$page.data.mustchange.indexOf(this.block_id),this.$api.post("pages/blocks/set",{block_id:this.block_id,is_mustchange:-1!=t,page_id:this.page_id,before_block_id:this.before_block_id,before_section_id:this.before_section_id,block_type_id:this.block_type_id,values:i,options:this.options,addons_values:this.addons_values,section:e,weight:this.$page.getWeight(this.block_id?void 0:[this.block_type_id])},this.$refs.model).then(function(e){s.isUpdating=!1,"success"==e.result?(s.isModify&&(s.$events.fire("statistic:event",{name:s.block_id?"block_edit_done":"block_add_done"}),s.$events.fire("statistic:event",{name:"page_edit"})),s.$parent.close(),!s.block_id&&e.response.block_id&&s.$parent.$parent.scrollToBlock(e.response.block_id)):null!=s.$refs.model.showErrors&&s.$refs.model.showErrors(e)}).catch(function(){s.isUpdating=!1}))},scrollToTariff:function(){var e,t=this;this.isAllowTariff||(e=this.$refs.tariffMessage,scrollIt(0,"y",$mx(e).closest(".modal")[0],400),this.isAnimatedTariff=!0,setTimeout(function(){t.isAnimatedTariff=!1},1e3))}},template:'<div class="modal-card is-choosing-form" :class="[{\'modal-view\': isChoosingForm}, \'is-block-\'+block_type_name]"> <header class="modal-card-head"> <p class="modal-card-title" v-if="block.title">{{block.title}}</p> <p class="modal-card-title" v-else-if="isFetching">{{\'Загрузка\'|gettext}}</p> <p class="modal-card-title" v-else>{{\'Новый блок\'|gettext}}</p> <button class="modal-close" :class="{\'is-small\': isChoosingForm, \'is-large\': !isChoosingForm}" @click="close"></button> </header> <ul class="nav nav-tabs nav-tabs-scroll has-text-left" v-if="tabs.length> 1" ref="menu"> <li v-for="(tab, index) in tabs" :class="{active: currentTab== tab.name}"><a @click="currentTab = tab.name">{{tab.title|gettext}}</a></li> </ul> <section class="message is-danger" style="flex-shrink: 0;flex-grow: 0" v-if="!isAllowTariff"> <div class="message-body" :class="{\'shake animated\': isAnimatedTariff}" ref="tariffMessage"><span v-if="tariff == \'pro\' || tariff== \'plus\'">{{\'Доступно на pro-тарифе\'|gettext}}</span><span v-if="tariff == \'business\'">{{\'Доступно на business-тарифе\'|gettext}}</span> <a @click="$form.open(\'vue-index-pricing-form\')" class=\'is-pulled-right\'>{{\'Подробнее\'|gettext}} <i class="fa fa-angle-right" style="margin-left: 5px"></i></a></div> </section> <component v-bind:is="currentBlock" ref=\'model\' :values="values" :options="options" :section.sync="section" :variants="variants" :info="info" :block_id="block_id" :block_type_id="block_type_id" :addon_target_additional.sync="addon_target_additional" :block="block" :current-tab="currentTab" :tabs="tabs" @update:tabs="setTabs($event)" v-if="currentBlock" :parent="$parent" :allowSave.sync="allowSave"> <template> <vue-pages-blocks-form-section v-model="section" ref="section" :disabled="info.is_readonly" :class="{\'is-hidden\': currentTab != \'section\'}"/> <keep-alive> <vue-pages-blocks-form-addons v-if="currentTab == \'addons\'" :block_id="block_id" :block_type_id="block_type_id" :addon_target_need="_.filter([block_type_name, addon_target_additional])" :values="values" :variants_block="variants" :addons_values.sync="addons_values" :disabled="info.is_readonly" :parent="parent" @click="$parent.scrollToTariff"> <template slot="message">{{\'Вы можете выбрать модули которые будут срабатывать для данного блока\'|gettext}}</template> <template slot="empty">{{\'Модули для данного блока еще не подключены\'|gettext}}</template> </vue-pages-blocks-form-addons> </keep-alive> <keep-alive> <vue-pages-blocks-form-statistics v-if="currentTab == \'statistics\'" :page_id="values.page_id" :block_id="block_id"/> </keep-alive> </template> </component> <section class="modal-card-body" v-if="!currentBlock && currentTab== \'common\'"> <div class="row row-small" style="margin-bottom: -1rem"> <div class="col-sm-4 col-xs-6 has-mb-2" v-for="f in types" v-if="f.page_types == null || f.page_types.indexOf($page.data.page.page_type) != -1"><button @click="chooseType(f)" class="button is-block-button is-default btn-block" :class="{\'is-loading\': isFetchingBlockType && isFetchingBlockType== f.block_type_id}" :disabled="isFetching || isFetchingBlockType"> <div v-if="!$auth.isAllowTariff(f.tariff) && (f.tariff == \'pro\' || f.tariff == \'plus\')" class="tag is-pro" v-tippy :content="\'Этот блок доступен<br>на pro-тарифе\'|gettext">pro</div> <div v-if="!$auth.isAllowTariff(f.tariff) && (f.tariff == \'business\')" class="tag is-danger is-business" v-tippy :content="\'Этот блок доступен<br>на business-тарифе\'|gettext">biz</div> <div v-html="f.icon"></div> <div>{{f.block_type_title|gettext}}</div> </button></div> </div> </section> <section class="modal-card-body" v-if="!currentBlock && currentTab== \'archives\'"> <div v-if="!archives.length" class="has-text-centered has-text-grey"> <i class="fal fa-archive has-text-grey-light has-mt-2 has-mb-2 fa-4x"></i> <div>{{\'Пока ничего нет\'|gettext}}</div> </div> <button class="button btn-block is-fullwidth has-p-2" :class="{\'has-mt-2\': i}" style="justify-content: space-between" v-for="(f, i) in archives" @click="restoreBlock(f.block_id, f.block_type_id)"> <span class="has-mr-1" style="display: flex;align-items: center;overflow:hidden"> <span v-html="typesKeys[f.block_type_id].icon" class="is-block-button is-archive"></span> {{typesKeys[f.block_type_id].block_type_title|gettext}}<span class="has-ml-1" style="white-space: nowrap;overflow: hidden;text-overflow: ellipsis;opacity:.4" v-if="f.title">— {{f.title}}</span></span> <span class="has-text-grey">{{f.tms_archived|date}}</span> </button> </section> <footer class="modal-card-foot level" v-if="currentBlock"> <div class="level-left"> <vue-component-action-button @action="onAction" :title="\'Действие\'|gettext" v-if="block_id && (!info.is_readonly || canDelete)"> <template slot="actions"> <b-dropdown-item value="clone"><i class="fa fa-clone"></i> {{\'Дублировать\'|gettext}}</b-dropdown-item> <hr class="dropdown-divider" aria-role="menuitem"> <b-dropdown-item value="archive" v-if="info.permit.can_archive"><i class="fa fa-archive"></i> {{\'В архив\'|gettext}}</b-dropdown-item> <hr class="dropdown-divider" aria-role="menuitem" v-if="info.permit.can_archive"> <b-dropdown-item value="delete" class="has-text-danger" :class="{disabled: !info.permit.can_delete}"><i class="fa fa-trash-alt"></i> {{\'Удалить\'|gettext}}</b-dropdown-item> </template> </vue-component-action-button> <button v-else class="button is-dark is-hidden-tablet" type="button" @click="close">{{\'Отмена\'|gettext}}</button> </div> <div class="level-right"> <button class="button is-primary" :class="{\'is-loading\': isUpdating}" @click="save" :disabled="info.is_readonly || !allowSave">{{\'Сохранить\'|gettext}}</button> </div> </footer> <footer class="modal-card-foot" v-if="!currentBlock" :class="{\'is-hidden-mobile\': isChoosingForm}"> <button class="button is-dark" type="button" @click="$parent.close()">{{\'Закрыть\'|gettext}}</button> </footer> <b-loading :is-full-page="false" :active.sync="isFetching"></b-loading> </div>'}),window.$app.defineComponent("pages","vue-pages-blocks-form-options",{data:function(){return{schedule_days:[],date_from:null,date_until:null,time_from:null,time_until:null,allowPro:!1,first_day_week:this.$getFirstDayWeek(),weekdays:this.$getDaysNames()}},props:["values","info","variants","options"],computed:{weekdays_schedule:function(){var e=[];this.first_day_week||e.push({index:6,weekday:this.weekdays[0]});for(var t=1;t<7;t++)e.push({index:t-1,weekday:this.weekdays[t]});return this.first_day_week&&e.push({index:6,weekday:this.weekdays[0]}),e},daysSummary:function(){var e=this.schedule_days;return 7==e.length?this.$gettext("Каждый день"):5==e.length&&-1==e.indexOf(5)&&-1==e.indexOf(6)?this.$gettext("Будние дни"):2==e.length&&-1!=e.indexOf(5)&&-1!=e.indexOf(6)?this.$gettext("Выходные дни"):""}},watch:{time_from:function(){this.onInputDates()},time_until:function(){this.onInputDates()}},created:function(){function e(e){return e=e.split("-"),new Date(e[0],e[1]-1,e[2])}var t,s;this.allowPro=this.$auth.isAllowTariff("pro"),this.date_from=this.values.schedule.date.v.date.from?e(this.values.schedule.date.v.date.from):null,this.date_until=this.values.schedule.date.v.date.until?e(this.values.schedule.date.v.date.until):null,this.values.schedule.date.v.time.from&&(t=this.values.schedule.date.v.time.from.split(":"),this.time_from=new Date(0,0,0,t[0],t[1])),this.values.schedule.date.v.time.until&&(s=this.values.schedule.date.v.time.until.split(":"),this.time_until=new Date(0,0,0,s[0],s[1]));for(var i=0;i<7;i++)this.values.schedule.days.v&Math.pow(2,i)&&this.schedule_days.push(i)},methods:{onInputDates:function(){this.values.schedule.date.v.date.from=this.date_from?date_format("Y-m-d",this.date_from):null,this.values.schedule.date.v.date.until=this.date_until?date_format("Y-m-d",this.date_until):null,this.values.schedule.date.v.time.from=this.time_from?date_format("H:i",this.time_from):null,this.values.schedule.date.v.time.until=this.time_until?date_format("H:i",this.time_until):null,this.values.schedule.days.v=_.reduce(this.schedule_days,function(e,t){return e+Math.pow(2,t)},0)}},template:'<div> <div class="has-mb-2"> <mx-toggle v-model="options.is_visible" :title="\'Скрыть блок\'|gettext" :disabled="info.is_readonly" :invert="true"></mx-toggle> </div> <div class="label-pro-container"> <div v-if="!allowPro" class="tag is-pro" v-tippy :content="\'Эта возможность доступна<br>на pro тарифе\'|gettext">pro</div> <div :class="{disabled: !options.is_visible}"> <div class="has-mb-2"> <mx-toggle v-model="values.schedule.date.on" :title="\'Показывать по расписанию\'|gettext" :disabled="info.is_readonly || !allowPro"></mx-toggle> </div> <div class="has-mb-2" v-if="values.schedule.date.on"> <div class="row row-small has-mb-1"> <label class="label col-xs-2 col-sm-1"><p class="form-control-static">{{\'От\'|gettext}}:</p></label> <div class="col-xs-7 col-sm-8"> <vue-component-datepicker v-model="date_from" icon="calendar-alt" @input="onInputDates" :disabled="!values.schedule.date.on || info.is_readonly"></vue-component-datepicker> </div> <div class="col-xs-3"> <div class="has-feedback"> <b-clockpicker icon="clock" v-model="time_from" :disabled="!values.schedule.date.on || info.is_readonly" hour-format="24"></b-clockpicker> <a class="form-control-feedback has-text-grey-light" @click="time_from = null" :class="{disabled: info.is_readonly}" v-if="time_from"><i class="fal fa-times"></i></a> </div> </div> </div> <div class="row row-small"> <label class="label col-xs-2 col-sm-1"><p class="form-control-static">{{\'До\'|gettext}}:</p></label> <div class="col-xs-7 col-sm-8"> <vue-component-datepicker v-model="date_until" @input="onInputDates" :disabled="!values.schedule.date.on || info.is_readonly"></vue-component-datepicker> </div> <div class="col-xs-3"> <div class="has-feedback"> <b-clockpicker icon="clock" v-model="time_until" :disabled="!values.schedule.date.on || info.is_readonly" hour-format="24"></b-clockpicker> <a class="form-control-feedback has-text-grey-light" @click="time_until = null" :class="{disabled: info.is_readonly}" v-if="time_until"><i class="fal fa-times"></i></a> </div> </div> </div> </div> <div> <mx-toggle v-model="values.schedule.days.on" :title="\'Показывать по дням недели\'|gettext" :disabled="info.is_readonly || !allowPro"></mx-toggle> </div> <div class="has-mt-2 form-horizontal" v-if="values.schedule.days.on"> <div class="row row-small"> <label class="label col-xs-2 col-sm-1 is-hidden-mobile"><p class="form-control-static">{{\'Дни\'|gettext}}:</p></label> <div class="col-xs-12 col-sm is-flex schedule-days-chooser"> <b-field :class="[\'is-marginless\', {disabled: !values.schedule.days.on}]"> <b-checkbox-button v-for="w in weekdays_schedule" v-model="schedule_days" :native-value="w.index" type="is-dark" @input="onInputDates" class="choose-days">{{w.weekday|gettext}}</b-checkbox-button> </b-field> <p class="form-control-static has-text-grey has-sm-ml-1">{{daysSummary}}</p> </div> </div> </div> </div> </div> </div>'}),window.$app.defineComponent("pages","vue-pages-blocks-form-section",{props:{value:Object,disabled:Boolean},data:function(){return{base:null,types:{p:"Primary section",s:"Secondary section"},vertical_aligns:{top:this.$gettext("Сверху"),middle:this.$gettext("По центру"),bottom:this.$gettext("Снизу")}}},watch:{value:{handler:function(e){this.$emit("input",e)},deep:!0}},created:function(){this.checkValue(this.value)},computed:{disabledIndent:function(){return this.disallowElements||"adaptive"==this.value.bg.size&&this.value.bg.picture},disallow:function(){return this.disabled},disallowElements:function(){return this.disallow||!this.value.id}},methods:{checkHeight:function(){this.value.height.value=Math.max(this.value.height.value,30)},checkValue:function(e){e.id||1!=_.size(e)?e.id&&(null==this.$account.theme.sections||null==this.$account.theme.sections[e.id]?(this.base=this.getDefault(),this.value=_.clone(_.merge(this.base,e,{id:"new"},!0))):(this.base=_.merge(this.getDefault(),this.$account.theme.sections[e.id],!0),null!=this.base.bg.picture&&null!=this.base.bg.picture.picture_id&&this.base.bg.picture.picture_id&&delete this.base.bg.picture.picture_id,this.value=_.clone(_.merge(this.base,e,!0))),this.$emit("input",this.value)):(this.base=this.getDefault(),this.value=Object.assign(this.$clone(e),this.base),this.value.id=null,this.$emit("input",this.value))},sectionPreviewStyles:function(e){var t=this.$account.theme;return{"--data-color1":e&&e.bg&&e.bg.color1?e.bg.color1:t.bg.color1,"--data-color2":e&&e.link&&e.link.bg?e.link.bg:e&&e.screen&&e.screen.color?e.screen.color:t.link.bg}},changeSection:function(e){switch(e){case null:case"new":this.base=this.getDefault(),this.value=_.clone(this.base);break;default:this.base=_.merge(this.getDefault(),this.$account.theme.sections[e],!0),null!=this.base.bg.picture&&null!=this.base.bg.picture.picture_id&&this.base.bg.picture.picture_id&&delete this.base.bg.picture.picture_id,this.value=_.clone(this.base)}this.value.id=e,this.$emit("input",this.value)},getDefault:function(){return StylesFactory.getDefaultSection(this.$account.theme)},prepareValues:function(){var e=this.$clone(this.value);if(null==e.id)return{id:null};var t=e.id;if(delete e.id,e.bg.picture&&e.bg.picture.picture_id&&(e.bg.picture=e.bg.picture.picture_id),_.isEqual(e,this.getDefault()))return{id:null};if("new"==t){var s=_.differenceWith(e,this.getDefault());return s.id=t,s}var i=_.merge(this.getDefault(),this.$account.theme.sections[t],!0);if(_.isEqual(e,i))return{id:t};var a=_.differenceWith(e,i);return a.id=t,a},properyChanged:function(e,t,s,i){var a=3<arguments.length&&void 0!==i&&i;return this.disabled||!this.value.id?null:StylesFactory.properyChanged(e,t,s,a,this)}},template:'<section class="modal-card-body-blocks"> <section class="message is-warning"> <div class="message-body" style="display:flex;justify-content: space-between;padding-right: 22px;"> {{\'Секции позволяют визуально объединять несколько блоков вместе\'|gettext}} <vue-component-help-button icon="simple" :target="{name: \'video\', params: {guide_id: 23}}"/> </div> </section> <section> <vue-component-dropdown position="is-bottom-right is-fullwidth" v-model="value.id" @input="changeSection" :disabled="disallow" :title="\'Секция\'|gettext" button-class="button is-default is-fullwidth is-focusable"> <span slot="button" style="display: flex"><i class="section-preview" :style="sectionPreviewStyles(value)" v-if="value.id"></i><span v-if="value.id == \'new\'">{{\'Новая секция\'|gettext}}</span><span v-else-if="value.id"><span v-if="types[value.id]">{{types[value.id]}}</span><span v-else>{{\'Секция\'|gettext}} {{value.id}}</span></span><span v-else class="has-text-grey">-- {{\'Секция выключена\'|gettext}} --</span></span> <b-dropdown-item aria-role="listitem" :value="null" class="has-text-grey">-- {{\'Секция выключена\'|gettext}} --</b-dropdown-item> <b-dropdown-item aria-role="listitem" value="new" style="display: flex"><i class="section-preview" :style="sectionPreviewStyles(null)"></i>{{\'Новая секция\'|gettext}}</b-dropdown-item> <b-dropdown-item custom aria-role="menuitem" class="has-text-grey has-text-nowrap" v-if="$account.theme.section && _.size($account.theme.sections)> 1">{{\'Дизайн\'|gettext}}</b-dropdown-item> <b-dropdown-item aria-role="listitem" v-for="(s, i) in $account.theme.sections" v-if="i != \'_\'" :value="i" style="display: flex"><i class="section-preview" :style="sectionPreviewStyles(s)"></i><span v-if="types[i]">{{types[i]}}</span><span v-else>{{\'Секция\'|gettext}} {{i}}</span></b-dropdown-item> </vue-component-dropdown> </section> <section class="design-panel"> <h3 class="has-text-grey has-mb-3 has-text-centered-mobile">{{\'Общие\'|gettext}}</h3> <div class="link-styles-container has-mb-2"> <label class="form-control-static" :class="{disabled: disabled || !value.id}"><span :class="properyChanged(base.padding, value.padding, \'padding.top\')" @click="properyChanged(base.padding, value.padding, \'padding.top\', true)">{{\'Отступ сверху\'|gettext}}</span></label> <div style="width:120px"> <div class="row row-small"> <div class="col-xs col-shrink" style="display: flex;align-items: center"> <b style="width:25px"> <b v-if="value.padding.top">{{value.padding.top}}x</b> <b v-else>{{\'Нет\'|gettext}}</b> </b> </div> <div class="col-xs"> <b-slider :min="0" :max="4" :tooltip="false" v-model="value.padding.top" size="is-line" rounded :disabled="disallowElements"> <template v-for="(s, i) in [0, 1, 2, 3, 4, 5]"> <b-slider-tick :value="i" :key="i"></b-slider-tick> </template> </b-slider> </div> </div> </div> </div> <div class="link-styles-container has-mb-2"> <label class="form-control-static" :class="{disabled: disallowElements}"><span :class="properyChanged(base.padding, value.padding, \'padding.bottom\')" @click="properyChanged(base.padding, value.padding, \'padding.bottom\', true)">{{\'Отступ снизу\'|gettext}}</span></label> <div style="width:120px"> <div class="row row-small"> <div class="col-xs col-shrink" style="display: flex;align-items: center"> <b style="width:25px"> <b v-if="value.padding.bottom">{{value.padding.bottom}}x</b> <b v-else>{{\'Нет\'|gettext}}</b> </b> </div> <div class="col-xs"> <b-slider :min="0" :max="4" :tooltip="false" v-model="value.padding.bottom" size="is-line" rounded :disabled="disallowElements"> <template v-for="(s, i) in [0, 1, 2, 3, 4, 5]"> <b-slider-tick :value="i" :key="i"></b-slider-tick> </template> </b-slider> </div> </div> </div> </div> <div class="has-mb-2 link-styles-container"> <label class="form-control-static" :class="{disabled: disabledIndent}"><span :class="properyChanged(base.indent, value.indent, \'indent\')" @click="properyChanged(base.indent, value.indent, \'indent\', true)">{{\'Отступ от края\'|gettext}}</span></label> <mx-toggle v-model="value.indent.on" :space-between="true" :disabled="disabledIndent"></mx-toggle> </div> <div class="has-mb-2 link-styles-container" v-if="value.indent.on"> <label class="form-control-static"><span :class="properyChanged(base.indent, value.indent, \'indent.radius\')" @click="properyChanged(base.indent, value.indent, \'indent.radius\', true)">{{\'Скругление секции\'|gettext}}</span></label> <vue-component-design-radius-chooser v-model="value.indent.radius"></vue-component-design-radius-chooser> </div> </section> <section class="design-panel"> <h3 class="has-text-grey has-mb-3 has-text-centered-mobile">{{\'Фон\'|gettext}}</h3> <vue-component-background-editor v-model="value.bg" :base="base.bg" :disabled="disallowElements" :sizes="value.indent.on?[\'width\', \'tile\']:[\'adaptive\', \'width\', \'tile\']" :withOpacityBackground="true"/> </section> <section class="design-panel"> <h3 class="has-text-grey has-mb-3 has-text-centered-mobile">{{\'Текст\'|gettext}}</h3> <div class="has-mb-2 with-label color-picker-container"> <label class="form-control-static" :class="{disabled: disallowElements}"><span :class="properyChanged(base.heading, value.heading, \'heading\')" @click="properyChanged(base.heading, value.heading, \'heading\', true)">{{\'Заголовок\'|gettext}}</span></label> <div class="component-group"> <vue-component-font-weight-chooser v-model="value.heading.weight" :with-arrow="false" :disabled="disallowElements"/> <vue-component-text-transform-chooser v-model="value.heading.transform" :with-arrow="false" :disabled="disallowElements"/> <vue-component-font-chooser v-model="value.heading.font" view="name" :disabled="disallowElements"/> <vue-component-colorpicker v-model="value.heading.color" design="circle" :withArrow="false" :disabled="disallowElements" position-horizontal="left"/> </div> </div> <div class="with-label color-picker-container"> <label class="form-control-static" :class="{disabled: disallowElements}"><span :class="properyChanged(base.text, value.text, \'text\')" @click="properyChanged(base.text, value.text, \'text\', true)">{{\'Текст\'|gettext}}</span></label> <div class="component-group"> <vue-component-font-chooser v-model="value.text.font" view="name" :disabled="disallowElements"/> <vue-component-colorpicker v-model="value.text.color" design="circle" :withArrow="false" :disabled="disallowElements" position-horizontal="left"/> </div> </div> </section> <section class="design-panel"> <h3 class="has-text-grey has-mb-3 has-text-centered-mobile">{{\'Ссылки\'|gettext}}</h3> <div class="link-styles-container has-mb-2"> <label class="form-control-static" :class="{disabled: disallowElements}"><span :class="properyChanged(base.link, value.link, \'link\')" @click="properyChanged(base.link, value.link, \'link\', true)">{{\'Цвет заголовка ссылки\'|gettext}}</span></label> <vue-component-colorpicker v-model="value.link.color" :disabled="disallowElements" position-horizontal="left" position-vertical="top"/> </div> <div class="link-styles-container has-mb-2"> <label class="form-control-static" :class="{disabled: disallowElements}"><span :class="properyChanged(base.link.subtitle, value.link.subtitle, \'link.subtitle\')" @click="properyChanged(base.link.subtitle, value.link.subtitle, \'link.subtitle\', true)">{{\'Цвет подзаголовка ссылки\'|gettext}}</span></label> <vue-component-colorpicker v-model="value.link.subtitle.color" :disabled="disallowElements" position-horizontal="left" position-vertical="top"/> </div> <div class="link-styles-container has-mb-2"> <label class="form-control-static" :class="{disabled: disallowElements}"><span :class="properyChanged(base.link, value.link, \'link.bg\')" @click="properyChanged(base.link, value.link, \'link.bg\', true)">{{\'Цвет фона ссылки\'|gettext}}</span></label> <vue-component-colorpicker v-model="value.link.bg" :disabled="disallowElements" position-horizontal="left" position-vertical="top"/> </div> <div class="link-styles-container has-mb-2"> <label class="form-control-static" :class="{disabled: disallowElements}"><span :class="properyChanged(base.link, value.link, \'link.transparent\')" @click="properyChanged(base.link, value.link, \'link.transparent\', true)">{{\'Прозрачность ссылки\'|gettext}}</span></label> <vue-component-design-transparent-cooser v-model="value.link.transparent" :disabled="disallowElements"/> </div> <transition name="fade"> <div class="has-mb-2 link-styles-container" v-if="value.link.transparent"> <label class="form-control-static" :class="{disabled: disallowElements}"><span :class="properyChanged(base.link.border, value.link.border, \'link.border\')" @click="properyChanged(base.link.border, value.link.border, \'link.border\', true)">{{\'Толщина границы\'|gettext}}</span></label> <input type="number" v-model.number="value.link.border.width" max="10" min="0" class="input" style="width: 100px" :disabled="disallowElements"> </div> </transition> <div class="link-styles-container"> <label class="form-control-static" :class="{disabled: disabled || !value.id}"><span :class="properyChanged(base.link.shadow, value.link.shadow, \'link.shadow\')" @click="properyChanged(base.link.shadow, value.link.shadow, \'link.shadow\', true)">{{\'Тень ссылки\'|gettext}}</span></label> <vue-component-design-shadow-chooser v-model="value.link.shadow" :disabled="disabled || !value.id" position-horizontal="left" position-vertical="top"/> </div> </section> </section>'}),window.$app.defineComponent("pages","vue-pages-blocks-form-statistics",{data:function(){return{period_title:"",clicks:[],chart:[],isFetching:!1}},props:{page_id:Number,block_id:Number,period:{type:String,default:"day"},period_back:{type:Number,default:0},disabled:{type:Boolean,default:!1}},watch:{period:function(){this.fetchData(["chart","clicks"]),this.period_back=0},period_back:function(){this.fetchData(["clicks"])}},created:function(){this.fetchData(["chart","clicks"])},methods:{fetchData:function(t){var s=this;this.isFetching=!0,this.$api.get("statistics/get",{page_id:this.page_id,block_id:this.block_id,period:this.period,period_back:this.period_back,scope:t}).then(function(e){-1!=t.indexOf("chart")&&(s.chart=_.map(e.response.statistics.chart,function(e,t){return{date:t,hits:e}})),s.clicks=e.response.statistics.clicks,s.period_title=e.response.statistics.period.title,s.isFetching=!1})}},template:'<section> <b-field class="has-tabs-style" :class="{disabled: disabled}"> <b-radio-button v-model="period" type="active" class="is-expanded" native-value="day">{{\'День\'|gettext}}</b-radio-button> <b-radio-button v-model="period" type="active" class="is-expanded" native-value="week">{{\'Неделя\'|gettext}}</b-radio-button> <b-radio-button v-model="period" type="active" class="is-expanded" native-value="month">{{\'Месяц\'|gettext}}</b-radio-button> </b-field> <vue-component-statistics :data="chart" :period="period" :period_back="period_back" :line-show="true" :padding-top="30" class="has-mb-3 is-small" :disabled="disabled"></vue-component-statistics> <div class="field has-addons" :class="{disabled: disabled}"> <p class="control"><button class="button" @click="period_back++"><i class="fas fa-caret-left"></i></button></p> <p class="control is-expanded"><span class="button is-static has-background-white is-fullwidth">{{ period_title }}</span></p> <p class="control"><button class="button" :disabled="period_back == 0" @click="period_back--"><i class="fas fa-caret-right"></i></button></p> </div> <b-table :data="clicks" :loading="isFetching" :disabled="disabled" v-if="clicks.length"> <template slot-scope="props"> <b-table-column field="title" :label="\'Заголовок\'|gettext"> {{ props.row.type }} </b-table-column> <b-table-column field="clics" :label="\'Клики\'|gettext" :class=\'{"has-text-grey-light": props.row.clicks == 0}\' numeric>{{ props.row.clicks | number }}</b-table-column> </template> <template slot="empty"> <section class="has-mb-4 has-mt-4 content has-text-grey has-text-centered" v-if="!isFetching"> <p>{{\'Недостаточно данных\'|gettext}}</p> </section> <section class="has-mb-4 has-mt-4 content has-text-grey has-text-centered" v-if="isFetching"> <p>{{\'Загрузка данных\'|gettext}}</p> </section> </template> </b-table> </section>'}),window.$app.defineComponent("pages","vue-pages-blocks-avatar",{data:function(){return{isUpdating:!1,isUploading:!1,instagramUpdated:!1,maxFilesize:this.$account.limits.upload_max_filesize,file:null}},props:["values","variants","block","block_id","info","tabs","currentTab"],mixins:[FormModel],created:function(){this.block.title=this.$gettext("Аватар"),this.$emit("update:tabs",[{name:"common",title:this.block.title},"section"])},computed:{maxSizeBytes:function(){if(this.maxFilesize){var e=this.maxFilesize.match(/([0-9]+)([MK])/);return e[1]*("M"==e[2]?1048576:1024)}return this.maxFilesize}},methods:{dropFilesChanged:function(){var s=this;if(/\.(jpe?g|png|gif|svg)$/i.test(this.file.name)){if(this.maxSizeBytes&&this.file.size>this.maxSizeBytes)return this.$alert(this.$gettext("Максимальный размер файла: %s").replace("%s",this.maxFilesize),"is-danger");this.$modal("vue-component-picture-cropper",{file:this.file,cropperOptions:{aspectRatio:1,autoCropArea:1,viewMode:1,zoomable:!1},doneHandler:function(e){var t=new FormData;t.append("file",e),t.append("picture_id",s.$account.profile_id),s.isUploading=!0,s.$http.request({url:"/pictures/upload?target=avatar",method:"post",data:t}).then(function(e){"success"==e.result||"error"==e.result&&s.$alert(e.error,"is-danger"),s.isUploading=!1,s.file=null}).catch(function(){s.isUploading=!1,s.$alert(s.$gettext("Во время загрузки картинки возникла ошибка"))})},cancelHandler:function(){s.file=null}},this)}else this.isUploading=!1,this.$alert(this.$gettext("Недопустимый формат файла"))},updateAvatar:function(){var t=this;this.isUpdating=!0,this.instagramUpdated=!0,this.$parent.action("update").then(function(e){t.isUpdating=!1})},prepareValues:function(){return this.values}},template:'<section class="modal-card-body modal-card-body-blocks"> <section v-if="currentTab == \'common\'"> <div class="media" style="align-items: center"> <img :src="\'//{1}{2}\'|format($account.storage_domain, $account.avatar.url)" class="is-pulled-left has-mr-3" :class="$account.avatar.size|sprintf(\'profile-avatar profile-avatar-%s\')"> <div class="media-content"> <div> <b-upload v-model="file" @input="dropFilesChanged()" accept=\'image/jpeg,image/png,image/gif,image/svg,image/svg+xml\'> <a class="button is-fullwidth-mobile is-success" :class="{\'is-loading\': isUploading}"><span><i class="fa fas fa-arrow-from-top fa-rotate-180 has-mr-2" :disabled="info.is_readonly"></i>{{\'Загрузить картинку\'|gettext}}</span></a> </b-upload> </div> </div> </div> </section> <section v-if="currentTab == \'common\'" :class="{disabled: info.is_readonly}"> <label class="label">{{\'Размер аватара\'|gettext}}</label> <div class="tabs is-toggle is-fullwidth is-avatar-size-chooser has-mb-1"> <ul> <li :class="{\'is-active\': values.avatar_size == k}" v-for="(v, k) in variants.avatar_size"><a @click="values.avatar_size = parseInt(k)"><em></em></a></li> </ul> </div> <p class="has-text-grey">{{variants.avatar_size[values.avatar_size]}}</p> </section> <section v-if="currentTab == \'common\' && info.has_connected_account"> <mx-toggle v-model="values.is_avatar_hide_text" :title="\'Скрыть имя профиля под аватаром\'|gettext" :disabled="info.is_readonly"></mx-toggle> </section> <slot></slot> </section>'}),window.$app.defineComponent("pages","vue-pages-blocks-banner",{props:["values","options","info","variants","block","block_id","block_type_id","tabs","currentTab","allowSave"],mixins:[FormModel],data:function(){return{addons_values:null}},created:function(){this.block.title=this.$gettext("Баннер"),this.$emit("update:tabs",[{name:"common",title:this.$gettext("Картинка")},"options","statistics","section","addons"])},computed:{pictureSizeStyle:function(){return"padding-top: "+(this.values.p?this.values.p.height/this.values.p.width*100:50)+"%;"},styleOuterContainer:function(){return this.values.is_scale&&this.values.width?"width: "+this.values.width+"px !important;":""}},methods:{prepareValues:function(){var e=this.$clone(this.values);return e.p&&(e.p=e.p.picture_id),e},startUploading:function(){this.allowSave=!1},stopUploading:function(){this.allowSave=!0}},template:'<section class="modal-card-body modal-card-body-blocks"> <section v-if="info.is_readonly && (currentTab == \'common\')" class="message is-warning"> <div class="message-body">{{\'Добавьте изображение любого размера и укажите действие при клике\'|gettext}}</div> </section> <section v-if="currentTab == \'common\'" @click="$parent.scrollToTariff" style="padding: 1rem 0"> <div class="device-pictures-form" style="padding-left: 1rem;padding-right: 1rem"> <center> <div class="device has-shadow is-large is-hide-mobile" :class="{disabled: info.is_readonly}"> <div class="notch"></div> <div class="screen page-font"> <div class="has-sm-p-1"> <vue-component-pictures v-model="values.p" class="pictures-form-banner" :class="{\'has-stretch\': values.is_stretch, \'has-marginless\': values.is_stretch && values.is_marginless}" class-container="picture-container picture-container-upload" :button-title="\'Загрузить картинку\'|gettext" :style-container="pictureSizeStyle" :style-outer-container="styleOuterContainer" button-icon="fa fal fa-cloud-upload" @startUploading="startUploading" @stopUploading="stopUploading" updatable/> </div> </div> </div> </center> <div class=\'form-shadow form-shadow-bottom is-hidden-mobile\' style="height: 20px"></div> </div> </section> <section v-if="currentTab == \'common\'" @click="$parent.scrollToTariff"> <mx-toggle v-model="values.is_scale" :title="\'Установить максимальную ширину\'|gettext" :disabled="info.is_readonly || !values.p || values.is_stretch" class="has-mb-2"></mx-toggle> <div class="row row-small has-mb-2" v-if="values.is_scale && values.p"> <div class="col-xs-12 col-sm-4"> <b-field> <p class="control is-expanded"><number v-model="values.width" precision="0" :disabled="info.is_readonly" class="input has-text-right" :placeholder="values.p?values.p.width:\'\'"/></p> <p class="control"> <a class="button is-static">px</a> </p> </b-field> </div> </div> <mx-toggle v-model="values.is_stretch" :title="\'Растянуть на ширину страницы\'|gettext" :disabled="info.is_readonly || values.is_scale"></mx-toggle> <transition name="fade"> <mx-toggle v-model="values.is_marginless" :title="\'Убрать отступы от края страницы\'|gettext" :disabled="info.is_readonly || values.is_scale || !values.is_stretch" v-if="values.is_stretch" class="has-mt-2"></mx-toggle> </transition> </section> <section v-if="currentTab == \'common\'" @click="$parent.scrollToTariff"> <mx-toggle v-model="values.is_link" :title="\'Сделать баннер ссылкой\'|gettext" :disabled="info.is_readonly"></mx-toggle> <div v-if="values.is_link"> <vue-component-link-editor :values.sync="values.link" :variants="variants" :info="info" class="has-mt-2"></vue-component-link-editor> </div> </section> <section v-if="currentTab == \'options\'" @click="$parent.scrollToTariff"> <div class="has-mb-2"> <mx-toggle v-model="values.open_new_window" :title="\'Открывать в новом окне\'|gettext" :disabled="info.is_readonly || !values.is_link || (values.link.type != \'link\')"></mx-toggle> </div> <vue-pages-blocks-form-options :values.sync="values" :options.sync="options" :info="info"/> </section> <slot></slot> </section>'}),window.$app.defineComponent("pages","vue-pages-blocks-break",{props:["values","options","variants","info","block","block_id","tabs","currentTab"],mixins:[FormModel],data:function(){return{types:[-1,0,1],sizes:[15,30,45,60,75,90,105,120,135,150],thumb:{t:"i",i:"icofont/star"},size_custom:!1,keyComponent:0,icons:{1:"tabler/circle",2:"tabler/square-rotated",3:"legacy/wave-triangle",4:"legacy/wave-sine",5:"legacy/chevron-double-down",6:"legacy/chevron-down",7:"tabler/star",8:"tabler/heart",9:"tabler/diamond",10:"icofont/star",11:"icofont/heart"}}},created:function(){this.block.title=this.$gettext("Разделитель");var e=this.$account.theme;this.values.design.color||(this.values.design.color=e.screen.color),this.size_custom=150<this.values.break_size||this.values.break_size%15!=0,this.icons[this.values.icon]?(this.thumb.i=this.icons[this.values.icon],this.values.icon=1):-1!=this.values.icon&&0!=this.values.icon&&(this.thumb.i=this.values.icon,this.values.icon=1),this.$emit("update:tabs",[{name:"common",title:this.block.title},"options","section"])},methods:{icon:function(e){var t=this;return e<1?null:this.$icons.get(this.thumb.i,function(){t.keyComponent++})},chooseIcon:function(e){var t=this;1==(this.values.icon=e)&&this.$modal("vue-pages-thumbnail-chooser-form",{value:this.thumb,hasTypes:!1,preferedIcons:_.values(this.icons),useObject:!0,onSave:function(e){t.thumb=e}})},setSizeCustom:function(e){e||(150<this.values.break_size?this.values.break_size=150:this.values.break_size=15*Math.floor(this.values.break_size/15)),this.size_custom=e},prepareValues:function(){var e=this.$clone(this.values),t=this.$account.theme;return 1==e.icon&&(e.icon=this.thumb.i),e.design.color==t.screen.color&&(e.design.color=""),e.design.color||(e.design={on:!1}),e}},template:'<section class="modal-card-body modal-card-body-blocks"> <section v-if="currentTab == \'common\'"> <div class="form-messengers-switch has-text-grey"> <a :class="{\'has-text-black\': !size_custom, \'has-text-grey\': size_custom}" @click="setSizeCustom(false)">{{\'Стандартный\'|gettext}}</a> <a :class="{\'has-text-black\': size_custom, \'has-text-grey\': !size_custom}" @click="setSizeCustom(true)">{{\'Ручной\'|gettext}}</a> </div> <label class="label has-mb-2">{{\'Размер отступа\'|gettext}}</label> <div class="row"> <div style="min-height: 40px" :class="size_custom?\'col-xs-12 col-sm-4\':\'col-xs-12\'"> <div v-if="size_custom" class="field has-addons"> <p class="control is-expanded"> <input type="number" v-model="values.break_size" class="input" :min="15" :max="600" @blur="values.break_size = Math.min(Math.max(values.break_size, 15), 600)"> </p> <p class="control"> <span class="button is-static">px</span> </p> </div> <div class="row" v-else> <div class="col-xs col-shrink" style="display:flex;align-items:center;min-width:70px"> <h3>{{sizes.indexOf(values.break_size)+1}}x</h3> </div> <div class="col-xs"> <b-field> <b-slider :min="15" :max="150" :step="15" :tooltip="false" v-model="values.break_size" size="is-medium" rounded> <template v-for="(s, i) in sizes"> <b-slider-tick :value="s" :key="i"></b-slider-tick> </template> </b-slider> </b-field> </div> </div> </div> </div> </section> <section v-if="currentTab == \'common\'"> <label class="label">{{\'Тип разделителя\'|gettext}}</label> <div class="buttons-chooser-list row row-small"> <div v-for="i in types" class="col-xs-4 col-sm-2 col-md-2"> <div class="buttons-chooser block-break" :data-i="i" @click="chooseIcon(i)" :class="{in: values.icon == i}"><div class="block-break-inner" :class="{\'has-icon\': i, \'is-invisible\': i < 0, \'is-fullwidth\': values.fullwidth, \'has-fading\': values.fading}"><span v-html="icon(i)" :key="keyComponent" style="--text-color: var(--text-modal-color)"></span></div></div> </div> </div> </section> <section v-if="currentTab == \'common\'"> <div :class="{disabled: values.icon < 0}"> <label class="label">{{\'Настройки линии\'|gettext}}</label> <mx-toggle v-model="values.fullwidth" class="has-mb-2" :title="\'Линия на всю ширину\'|gettext" :disabled="info.is_readonly"></mx-toggle> <mx-toggle v-model="values.fading" :title="\'Линия с полупрозрачными краями\'|gettext" :disabled="info.is_readonly"></mx-toggle> </div> </section> <section v-if="currentTab == \'options\'" @click="$parent.scrollToTariff"> <div class="label-pro-container"> <div class="tag is-pro" v-if="!$auth.isAllowTariff(\'pro\')" v-tippy :content="\'Эта возможность доступна<br>на pro тарифе\'|gettext">pro</div> <div :class="{disabled: !$auth.isAllowTariff(\'pro\')}"> <div class="has-mb-2"><mx-toggle v-model=\'values.design.on\' :title="\'Свои настройки дизайна\'|gettext" :disabled="info.is_readonly"></mx-toggle></div> <div v-if="values.design.on"> <div class="has-mb-2"> <vue-component-colorpicker v-model="values.design.color" :label="\'Цвет\'|gettext" :disabled="info.is_readonly" :colors="[$account.theme.screen.color]"></vue-component-colorpicker> </div> </div> </div> </div> <vue-pages-blocks-form-options :values.sync="values" :options.sync="options" :info="info"/> </section> <slot></slot> </section>'}),window.$app.defineComponent("pages","vue-pages-blocks-collapse",{props:["values","options","variants","info","block","block_id","tabs","currentTab"],mixins:[FormModel],data:function(){return{current:0}},created:function(){this.block.title=this.$gettext("Вопросы и ответы");var e=this.$account.theme;this.values.design.color||(this.values.design.color=e.screen.color),""!==this.values.design.font&&null!=this.values.design.font||(this.values.design.font=e.screen.font),this.$emit("update:tabs",[{name:"common",title:this.block.title},"options","section"])},methods:{prepareValues:function(){var e=this.$clone(this.values),t=this.$account.theme;return e.design.color==t.screen.color&&(e.design.color=""),e.design.font==t.screen.font&&(e.design.font=""),e.design.color||e.design.font||(e.design={on:!1}),e},onRemove:function(e){var t=this;this.$confirm(this.$gettext("Вы уверены что хотите удалить этот вопрос?"),"is-danger").then(function(){t.values.fields.splice(e,1)})},onAdd:function(){var e=this;this.values.fields.push({title:"",text:"",opened:!0}),this.current=this.values.fields.length-1,this.$nextTick(function(){e.$refs.fields.querySelector(".in input").focus()})}},template:'<section class="modal-card-body modal-card-body-blocks" :class="{\'is-rtl\': $account.locale.text_direction == \'rtl\'}"> <section v-if="currentTab == \'common\'"> <div ref="fields" v-if="values.fields.length"> <vue-component-sortable-form-fields v-model="values.fields" :current.sync="current"> <template v-slot:title="{ item }"> <span><span v-if="item.title">{{ item.title }}</span><span v-else>{{\'Заголовок\'|gettext}}</span></span> </template> <template v-slot:action="{ index }"> <a class="is-pulled-right has-text-danger" @click.stop="onRemove(index)" :class="{disabled: info.is_readonly}"><i class="fa fa-trash-alt"></i></a> </template> <template v-slot:form="{ item, index }"> <div class="field"> <label>{{\'Заголовок\'|gettext}}</label> <b-input type="text" v-model="item.title" :disabled="info.is_readonly" class="has-rtl"></b-input> </div> <div class="field"> <label>{{\'Текст\'|gettext}}</label> <vue-component-emoji-picker v-model="item.text"> <textarea class="input has-rtl" v-model="item.text" :disabled="info.is_readonly" v-emoji rows="6"></textarea> </vue-component-emoji-picker> </div> </template> </vue-component-sortable-form-fields> </div> <button type="button" @click="onAdd" class="button is-light is-fullwidth has-text-primary has-mt-2 is-form-adding has-p-3" :class="{disabled: info.is_readonly}"><i class="fas fa-plus has-mr-2"></i>{{\'Добавить новый пункт\'|gettext}}</button> </section> <section v-if="currentTab == \'options\'"> <div class="label-pro-container"> <div class="tag is-pro" v-if="!$auth.isAllowTariff(\'pro\')" v-tippy :content="\'Эта возможность доступна<br>на pro тарифе\'|gettext">pro</div> <div :class="{disabled: !$auth.isAllowTariff(\'pro\')}"> <div class="has-mb-2"><mx-toggle v-model=\'values.design.on\' :title="\'Свои настройки дизайна\'|gettext" :disabled="info.is_readonly"></mx-toggle></div> <div v-if="values.design.on"> <div class="has-mb-2"> <vue-component-colorpicker v-model="values.design.color" :label="\'Цвет текста\'|gettext" :disabled="info.is_readonly" :colors="[$account.theme.screen.color]"></vue-component-colorpicker> </div> <div class="has-mb-2 link-styles-container"> <label class="form-control-static">{{\'Шрифт\'|gettext}}</label> <vue-component-font-chooser v-model="values.design.font" view="name"></vue-component-font-chooser> </div> </div> </div> </div> <vue-pages-blocks-form-options :values.sync="values" :options.sync="options" :info="info"/> </section> <slot></slot> </section>'}),window.$app.defineComponent("pages","vue-pages-blocks-courses-feed",{props:["values","options","variants","info","block","block_id","tabs","currentTab"],mixins:[FormModel],created:function(){this.block.title=this.$gettext("Фид занятий курса"),this.$emit("update:tabs",[{name:"common",title:"Общие"},"options","section"])},methods:{prepareValues:function(){return this.values}},template:'<section class="modal-card-body modal-card-body-blocks"> <section v-if="currentTab == \'common\'" @click="$parent.scrollToTariff" class="is-html-section"> <div class="has-mb-2"> <vue-component-colorpicker v-model="values.colors.bg" :label="\'Цвет фона\'|gettext" :disabled="info.is_readonly" :colors="[\'#ffffff\']"></vue-component-colorpicker> </div> <div class="has-mb-2"> <vue-component-colorpicker v-model="values.colors.text" :label="\'Цвет текста\'|gettext" :disabled="info.is_readonly" :colors="[\'#000000\']"></vue-component-colorpicker> </div> </section> <section v-if="currentTab == \'options\'" @click="$parent.scrollToTariff"> <vue-pages-blocks-form-options :values.sync="options" :info="info"></vue-pages-blocks-form-options> </section> <slot></slot> </section>'}),window.$app.defineComponent("pages","vue-pages-blocks-courses-lesson",{props:["values","options","variants","info","block","block_id","tabs","currentTab"],mixins:[FormModel],created:function(){this.block.title=this.$gettext("Занятие курса"),this.$emit("update:tabs",[{name:"common",title:"Общие"},"options","section"])},methods:{prepareValues:function(){return this.values}},template:'<section class="modal-card-body modal-card-body-blocks"> <section v-if="currentTab == \'common\'"> <b-field label="Текст кнопки"> <input type="text" v-model="values.buttons.done.title" class="input"> </b-field> <div class="has-mb-2"> <vue-component-colorpicker v-model="values.colors.bg" :label="\'Цвет фона\'|gettext" :disabled="info.is_readonly" :colors="[\'#ffffff\']"></vue-component-colorpicker> </div> <div class="has-mb-2"> <vue-component-colorpicker v-model="values.colors.text" :label="\'Цвет текста\'|gettext" :disabled="info.is_readonly" :colors="[\'#000000\']"></vue-component-colorpicker> </div> <div class="has-mb-2"> <vue-component-colorpicker v-model="values.buttons.done.bg" :label="\'Цвет фона кнопки\'|gettext" :disabled="info.is_readonly" :colors="[\'#257942\']"></vue-component-colorpicker> </div> <div class="has-mb-2"> <vue-component-colorpicker v-model="values.buttons.done.color" :label="\'Цвет текста кнопки\'|gettext" :disabled="info.is_readonly" :colors="[\'#ffffff\']"></vue-component-colorpicker> </div> </section> <section v-if="currentTab == \'options\'"> <vue-pages-blocks-form-options :values.sync="options" :info="info"></vue-pages-blocks-form-options> </section> <slot></slot> </section>'}),window.$app.defineComponent("pages","vue-pages-blocks-courses-navs",{props:["values","options","variants","info","block","block_id","tabs","currentTab"],mixins:[FormModel],created:function(){this.block.title=this.$gettext("Навигация курса"),this.$emit("update:tabs",[{name:"common",title:"Общие"},"options","section"])},methods:{prepareValues:function(){return this.values}},template:'<section class="modal-card-body modal-card-body-blocks"> <section v-if="currentTab == \'common\'" @click="$parent.scrollToTariff" class="is-html-section"> <div class="has-mb-2"> <vue-component-colorpicker v-model="values.colors.bg" :label="\'Цвет фона\'|gettext" :disabled="info.is_readonly" :colors="[\'#ffffff\']"></vue-component-colorpicker> </div> <div class="has-mb-2"> <vue-component-colorpicker v-model="values.colors.text" :label="\'Цвет текста\'|gettext" :disabled="info.is_readonly" :colors="[\'#000000\']"></vue-component-colorpicker> </div> </section> <section v-if="currentTab == \'options\'" @click="$parent.scrollToTariff"> <vue-pages-blocks-form-options :values.sync="options" :info="info"></vue-pages-blocks-form-options> </section> <slot></slot> </section>'}),window.$app.defineComponent("pages","vue-pages-blocks-courses-progress",{props:["values","options","variants","info","block","block_id","tabs","currentTab"],mixins:[FormModel],created:function(){this.block.title=this.$gettext("Навигация курса"),this.$emit("update:tabs",[{name:"common",title:"Общие"},"options","section"])},methods:{prepareValues:function(){return this.values}},template:'<section class="modal-card-body modal-card-body-blocks"> <section v-if="currentTab == \'common\'" @click="$parent.scrollToTariff" class="is-html-section"> <vue-component-colorpicker v-model="values.colors.done" :label="\'Цвет выполненных заданий\'|gettext" :disabled="info.is_readonly" :colors="[\'#49c674\']"></vue-component-colorpicker> </section> <section v-if="currentTab == \'options\'" @click="$parent.scrollToTariff"> <vue-pages-blocks-form-options :values.sync="options" :info="info"></vue-pages-blocks-form-options> </section> <slot></slot> </section>'}),window.$app.defineComponent("pages","vue-pages-blocks-form",{props:["values","options","parent","info","variants","block_type_id","info","block","block_id","tabs","currentTab"],mixins:[FormModel],data:function(){return{addons_values:null,action:null}},created:function(){this.block.title=this.$gettext("Форма");var e=[{name:"common",title:this.$gettext("Поля")},"options",{name:"pays",title:this.$gettext("Оплаты")},"section","addons"];this.values.fields_extended=[{title:this.$gettext("Расширенные поля"),fields:[{idx:"a",title:this.$gettext("Номер заявки"),value_type:"number"},{idx:"i",title:this.$gettext("Номер счёта"),value_type:"number"},{idx:"d",title:this.$gettext("Бюджет"),value_type:"number"},{idx:"g",title:this.$gettext("Ссылка на оплату"),value_type:"string"},{idx:"j",title:this.$gettext("Ссылка на страницу"),value_type:"string"}]}],this.block_id||(this.values.fields=[{type_id:3,title:this.$gettext("Имя"),text:"",required:!1,idx:"1"},{type_id:6,title:"Email",text:"",required:!0,idx:"2"}],this.values.fields_idx=3),this.$emit("update:tabs",e)},computed:{currentPaidStatus:function(){for(var e="",t=0;t<this.variants.paid_status_id.length;t++)if(this.variants.paid_status_id[t].status_id==this.values.paid_status_id){e=this.variants.paid_status_id[t].status;break}return e}},methods:{prepareValues:function(){var e=this.$clone(this.values);e.addons_values=this.addons_values,e.fields=_.map(e.fields,function(e){return _.pick(e,["default","required","text","title","type_id","variants","idx"])}),delete e.fields_extended;var t=this.$account.theme;return e.design.text==t.link.color&&e.design.bg==t.link.bg&&(e.design={on:!1}),e},onAction:function(e){var t=this;e&&(this.values.fields_idx.toString(16),this.values.fields.push({title:this.variants.fields_types[e],text:"",type_id:e,value_type:this.variants.fields_types_value[e],required:!1,default:0,variants:"",opened:!0,idx:this.values.fields_idx.toString(16)}),this.values.fields_idx++,Vue.nextTick(function(){t.action=null,t.$refs.addTippy.$el.childNodes[0]._tippy.hide()}))}},template:'<section class="modal-card-body modal-card-body-blocks"> <section v-if="info.is_readonly && (currentTab == \'common\')" class="message is-warning"> <div class="message-body">{{\'С помощью этого блока, вы сможете создать форму для сбора контактных данных и добавить прием оплаты\'|gettext}}</div> </section> <section v-if="currentTab == \'common\'" @click="$parent.scrollToTariff"> <vue-component-form-blocks v-model="values.fields" :variants="variants" :disabled="info.is_readonly"></vue-component-form-blocks> <div class="is-hidden-tablet"> <vue-component-dropdown position="is-top-left is-fullwidth" v-model="action" @input="onAction" :withArrow="false" :disabled="info.is_readonly" :title="\'Добавить поле\'|gettext" button-class="button is-light is-fullwidth has-text-primary is-form-adding has-mt-2" :without-value="true"> <span slot="button"><i class="fas fa-plus has-mr-2"></i>{{\'Добавить поле\'|gettext}}</span> <b-dropdown-item v-for="(v, k) in variants.fields_types" :value="k" aria-role="menuitem"><i class="form-element-icon" v-html="\'&#x\'+(1000+parseInt(k))+\';\'"></i>{{v}}</b-dropdown-item> </vue-component-dropdown> </div> <tippy placement="top" trigger="click" theme=\'light\' arrow interactive ref="addTippy"> <template v-slot:trigger> <button class="button is-light is-fullwidth has-text-primary is-form-adding has-mt-2 is-hidden-mobile" :disabled="info.is_readonly"><i class="fas fa-plus has-mr-2"></i>{{\'Добавить поле\'|gettext}}</button> </template> <a class="tooltip-menu has-two-columns" v-for="(v, k) in variants.fields_types" @click="onAction(k)" :class="{disabled: info.is_readonly}"><i class="form-element-icon" v-html="\'&#x\'+(1000+parseInt(k))+\';\'"></i>{{v}}</a> </tippy> </section> <section v-if="currentTab == \'options\'" @click="$parent.scrollToTariff"> <b-field :label="\'Текст на кнопке\'|gettext"> <input type="text" v-model="values.form_btn" class="input" :disabled="info.is_readonly" :placeholder="\'Отправить\'|gettext"> </b-field> </section> <section v-if="currentTab == \'options\'" @click="$parent.scrollToTariff"> <b-field :label="\'Тип формы\'|gettext" v-if="_.size(variants.target_id)"> <b-select v-model="values.target_id" :disabled="info.is_readonly" :placeholder="\'-- Простая форма --\'|gettext" expanded> <option :value="null">{{\'-- Простая форма --\'|gettext}}</option> <option v-for="(v, k) in variants.target_id" :value="k">{{v}}</option> </b-select> </b-field> <div v-if="values.target_id"> <b-select v-model="values.target_value" :disabled="info.is_readonly" :placeholder="\'-- Не выбрано --\'|gettext" expanded> <option :value="null">{{\'-- Не выбрано --\'|gettext}}</option> <option v-for="(v, k) in variants.target_values[values.target_id]" :value="k">{{v}}</option> </b-select> </div> <vue-component-form-options-editor v-else :values="values" :disabled="info.is_readonly" :variants="variants" :errors="errors"/> </section> <section v-if="currentTab == \'options\'" @click="$parent.scrollToTariff"> <vue-pages-blocks-form-design :values.sync="values.design" :info="info"/> <vue-pages-blocks-form-options :values.sync="values" :options.sync="options" :info="info"/> </section> <section v-if="(currentTab == \'pays\') && $auth.isAllowTariff(\'business\') && !info.amount_payments_providers" class=\'message is-danger\'><div class="message-body">{{\'Чтобы принимать оплату, вам необходимо настроить платежные системы в разделе\'|gettext}} "<a href="/profile/settings/payments/" target="_blank">{{\'Настройки\'|gettext}}</a>".</div></section> <section v-if="currentTab == \'pays\'" @click="$parent.scrollToTariff"> <div class="has-mb-2"><mx-toggle v-model=\'values.is_order\' :title="\'Принимать оплату\'|gettext" :disabled="info.is_readonly"></mx-toggle></div> <div class="row" :class="{disabled: !values.is_order}"> <div class="col-sm-4 col-xs-12 has-mb-2" :class="{\'has-error\': errors.order_budget}"><label class="label">{{\'Цена\'|gettext}}</label> <div class="field has-addons"> <div class="control is-expanded"> <number v-model="values.order_budget" :precision="$account.currency.precision" class="input has-text-right" :disabled="info.is_readonly"> </div> <div class="control"><div class="button is-static">{{$account.currency.title}}</div></div> </div> </div> <div class="col-sm-8 col-xs-12" :class="{\'has-error\': errors.order_purpose}"> <div class="field"> <label class="label">{{\'Назначение платежа\'|gettext}}</label> <div class="row row-small"> <div class="col-xs-12 col-sm-4 has-mb-2"> <b-select v-model="values.payment_object_id" :disabled="info.is_readonly" expanded> <option v-for="(v, k) in variants.payment_object_id" :value="k">{{v}}</option> </b-select> </div> <div class="col-xs-12 col-sm-8 has-mb-2"> <input type=\'text\' v-model=\'values.order_purpose\' class=\'input\' :disabled="info.is_readonly" v-if="values.payment_object_id < 100"> <b-select v-model="values.payment_object_value" :disabled="info.is_readonly" :placeholder="\'-- Не выбрано --\'|gettext" expanded v-else> <option :value="null">{{\'-- Не выбрано --\'|gettext}}</option> <option v-for="(v, k) in variants.payment_objects_values[values.payment_object_id]" :value="k">{{v}}</option> </b-select> </div> </div> </div> </div> </div> <div :class="{disabled: !values.is_order}"> <b-checkbox v-model="values.paid_change_status" :disabled="info.is_readonly">{{\'После успешной оплаты менять статус\'|gettext}}:</b-checkbox> <b-dropdown aria-role="list" position="is-top-right" :disabled="!values.paid_change_status || info.is_readonly"><label :disabled="!values.paid_change_status || info.is_readonly" :class="{\'has-text-primary\': values.paid_change_status}" class="b-checkbox checkbox is-marginless" slot="trigger" aria-role="listitem">{{currentPaidStatus}}</label> <b-dropdown-item @click="values.paid_status_id = s.status_id;" v-for="s in variants.paid_status_id"><i class="fas fa-circle has-mr-1" :style=\'"color:#{1}"|format(s.color)\'></i> {{s.status}}</b-dropdown-item> </b-dropdown> </div> </section> <slot></slot> </section>'}),window.$app.defineComponent("pages","vue-pages-blocks-html",{props:["values","options","variants","info","block","block_id","tabs","currentTab"],mixins:[FormModel],created:function(){this.block.title=this.$gettext("HTML код"),this.$emit("update:tabs",[{name:"common",title:"HTML"},"options","section"])},methods:{prepareValues:function(){return this.values}},template:'<section class="modal-card-body modal-card-body-block-html modal-card-body-blocks"> <section v-if="currentTab == \'common\'" @click="$parent.scrollToTariff" class="is-html-section"> <div class="panel panel-default"> <vue-component-codemirror v-model="values.html" :disabled="info.is_readonly" style="min-height: 100px"/> </div> </section> <section v-if="currentTab == \'options\'" @click="$parent.scrollToTariff"> <vue-pages-blocks-form-options :values.sync="values" :options.sync="options" :info="info"/> </section> <slot></slot> </section>'}),window.$app.defineComponent("pages","vue-pages-blocks-link",{props:["values","options","parent","variants","info","block","block_id","block_type_id","tabs","currentTab","section","addon_target_additional"],mixins:[FormModel],data:function(){return{addons_values:null}},watch:{addon_target_additional:function(){this.$emit("update:addon_target_additional",this.addon_target_additional)}},created:function(){this.block.title=this.$gettext("Ссылка"),this.$emit("update:tabs",[{name:"common",title:this.$gettext("Ссылка")},{name:"thumbnail",title:this.$gettext("Миниатюра")},"options","section","addons","statistics"])},computed:{defaultColor:function(){return null!=this.section&&null!=this.section.link.color?this.section.link.color:this.$account.theme.link.color},defaultSubtitle:function(){return null!=this.section&&null!=this.section.link.subtitle.color?this.section.link.subtitle.color:this.$account.theme.link.subtitle.color},defaultBg:function(){return null!=this.section&&null!=this.section.link.bg?this.section.link.bg:this.$account.theme.link.bg},error:function(){return null!=this.errors[this.values.type]}},methods:{prepareValues:function(){var e=this.$clone(this.values);this.$account.theme;return e.design.text==this.defaultColor&&e.design.bg==this.defaultBg&&e.design.subtitle==this.defaultSubtitle&&(e.design={on:!1}),e}},template:'<section class="modal-card-body modal-card-body-blocks"> <section v-if="currentTab == \'common\'"> <b-field :label="\'Текст ссылки\'|gettext" :class="{\'has-error\': errors.title}" :message="errors.title"> <div> <input class="input has-mb-1" v-model="values.title" :disabled="info.is_readonly" :placeholder="\'Заголовок\'|gettext"></input> <input class="input" v-model="values.subtitle" :disabled="info.is_readonly" :placeholder="\'Подзаголовок\'|gettext"></input> </div> </b-field> <b-field :class="{\'has-error\': error}" :message="error"> <vue-component-link-editor :values.sync="values" :variants="variants" :info="info" :addon_target_additional.sync="addon_target_additional"/> </b-field> </section> <section v-if="currentTab == \'thumbnail\'" style="height: 100%"> <vue-component-thumbnail-chooser :pictures="values.thumb_pictures" v-model="values.thumb" :disabled="info.is_readonly"/> </section> <section v-if="currentTab == \'options\'"> <vue-pages-blocks-form-design-link :values.sync="values.design" :info="info"/> <vue-pages-blocks-form-animations :values.sync="values" :info="info" :variants="variants"/> <div class="has-mb-2"> <mx-toggle v-model="values.open_new_window" :title="\'Открывать в новом окне\'|gettext" :disabled="info.is_readonly" :disabled="values.type != \'link\'"></mx-toggle> </div> <vue-pages-blocks-form-options :values.sync="values" :options.sync="options" :info="info"/> </section> <slot></slot> </section>'}),window.$app.defineComponent("pages","vue-pages-blocks-map",{props:["values","options","variants","info","block","block_id","tabs","currentTab"],mixins:[FormModel],data:function(){return{query:"",isGeocoding:!1,current:0,map:null,markers:[]}},computed:{isSupportWebp:function(){var e=document.createElement("canvas");return!(!e.getContext||!e.getContext("2d"))&&0==e.toDataURL("image/webp").indexOf("data:image/webp")}},created:function(){this.block.title=this.$gettext("Карта");var e=[{name:"common",title:this.$gettext("Карта и метки")},{name:"extended",title:this.$gettext("Опции карты")},"options","statistics","section"];this.$emit("update:tabs",e)},mounted:function(){var i=this;$mx.lazy("map.js","map.css",function(){var e=i.$clone(i.values.bounds);0==e.length&&(e={zoom:4,center:{lat:55.5807481,lng:36.8251304}}),i.map=L.map(i.$refs.map,{attributionControl:!1}).setView([e.center.lat,e.center.lng],e.zoom),L.control.attribution({prefix:""}).addTo(i.map),L.tileLayer("https://m.taplink.cc/{z}/{x}/{y}."+(i.isSupportWebp?"webp":"png"),{attribution:"",crossOrigin:!0}).addTo(i.map),i.icon=L.icon({iconUrl:"/s/i/marker.png",iconSize:[28,37],popupAnchor:[0,-10],shadowUrl:"/s/i/marker-shadow.png",shadowSize:[40,50],shadowAnchor:[12,31]});function s(){var e=i.map.getBounds();i.values.bounds={center:i.map.getCenter(),zoom:i.map.getZoom(),bounds:[[e.getNorth(),e.getEast()],[e.getSouth(),e.getWest()]]}}0==i.values.bounds.length&&navigator.geolocation.getCurrentPosition(function(e){var t={lat:e.coords.latitude,lng:e.coords.longitude};i.map.setView(t,10),s()}),i.map.on("moveend",s),i.map.on("zoomend",s),s(),_.each(i.values.markers,i.addMarkerInternal)})},methods:{addMarkerInternal:function(s){var e={lat:parseFloat(s.lat),lng:parseFloat(s.lng)},i=L.marker([e.lat,e.lng],{icon:this.icon,draggable:!0}).addTo(this.map);i.on("dragend",function(e){var t=i.getLatLng();s.lat=t.lat,s.lng=t.lng}),this.markers.push(i)},addMarker:function(){var o=this;""!=this.query.trim()&&(this.isGeocoding=!0,$mx.lazy("//maps.googleapis.com/maps/api/js?key=AIzaSyCsYkpOHG_vddnpHQJ8kamy4RGt81HCfCU&libraries=places",function(){(new google.maps.Geocoder).geocode({address:o.query},function(e,t){var s,i,a;"OK"==t&&e.length&&e[0].geometry&&(i={lng:(s=e[0].geometry.location).lng(),lat:s.lat(),text:"",title:o.query},o.values.markers.push(i),o.current=o.values.markers.length-1,o.addMarkerInternal(i),o.markers.length&&(a=new L.featureGroup(o.markers),o.map.fitBounds(a.getBounds())),o.$nextTick(function(){1==o.markers.length&&o.$refs.markers.querySelector(".in textarea").focus()}),o.query=""),o.isGeocoding=!1})}))},deleteMarker:function(e){this.map.removeLayer(this.markers[e]),this.markers.splice(e,1),this.values.markers.splice(e,1)},prepareValues:function(){var e=this.$clone(this.values);e.markers=_.map(e.markers,function(e){return _.pick(e,["lng","lat","title","text"])});var t=this.$account.theme;return e.design.text==t.link.color&&e.design.bg==t.link.bg&&(e.design={on:!1}),e}},template:'<section class="modal-card-body modal-card-body-blocks"> <section v-if="info.is_readonly && (currentTab == \'common\')" class="message is-warning"> <div class="message-body">{{\'Здесь вы можете добавить карту и отметить ваши адреса\'|gettext}}</div> </section> <section :class="{\'is-hidden\': currentTab != \'common\'}" @click="$parent.scrollToTariff"> <div class="map-container map-view-with-zoom-control" :class="{disabled: info.is_readonly}"> <div class="map-form" ref=\'map\'></div> </div> </section> <section :class="{\'is-hidden\': currentTab != \'common\'}" @click="$parent.scrollToTariff"> <div class="has-mb-2"> <div class="row row-small"> <div class="col-xs"> <b-input v-model="query" autocorrect="off" autocapitalize="off" spellcheck="false" :placeholder="\'Введите адрес метки\'|gettext" @keyup.native.enter="addMarker" :loading="isGeocoding" :disabled="info.is_readonly"></b-input> </div> <div class="col-xs col-shrink"> <button type=\'button\' class="button is-success" @click="addMarker" :class="{\'is-loading\': isGeocoding}" :disabled="info.is_readonly">{{\'Добавить метку\'|gettext}}</button> </div> </div> </div> <div ref=\'markers\'> <vue-component-sortable-form-fields v-model="values.markers" :current.sync="current"> <template v-slot:title="{ item }"> <span v-if="item.title">{{item.title}}</span> <span v-else>{{\'Заголовок\'|gettext}}</span> </template> <template v-slot:action="{ index }"> <a class="has-text-danger is-pulled-right" @click.stop="deleteMarker(index)" :class="{disabled: info.is_readonly}"><i class="fa fa-trash-alt"></i></a> </template> <template v-slot:form="{ item, index }"> <div class="field"> <input type="text" v-model="item.title" class="input" :placeholder="\'Заголовок\'|gettext" :disabled="info.is_readonly"> </div> <div class="field"> <textarea class="input" v-model="item.text" :placeholder="\'Режим работы, этаж и другая полезная информация\'|gettext" :disabled="info.is_readonly"></textarea> </div> </template> </vue-component-sortable-form-fields> </div> </section> <section v-if="currentTab == \'extended\'" @click="$parent.scrollToTariff"> <div class="has-mb-2"><mx-toggle v-model="values.is_fixed" :title="\'Зафиксировать карту\'|gettext" :disabled="info.is_readonly"></mx-toggle></div> <div class="has-mb-2"><mx-toggle v-model="values.show_buttons" :title="\'Добавить отдельные ссылки для каждой метки\'|gettext" :disabled="info.is_readonly"></mx-toggle></div> <div><mx-toggle v-model="values.show_zoom" :title="\'Показывать ползунок масштабирования\'|gettext" :disabled="info.is_readonly"></mx-toggle></div> </section> <section v-if="currentTab == \'options\'" @click="$parent.scrollToTariff"> <vue-pages-blocks-form-design :values.sync="values.design" :info="info"/> <vue-pages-blocks-form-options :values.sync="values" :options.sync="options" :info="info"/> </section> <slot></slot> </section>'}),window.$app.defineComponent("pages","vue-pages-blocks-media-icon-style",{data:function(){return{styles:["none","bordered","solid"],shapes:["square","rounded","circle"],colorPickerOpened:!1}},props:{value:Object,disabled:Boolean,defaultColor:String},watch:{value:{handler:function(){this.$emit("updated")},deep:!0}},methods:{activeChangeColorpicker:function(e){this.colorPickerOpened=e}},template:'<vue-component-dropdown class="is-fullwidth" :class="{\'is-color-picker-opened\': colorPickerOpened}" :disabled="disabled" ref="dropdown" :title="\'Иконка\'|gettext" button-class="button is-default is-fullwidth is-focusable"> <span slot="button"><i class="fa fa-star has-mr-1 has-text-grey-light"></i>{{\'Иконка\'|gettext}}</span> <b-dropdown-item custom style="min-width: 300px"> <b-field :label="\'Стиль\'|gettext"> <vue-component-toggle-list class="block-media-style" v-model="value.style" :items="styles"> <template v-slot="props"> <div :class="[\'is-\'+props.value, \'is-\'+value.shape]" style="--icon-size:24px;--icon-border: 1px"><span><em style="-webkit-mask-image:url(/s/icons/icofont/star.svg);mask-image: url(/s/icons/icofont/star.svg)"></em></span></div> </template> </vue-component-toggle-list> </b-field> <b-field :label="\'Фигура\'|gettext"> <vue-component-toggle-list class="block-media-style is-shapes" v-model="value.shape" :items="shapes"> <template v-slot="props"> <div :class="[\'is-\'+props.value, \'is-solid\']" style="--icon-size:18px;--icon-border: 0"><span><em class="is-invisible"></em></span></div> </template> </vue-component-toggle-list> </b-field> <b-field :label="\'Размер\'|gettext"> <div class="row row-small"> <div class="col-xs col-shrink" style="display: flex;align-items: center"> <b style="width: 40px;white-space: nowrap;">{{value.size}} px</b> </div> <div class="col-xs"> <b-slider :min="16" :max="80" :tooltip="false" v-model="value.size" size="is-line" rounded :step="8"> <template v-for="(i, j) in [16, 24, 32, 40, 48, 56, 64, 72, 80]"> <b-slider-tick :value="i" :key="i"></b-slider-tick> </template> </b-slider> </div> </div> </b-field> <b-field :label="\'Цвет\'|gettext"> <vue-component-colorpicker v-model="value.color" :disabled="disabled" :colors="[defaultColor]" :with-arrow="true" position-vrtical="top" @active-change="activeChangeColorpicker"></vue-component-colorpicker> </b-field> </b-dropdown-item> </vue-component-dropdown>'}),window.$app.defineComponent("pages","vue-pages-blocks-media-style",{data:function(){return{aligns:["l","c","r"],cols:{1:[0],2:[0,0],3:[0,0,0]}}},props:{value:Object,disabled:Boolean},watch:{value:{handler:function(){this.$emit("updated")},deep:!0}},template:'<vue-component-dropdown class="is-fullwidth" :disabled="disabled" ref="dropdown" :title="\'Макет\'|gettext" button-class="button is-default is-fullwidth is-focusable"> <span slot="button"><i class="fa fa-line-columns has-mr-1 has-text-grey-light"></i>{{\'Макет\'|gettext}}</span> <b-dropdown-item custom style="min-width: 300px"> <b-field :label="\'Расположение карточек\'|gettext"> <vue-component-toggle-list class="block-media-align" v-model="value.align" :items="aligns"> <template v-slot="props"> <div :class="\'is-\'+props.value"> <i class="fas fa-star"></i> <div><dd></dd><dt></dt></div> </div> </template> </vue-component-toggle-list> </b-field> <b-field :label="\'Количество карточек в ряд на ПК\'|gettext"> <vue-component-toggle-list class="block-media-cols" v-model="value.cols" :items="_.keys(cols)"> <template v-slot="props"> <div :class="\'has-\'+props.value"> <em v-for="i in cols[props.value]"></em> </div> </template> </vue-component-toggle-list> </b-field> <b-field :label="\'Отступ между карточками\'|gettext"> <div class="row row-small"> <div class="col-xs col-shrink" style="display: flex;align-items: center"> <b style="width:25px"> <b v-if="value.spacing">{{value.spacing}}x</b> <b v-else>{{\'Нет\'|gettext}}</b> </b> </div> <div class="col-xs"> <b-slider :min="0" :max="3" :tooltip="false" v-model="value.spacing" size="is-line" rounded :step="1"> <template v-for="(i, j) in [0, 1, 2, 3]"> <b-slider-tick :value="i" :key="i"></b-slider-tick> </template> </b-slider> </div> </div> </b-field> <mx-toggle v-model="value.centered" :disabled="value.align != \'c\'" :title="\'Центрировать текст\'|gettext"/> </b-dropdown-item> </vue-component-dropdown>'}),window.$app.defineComponent("pages","vue-pages-blocks-media",{props:["values","options","variants","info","block","block_id","tabs","currentTab","section"],mixins:[FormModel],data:function(){return{currentTab:"common",lastDefaultColor:"",isStyleUpdating:!1,keyComponent:0}},created:function(){this.block.title=this.$gettext("Иконка и текст"),this.$emit("update:tabs",[{name:"common",title:this.block.title},"options","section"]),this.values.styles.color||(this.values.styles.color=this.colorText),this.lastDefaultColor=this.colorText},watch:{section:{handler:function(){this.lastDefaultColor==this.values.styles.color&&(this.values.styles.color=this.colorText),this.lastDefaultColor=this.colorText},deep:!0}},computed:{fontHeading:function(){return null!=this.section.heading&&null!=this.section.heading.font?this.section.heading.font:this.$account.theme.heading.font},fontText:function(){return null!=this.section.text&&null!=this.section.text.font?this.section.text.font:this.$account.theme.screen.font},colorHeading:function(){return null!=this.section.heading&&null!=this.section.heading.color?this.section.heading.color:this.$account.theme.heading.color},colorText:function(){return null!=this.section.text&&null!=this.section.text.color?this.section.text.color:this.$account.theme.screen.color},textCentered:function(){return"c"==this.values.styles.align&&this.values.styles.centered},weight:function(){return 600},bg:function(){return null!=this.section.bg?this.section.bg.color1:this.$account.theme.bg.color1},defaultColor:function(){return null!=this.section&&null!=this.section.text&&null!=this.section.text.color?this.section.text.color:this.$account.theme.screen.color},styleHeading:function(){var e=null!=this.section.heading&&null!=this.section.heading.transform?this.section.heading.transform:this.$account.theme.heading.transform;return{"font-family":this.fontHeading?globalFontsFallback[this.fontHeading]:null,"font-size":FontsFactory.getTextSize(this.values.styles.text_size)+" !important","font-weight":this.weight+" !important",color:this.colorHeading,"line-height":FontsFactory.getLineHeight(this.values.styles.text_size),"text-transform":FontsFactory.getTransform(e)+" !important"}},styleText:function(){return{"font-family":this.fontText?globalFontsFallback[this.fontText]:null,"font-size":FontsFactory.getTextSize(this.values.styles.text_size)+" !important",color:this.colorText,"line-height":FontsFactory.getLineHeight(this.values.styles.text_size)}},styleItem:function(){return{background:this.bg+" !important",color:this.colorText}}},methods:{icon:function(e){var t=this;return this.$icons.get(e.thumb.i,function(){t.keyComponent++})},styleUpdated:function(){var e=this;this.isStyleUpdating=!0,setTimeout(function(){e.isStyleUpdating=!1,e.$forceUpdate()},350)},changeTextSize:function(){this.$nextTick(function(){$mx(".autoresize-init").trigger("change")})},openThumbForm:function(t){var s=this;this.$modal("vue-pages-thumbnail-chooser-form",{value:t.thumb,useObject:!0,onSave:function(e){t.thumb=e,s.styleUpdated()}})},prepareValues:function(){var e=this.$clone(this.values);return e.styles.color==this.colorText&&(e.styles.color=""),_.each(e.fields,function(e){"p"==e.thumb.t&&e.thumb.p&&(e.thumb.p=e.thumb.p.picture_id)}),e},onRemove:function(e){var t=this;this.$confirm(this.$gettext("Вы уверены что хотите удалить этот элемент?"),"is-danger").then(function(){t.values.fields.splice(e,1)})},onAdd:function(){var t=this,e=this.values.fields,s=1<e.length&&_.isEqual(e[e.length-2].thumb,e[e.length-1].thumb)?e[e.length-1].thumb:{t:"n",i:null,p:null};this.values.fields.push({title:"",text:"",thumb:s}),this.$nextTick(function(){var e=$mx(t.$refs.fields).find(".block-form-media-content > textarea:first");e[e.length-1].focus()})}},template:'<section class="modal-card-body modal-card-body-blocks"> <section v-if="currentTab == \'common\'" class="is-toolbar is-paddingless-mobile"> <vue-component-font-size-chooser class="toolbar-item toolbar-item-first" v-model="values.styles.text_size" :groups="[\'t\']" :disabled="info.is_readonly" @input="changeTextSize"/> <div class="component-group toolbar-item"> <vue-pages-blocks-media-style v-model="values.styles" @updated="styleUpdated"/> <vue-pages-blocks-media-icon-style class="toolbar-item-last" v-model="values.styles" :default-color="defaultColor" @updated="styleUpdated"/> </div> </section> <section v-if="currentTab == \'common\'" ref=\'fields\' :key="keyComponent" :style="{\'--card-spacing\': Math.max(3, (values.styles.spacing*15))+\'px\'}"> <vue-component-sortable-form-fields v-model="values.fields" helperClass="block-form-media-item" :current="null" class="block-form-media-item has-mb-2" v-if="values.fields.length" :item-style="styleItem"> <template v-slot:title="{item}"> <span class="block-media"> <div :class="\'is-align-\'+values.styles.align"> <div class="media block-media-editor" :style="[{flex: 1, \'--icon-size\': values.styles.size+\'px\', \'--icon-border\': \'2px\', \'--icon-color\': values.styles.color}, values.styles.color?{\'--text-color-contrast\': (lightOrDark(values.styles.color) == \'light\')?\'#000\':\'#fff\'}:null]"> <div class="has-text-weight-normal" :class="[{\'is-empty\': item.thumb.t == \'n\'}, \'is-\'+lightOrDark(values.styles.color)]" @click="openThumbForm(item)"> <div :class="[(item.thumb.t == \'n\')?null:(\'is-\'+values.styles.style), \'is-\'+values.styles.shape]"> <span :style="(item.thumb.t == \'p\')?{\'background-image\': \'url(\'+item.thumb.p.link+\')\'}:null" :class="{\'is-icon\': item.thumb.t == \'i\', \'is-image\': item.thumb.t == \'p\', \'is-updating\': isStyleUpdating}"> <figure v-if="item.thumb.t == \'n\'">{{\'Нет\'|gettext}}</figure> <figure v-if="item.thumb.t == \'i\'" v-html="icon(item)" :key="item.thumb.i"></figure> <figure v-if="item.thumb.t == \'p\'"></figure> </span> </div> </div> <div class="block-form-media-content"> <textarea type="text" v-model="item.title" :disabled="info.is_readonly" class="has-rtl input autoresize-init" :class="{\'has-text-centered\': textCentered}" :placeholder="\'Заголовок\'|gettext" :style="styleHeading"></textarea> <textarea type="text" v-model="item.text" :disabled="info.is_readonly" class="has-rtl input autoresize-init" :class="{\'has-text-centered\': textCentered}" :placeholder="\'Текст\'|gettext" :style="styleText"></textarea> </div> </div> </div> </span> </template> <template v-slot:action="{ index }"> <a class="is-pulled-right has-text-danger" @click.stop="onRemove(index)" :class="{disabled: info.is_readonly}"><i class="fa fa-trash-alt"></i></a> </template> </vue-component-sortable-form-fields> <button type="button" @click="onAdd" class="button is-light has-text-primary is-fullwidth has-p-3 is-form-adding" :class="{disabled: info.is_readonly}"><i class="fas fa-plus has-mr-2"></i>{{\'Добавить новый пункт\'|gettext}}</button> </section> <section v-if="currentTab == \'options\'"> <vue-pages-blocks-form-options :values.sync="values" :options.sync="options" :info="info"/> </section> <slot></slot> </section>'}),window.$app.defineComponent("pages","vue-pages-blocks-messenger",{props:["values","options","parent","variants","info","block","block_id","block_type_id","tabs","currentTab","section"],mixins:[FormModel],data:function(){return{current:-1,addons_values:null,mode:"edit",selected:[]}},created:function(){this.block.title=this.$gettext("Мессенджеры"),this.$emit("update:tabs",[{name:"common",title:this.$gettext("Ссылки")},"options","statistics","section","addons"]),this.values.items.length||this.setMode("choose")},watch:{values:{handler:function(){this.values.items.length||this.setMode("choose")},deep:!0}},computed:{items:function(){var s={};return _.each(this.variants.list,function(e){_.each(e.items,function(e,t){return s[t]=e})}),s},samples:function(){var t=this,s=_.map(this.values.items,function(e){return null!=t.items[e.n].icon?t.items[e.n].icon:e.n}).reverse();return _.sortBy(_.map(this.items,function(e,t){return{i:null!=e.icon?e.icon:t,t:e.title}}),function(e,t){return s.indexOf(t.i)-s.indexOf(e.i)})},textLine1:function(){return this.$gettext("Откройте Line@ > Выберите аккаунт > Найти новых друзей > Выберите URL-адрес > Копировать")},textLine2:function(){return this.$gettext("Откройте Line > Пригласить друзей > Пригласить > Поделиться > Выберите любой мессенджер или email > Скопируйте ссылку из сообщения")}},methods:{deleteItem:function(e){var t=this;this.$confirm(this.$format(this.$gettext("Вы уверены что хотите удалить {1}?"),this.items[this.values.items[e].n].title),"is-danger").then(function(){t.values.items.splice(e,1)})},icon:function(e){var t=this.items[e];return null!=t.icon?t.icon:e},prepareValues:function(){var e=this.$clone(this.values);return"custom"!=e.messenger_style.design&&(e.messenger_style.colors={bg:null,text:null,icon:null}),e},setMode:function(e){var i=this;switch(e){case"choose":this.selected=_.map(this.values.items,"n");break;case"edit":var t=_.map(this.values.items,"n");_.each(this.selected,function(e){var s;-1==t.indexOf(e)&&(s={n:e,t:"",v:""},1<_.size(i.items[e].types)&&(s.tp=Object.keys(i.items[e].types)[0],_.each(i.items[e].types,function(e,t){s[t]=""})),null!=i.items[e].inputs&&_.each(i.items[e].inputs,function(e,t){s[t]=""}),i.items[e].text&&(s.text=""),i.values.items.push(s))}),_.each(t,function(e){var t;-1==i.selected.indexOf(e)&&(t=_.map(i.values.items,"n"),i.values.items.splice(t.indexOf(e),1))})}this.mode=e},selectItem:function(e){-1!=this.selected.indexOf(e)||(this.selected.push(e),this.setMode("edit"),this.current=this.selected.length-1)},getError:function(e,t){return this.errors[e]?this.errors[e][t]:null}},template:'<section class="modal-card-body modal-card-body-blocks"> <div slot="trigger"></div> <section class="is-static" v-if="info.is_readonly && (currentTab == \'common\')" class="message is-warning"> <div class="message-body">{{\'Клиенту больше не нужно будет запоминать ваш номер, сохранять, заходить в месенджер, искать вас и писать сообщение, ведь, чем сложнее с вами связаться, тем больше вероятность, что клиент отвлечется и уже забудет о вас или ему будет просто лень писать вам! Вы можете уже заранее ввести нужный текст-шаблон для клиента, чтобы ему не пришлось ничего писать!\'|gettext}}</div> </section> <section class="is-static is-toolbar" v-if="currentTab == \'common\' && values.items.length && (mode == \'edit\')" @click="$parent.scrollToTariff"> <div class="component-group toolbar-item toolbar-item-first toolbar-item-last"> <vue-pages-blocks-socials-style v-model="values.messenger_style" :section="section" :items="samples"/> </div> </section> <section class="is-static" v-if="currentTab == \'common\' && values.items.length && (mode == \'choose\')" @click="$parent.scrollToTariff"> <div class="row row-small"> <div class="col-xs" style="align-self: center"> <span v-if="mode == \'choose\'"><b>{{\'Выберите мессенджер\'|gettext}}</b></span> </div> <div class="col-xs col-shrink"> <button class="button is-dark" @click="mode = \'edit\'"><i class="fa fa-long-arrow-left has-mr-1"></i>{{\'Назад\'|gettext}}</button> </div> </div> </section> <section v-if="currentTab == \'common\' && mode== \'edit\'" @click="$parent.scrollToTariff"> <vue-component-sortable-form-fields v-model="values.items" class="has-mb-2" :current.sync="current"> <template v-slot:title="{ item }"> <span>{{items[item.n].title}}</span> </template> <template v-slot:action="{ index }"> <a class="is-pulled-right has-text-danger" @click.stop="deleteItem(index)"><i class="fa fa-trash-alt"></i></a> </template> <template v-slot:form="{ item, index }"> <b-field :label="\'Текст ссылки\'|gettext"> <input v-model="item.t" class="input" :placeholder="items[item.n].placeholder|gettext|format(items[item.n].title)" :disabled="info.is_readonly"> </b-field> <div class="form-messengers-switch has-text-grey" v-if="Object.keys(items[item.n].types).length> 1"> <a v-for="(t, k) in items[item.n].types" :class="{\'has-text-black\': item.tp == k, \'has-text-grey\': item.tp != k}" @click="item.tp = k">{{t.check|gettext}}</a> </div> <b-field v-for="(t, k) in items[item.n].types" v-if="(Object.keys(items[item.n].types).length == 1) || (item.tp == k)" :label="t.label|gettext|format(items[item.n].title)" :message="getError(item.n, k)" :class="{\'has-error\': getError(item.n, k)}"> <input v-model="item[k]" v-if="t.type == \'input\'" class="input" :disabled="info.is_readonly" :placeholder="t.placeholder|gettext"> <mx-phone v-model="item[k]" v-if="t.type == \'phone\' && current== index" :disabled="info.is_readonly" classname="input"/> </b-field> <b-field v-for="(ipt, inm) in items[item.n].inputs" :label="ipt.label|gettext|format(items[item.n].title)"> <textarea v-if="ipt.type == \'textarea\'" v-model="item[inm]" :placeholder="ipt.placeholder|gettext" class="input" :disabled="info.is_readonly" style="min-height: 100px"></textarea> </b-field> <div v-if="item.n == \'ln\'" class="has-mt-2"> <div>{{\'Как получить ссылку\'|gettext}}: <b-tooltip :label="textLine1" position="is-top" animated multilined type="is-black"><span class=\'has-text-danger\'>Line@</span></b-tooltip> / <b-tooltip :label="textLine2" position="is-top" animated multilined type="is-black"><span class=\'has-text-danger\'>Line</span></b-tooltip> </div> </div> </template> </vue-component-sortable-form-fields> <button type="button" class="button is-light has-text-primary is-fullwidth has-p-3 is-form-adding" @click="setMode(\'choose\')" :class="{disabled: _.size(values.items)>= _.size(items)}"><i class="fas fa-plus has-mr-2"></i>{{\'Добавить новый пункт\'|gettext}}</button> </section> <section v-if="currentTab == \'common\' && mode== \'choose\'" @click="$parent.scrollToTariff"> <div v-for="(w, i) in variants.list"> <div class="select-list row row-small"> <label v-for="(item, index) in w.items" class="col-xs-6 col-sm-4 has-mb-2" :class="{in: selected.indexOf(index) != -1, disabled: info.is_readonly}"><span :class="[\'btn-socials is-shape-brand is-design-brand is-service-\'+icon(index)]" @click="selectItem(index)"><i :class="\'fa fab fa-\'+icon(index)"></i><div>{{item.title}}</div></span></label> </div> </div> </section> <section v-if="currentTab == \'options\'" @click="$parent.scrollToTariff"> <vue-pages-blocks-form-options :values.sync="values" :options.sync="options" :info="info"/> </section> <slot></slot> </section>'}),window.$app.defineComponent("pages","vue-pages-blocks-music",{props:["values","options","variants","info","block","block_id","tabs","currentTab"],mixins:[FormModel],data:function(){return{services:{sp:{title:"Spotify",s:{a:/open\.spotify\.com\/album\/(.*)/g,t:/open\.spotify\.com\/track\/(.*)/g,p:/open\.spotify\.com\/playlist\/(.*)/g},name:"sp",is_sample:!0},pm:{title:"Apple Music",s:{t:/music\.apple\.com\/(.*)?\?i=/g,a:/music\.apple\.com\/.*\/album\//g,p:/music\.apple\.com\/.*\/playlist\//g},name:"pm",is_sample:!0},sc:{title:"Sound Cloud",s:{p:/soundcloud\.com\/(.*)?\/sets\/playlist/g,a:/soundcloud\.com\/(.*)?\/sets\//g,t:/soundcloud\.com\/(.*)/g},name:"sc",is_sample:!0},dz:{title:"Deezer",s:{a:/deezer\.com\/.*?\/?album/g,t:/deezer\.com\/.*?\/?track/g},name:"dz",is_sample:!0},bc:{title:"Bandcamp",s:{a:/bandcamp\.com\/album\//g,t:/bandcamp\.com\/track\//g},name:"bc",is_sample:!1},mk:{title:"Audiomack",s:{a:/audiomack\.com\/([^\/]+)\/album\/([^\/]+)/g,t:/audiomack\.com\/([^\/]+)\/song\/([^\/]+)/g,p:/audiomack\.com\/([^\/]+)\/playlist\/([^\/]+)/g},name:"mk",is_sample:!0},an:{title:"Anghami",s:{a:/play\.anghami\.com\/album\/([0-9]+)/g,t:/play\.anghami\.com\/song\/([0-9]+)/g,p:/play\.anghami\.com\/playlist\/([0-9]+)/g},name:"an",is_sample:!0},am:{title:"Amazon Music",s:{a:/music\.amazon\.[a-z]+\//g},name:"am",is_sample:!1},yt:{title:"Youtube Music",s:{a:/music\.youtube\.com\/playlist/g,t:/music\.youtube\.com\/watch/g},name:"yt",is_sample:!1},bs:{title:"BeatStars",s:{_:/beatstars\.com/g},name:"bs",is_sample:!1},pd:{title:"Pandora",s:{_:/pandora\.com/g},name:"pd",is_sample:!1},td:{title:"Tidal",s:{a:/tidal\.com\/browse\/album\//g,t:/tidal\.com\/browse\/track\//},name:"td",is_sample:!1},ym:{title:"Яндекс.Музыка",s:{t:/music\.yandex\.ru\/album\/([0-9]+)\/track\//g,a:/music\.yandex\.ru\/album\//g,p:/music\.yandex\.ru\/users\/([^\/]+)\/playlists\/([0-9]+)/g},name:"ym",is_sample:!0},sb:{title:"Сбер Звук",s:{a:/sber-zvuk\.com\/release\/([0-9]+)/g,t:/sber-zvuk\.com\/track\/([0-9]+)/g,p:/sber-zvuk\.com\/playlist\/([0-9]+)/g,c:/sber-zvuk\.com\/podcast\/([0-9]+)/g},name:"sb",is_sample:!0},vk:{title:"ВКонтакте",s:{a:/vk\.com\/music\/album\//g,p:[/vk\.com\/music.*[\?&]z=audio_playlist/g,/vk\.com\/music\/playlist/g]},name:"vk",is_sample:!1},bm:{title:"Boom",s:{_:/boom\.ru/g},name:"bm",is_sample:!1}},types:{t:this.$gettext("Трек"),a:this.$gettext("Альбом"),p:this.$gettext("Плейлист"),c:this.$gettext("Подкаст")},sizes:{s:this.$gettext("Маленький размер"),m:this.$gettext("Средний размер"),l:this.$gettext("Большой размер")},sizes_ids:["s","m","l"],query:"",size:0,current:-1}},created:function(){this.block.title=this.$gettext("Музыка"),this.size=this.sizes_ids.indexOf(this.values.size),this.$emit("update:tabs",[{name:"common",title:this.$gettext("Список сервисов")},"options","section"])},watch:{size:function(e){this.values.size=this.sizes_ids[e]}},methods:{changeUrl:function(e){var t=this.matchService(e.url);t&&(e.n=t.p.name,e.t=t.i)},prepareValues:function(){return this.$clone(this.values)},deleteItem:function(t){var s=this;this.$confirm(this.$gettext("Вы уверены что хотите удалить этот элемент?"),"is-danger").then(function(e){(s.values.items[t].n=s.values.sample)&&(s.values.sample=null),s.values.items.splice(t,1)})},matchService:function(e){for(i in this.services){var t=this.services[i];for(i in t.s){var s=_.isArray(t.s[i])?t.s[i]:[t.s[i]];for(k in s)if(r=e.match(s[k]))return{p:t,i:i}}}return null},add:function(){var e=this.matchService(this.query);e?(this.values.items.push({n:e.p.name,url:this.query,t:e.i}),this.current=this.values.items.length-1,e.p.is_sample&&!this.values.sample&&(this.values.sample=e.p.name),this.query=""):this.$alert(this.$gettext("Вставьте ссылку на Трек, Альбом или Плейлист"),"is-danger")}},template:'<section class="modal-card-body modal-card-body-blocks"> <section v-if="currentTab == \'common\'"> <form @submit.prevent="add"> <b-field expanded grouped> <b-field expanded> <input type="text" class="input" v-model="query" :placeholder="\'Ссылка на трек, альбом или плейлист\'|gettext" :disabled="info.is_readonly"> </b-field> <p class="control"><button class="button is-black" type="submit" :disabled="info.is_readonly">{{\'Добавить\'|gettext}}</button></p> <p class="control is-hidden-mobile" style="border-left: 1px solid var(--border-button-color);margin: 0 1rem 0 .25rem"></p> <p class="control"> <vue-component-dropdown v-model="values.sample" :disabled="info.is_readonly" :title="\'Плеер\'|gettext" button-class="button is-light is-fullwidth"> <span slot="button"><i class="fa fa-music has-sm-mr-2"></i><span class="is-hidden-mobile">{{\'Плеер\'|gettext}}</span></span> <b-dropdown-item custom v-if="!values.items.length" style="min-width: 300px">{{\'Добавьте хотя бы одну ссылку на музыкальный сервис\'|gettext}}</b-dropdown-item> <div v-else> <div style="max-height: 50vh;overflow-y: scroll"> <b-dropdown-item aria-role="listitem" :value="null" :disabled="$page.data.page.is_readonly" class="has-text-grey">{{\'Без плеера\'|gettext}}</b-dropdown-item> <b-dropdown-item aria-role="listitem" v-for="s in values.items" :value="s.n" :disabled="$page.data.page.is_readonly" v-if="services[s.n].is_sample">{{services[s.n].title}}</b-dropdown-item> </div> <hr class="dropdown-divider"> <b-dropdown-item custom style="min-width: 300px"> <div class="is-pulled-right">{{sizes[sizes_ids[size]]}}</div> <b-field :label="\'Размер плеера\'|gettext"> <b-slider :min="0" :max="2" :tooltip="false" v-model="size" size="is-medium" rounded> <template v-for="(v, i) in sizes_ids"> <b-slider-tick :value="i" :key="i"></b-slider-tick> </template> </b-slider> </b-field> </div> </vue-component-dropdown> </p> </b-field> <div v-if="!values.items.length" class="message is-info"> <div class="message-body"> <div class="has-mb-1">{{\'Добавьте ссылку на Трек, Альбом или Плейлист в одном из поддерживаемых сервисов, и нажмите кнопку "Добавить"\'|gettext}}</div> <div class="music-source is-preview"> <div v-for="(s, i) in services"><span :class="\'btn-socials is-shape-circle-fill is-design-brand is-service-\'+i" :title="s.title" v-tippy><i :class="\'fa fab fa-\'+i"></i></span></div> </div> </div> </div> </form> </section> <section v-if="currentTab == \'common\' && values.items.length"> <vue-component-sortable-form-fields v-model="values.items" class="has-mb-2" :current.sync="current"> <template v-slot:title="{ item }"> <span>{{services[item.n].title}}</span> </template> <template v-slot:action="{ index }"> <a class="is-pulled-right has-text-danger" @click.stop="deleteItem(index)"><i class="fa fa-trash-alt"></i></a> </template> <template v-slot:form="{ item, index }"> <span class="is-pulled-right has-text-grey">{{types[item.t]}}</span> <b-field :label="\'Ссылка\'|gettext"> <input v-model="item.url" class="input" :placeholder="\'Ссылка на трек, альбом или плейлист\'|gettext" :disabled="info.is_readonly" @input="changeUrl(item)"> </b-field> <b-field :label="\'Текст ссылки\'|gettext"> <input v-model="item.b" class="input" :placeholder="\'Слушать\'|gettext" :disabled="info.is_readonly"> </b-field> </template> </vue-component-sortable-form-fields> </section> <section v-if="currentTab == \'options\'" @click="$parent.scrollToTariff"> <vue-pages-blocks-form-options :values.sync="values" :options.sync="options" :info="info"/> </section> <slot></slot> </section>'}),window.$app.defineComponent("pages","vue-pages-blocks-page",{props:["values","info","variants","block","block_id","tabs","currentTab"],mixins:[FormModel],created:function(){this.block.title=this.$gettext("Новая страница"),this.$emit("update:message",this.$gettext("С помощью этого блока, вы сможете создавать множество внутренних страниц с отдельной ссылкой")),this.$emit("update:tabs",[])},methods:{prepareValues:function(){return this.values}},template:'<section class="modal-card-body modal-card-body-blocks"> <section v-if="currentTab == \'common\'" @click="$parent.scrollToTariff"> <b-field :label="\'Открыть страницу\'|gettext"> <b-select v-model="values.value" :disabled="info.is_readonly" expanded> <option :value="null">{{\'-- Создать новую страницу --\'|gettext}}</option> <option v-for="(v, k) in variants.link_page_id" :value="k">{{v}}</option> </b-select> </b-field> <b-field :label="\'Название страницы\'|gettext" :message="errors.title" :class="{\'has-error\': errors.title}" v-if="!values.value"> <input v-model="values.title" class="input" :disabled="info.is_readonly"> </b-field> </section> <slot></slot> </section>'}),window.$app.defineComponent("pages","vue-pages-blocks-pictures",{data:function(){return{index:0,picturesUpdating:0,resortMode:!1,deviceStyle:"margin: 0 auto;display: block;height: auto"}},props:["values","options","variants","info","block","block_id","statistics","tabs","currentTab"],mixins:[FormModel],created:function(){var e=this.$account.theme;this.block_id||(this.values.list=[{p:null,s:"",t:"",link:{title:"",type:"link",value:""}}]),this.values.design=_.merge(e.block.pictures,this.values.design),this.block.title=this.$gettext("Карусель картинок"),this.$emit("update:tabs",[{name:"common",title:this.$gettext("Картинки")},"options","statistics","section"])},mounted:function(){var s=this;$mx(this.$refs.device).on("changeindex",function(e,t){s.index=t})},destoyed:function(){$mx(this.$refs.device).off("changeindex")},computed:{link:function(){return this.values.list[this.index].link},pictureSizeStyle:function(){return"padding-top:"+{100:100,70:"70.6",50:50,138:"141.4516"}[this.values.picture_size]+"%"},brightnessClass:function(){var e=this.$account.theme,t=this.values.design.on?this.values.design.bg:(null==e.block?StylesFactory.getBaseStyles():e).block.pictures.bg;return isLightColor(t)?"is-light":"is-dark"},stylesheetText:function(){var e="";return this.values.design.on&&(e=(this.values.design.text?"color:"+this.values.design.text+" !important;":"")+(this.values.design.bg?"background:"+this.values.design.bg+" !important;":"")),e},stylesheetTitle:function(){var e="";return this.values.design.on&&(e=this.values.design.title?"color:"+this.values.design.title+" !important;":""),e},stylesheetLink:function(){var e="";return this.values.design.on&&(e=(this.values.design.button_text?"color:"+this.values.design.button_text+" !important;":"")+(this.values.design.bg?"background:"+this.values.design.bg+" !important;":"")),e}},methods:{switchReorderMode:function(){var t=this;this.resortMode=!this.resortMode,this.resortMode&&this.$nextTick(function(){var e=t.$refs.toolbar;scrollIt(e,"y",$mx(e).closest(t.$device.mobile?".modal-card-body":".modal")[0],400)})},prepareResortStyle:function(e){return null==e||null!=e.progress||null==e.link?"none":"url("+e.link+")"},onDeletePicture:function(e,t){1!=this.values.list.length?(this.index==e&&e&&this.setIndex(this.index-1),this.values.list.splice(e,1),1==this.values.list.length&&(this.resortMode=!1)):t.empty&&this.$alert(this.$gettext("В карусели должна быть хотя бы одна картинка"),"is-danger")},addSlide:function(){15<=this.values.list.length?this.$alert(this.$gettext("Максимальное количество слайдов")+": 15","is-danger"):(this.values.list.push({p:null,s:"",t:"",link:{title:"",type:this.values.list[this.index].link.type,value:null}}),this.setIndex(this.values.list.length-1))},setIndex:function(t){var s=this;this.index=t,this.$nextTick(function(){var e=s.$refs.sliders.querySelectorAll("div");$mx(e[t]).trigger("click")})},prepareValues:function(){var e=this.$clone(this.values);e.list=_.map(e.list,function(e){return e.p=e.p?e.p.picture_id:null,e});var t=this.$account.theme.block.pictures;return e.design=e.design.on&&_.size(_.differenceWith(t,e.design))?e.design:{on:!1},e},startUploading:function(){this.picturesUpdating++},stopUploading:function(){this.picturesUpdating--},showErrors:function(e){var t=this;null!=e.errors["slide:position"]&&(this.$refs.sliders.childNodes[e.errors["slide:position"]].click(),setTimeout(function(){$mx(t.$refs.linkEditor.$el).find(".link-editor-place input, .link-editor-place select")[0].focus()},100))}},template:'<section class="modal-card-body modal-card-body-blocks" :class="{\'is-rtl\': $account.locale.text_direction == \'rtl\'}"> <section v-if="info.is_readonly && (currentTab == \'common\')" class="message is-warning"> <div class="message-body">{{\'Здесь вы можете загрузить изображения или галерею картинок, добавить к ним описание и ссылки\'|gettext}}</div> </section> <section v-if="currentTab == \'common\'" @click="$parent.scrollToTariff"> <div class="field"> <div class=\'device-pictures-form device-pictures-form-pictures\'> <center> <div class="device has-shadow is-large is-hide-mobile" :class="{disabled: info.is_readonly}" style="margin:0 auto;min-height:auto"> <div class="notch"></div> <div class="screen main-theme page-font block-slider" :class="brightnessClass"> <div ref=\'device\' class="slider slider-pictures has-pb-2" :class="{\'slider-has-text\': values.options.text, \'slider-has-link\': values.options.link, \'slider-has-border\': !values.remove_border}"> <div class="slider-inner"> <div class="slider-slide" v-for="(f, i) in values.list"> <vue-component-pictures v-model="f.p" :button-title="\'Загрузить картинку\'|gettext" button-icon="fa fal fa-cloud-upload" class="picture-container picture-container-upload" :style="pictureSizeStyle" styleContainer="padding-top: initial" @delete="onDeletePicture(i, $event)" always-delete-button updatable :disabled="info.is_readonly" @startUploading="startUploading" @stopUploading="stopUploading"></vue-component-pictures> <div class="slider-slide-text" :style="stylesheetText"> <div class="slider-slide-title" v-if="f.t" :style="stylesheetTitle">{{f.t}}</div> <div class="slider-slide-title" :style="stylesheetTitle" v-else>{{\'Заголовок\'|gettext}}</div> <div class="slider-slide-snippet">{{f.s}}</div> </div> <a class="slider-slide-link" :style="stylesheetLink" v-if="f.link.title">{{f.link.title}}</a> <a class="slider-slide-link" :style="stylesheetLink" v-else>{{\'Открыть\'|gettext}}</a> </div> </div> <div class="slider-nav" :class="{\'is-hidden\': values.list.length == 1}" ref=\'sliders\'> <div v-for="(v, i) in values.list" class="slider-dot" :class="{active: index== i}" @click="index = i"></div> </div> </div> </div> </div> </center> <div class=\'form-shadow form-shadow-bottom is-hidden-mobile\' style="height: 20px"></div> </div> <div class="has-pt-2 row row-small" ref=\'toolbar\'> <div class="col-xs-6 col-sm-5 col-sm-offset-1"> <button type="button" class="button is-success is-fullwidth" :disabled="info.is_readonly || resortMode" @click="addSlide"><i class=\'fas fa-plus has-mr-1\'></i>{{\'Новый слайд\'|gettext}}</button> </div> <div class="col-xs-6 col-sm-5"> <button type="button" :class="[\'button is-dark is-fullwidth\', {\'is-active\': resortMode}]" @click="switchReorderMode" :disabled="info.is_readonly || values.list.length < 2">{{\'Порядок слайдов\'|gettext}}</button> </div> </div> </div> </section> <section v-if="currentTab == \'common\'" @click="$parent.scrollToTariff"> <div v-if="resortMode"> <sortable-list v-model="values.list" class="pictures-sortable-list pictures-form-resort" axis="xy" use-drag-handle v-if="resortMode"> <sortable-item v-for="(v, i) in values.list" class="upload-picture upload-picture-multiple" :index="i" :key="i" :item="v"> <div v-sortable-handle :class="[\'picture-container pictures-form-resort-item\', {\'picture-container-empty\': !v.p}]" :style="{\'background-image\':prepareResortStyle(v.p)}"></div> </sortable-item> </sortable-list> </div> <div v-else> <mx-toggle v-model="values.options.text" :title="\'Добавить описание\'|gettext" :disabled="info.is_readonly"></mx-toggle> <div style="padding-top: 15px" v-if="values.options.text"> <div class="has-mb-2"> <label class="label">{{\'Заголовок\'|gettext}}</label> <vue-component-emoji-picker v-model="values.list[index].t"> <input type="text" v-model="values.list[index].t" class="input has-rtl" maxlength="50" :disabled="info.is_readonly"> </vue-component-emoji-picker> </div> <div> <label class="label">{{\'Описание\'|gettext}}</label> <vue-component-emoji-picker v-model="values.list[index].s"> <textarea class="input has-rtl" v-model="values.list[index].s" rows="5" id=\'sliderTextSnippet\' maxlength="400" :disabled="info.is_readonly"></textarea> </vue-component-emoji-picker> </div> </div> </div> </section> <section v-if="currentTab == \'common\' && !resortMode" @click="$parent.scrollToTariff"> <mx-toggle v-model="values.options.link" :title="\'Добавить ссылку\'|gettext" :disabled="info.is_readonly"></mx-toggle> <div style="padding-top: 15px" v-if="values.options.link"> <div class="has-mb-2"> <label class="label">{{\'Текст ссылки\'|gettext}}</label> <input type=\'text\' class=\'input\' v-model="link.title" :disabled="info.is_readonly"> </div> <vue-component-link-editor :values.sync="link" :variants="variants" :info="info" ref="linkEditor"></vue-component-link-editor> </section> <section v-if="currentTab == \'common\' && !resortMode" @click="$parent.scrollToTariff"> <div class="row"> <div class="col-sm-12"> <label class=\'label\'>{{\'Размер картинки\'|gettext}}</label> <b-select v-model="values.picture_size" :disabled="info.is_readonly" expanded> <option v-for="(v, k) in variants.picture_size" :value="k">{{v}}</option> </b-select> </div> </div> </section> <section v-if="currentTab == \'common\' && !resortMode" @click="$parent.scrollToTariff"> <div class="row"> <div class="col-sm-12"> <label class=\'label\'>{{\'Автоматическая смена слайдов\'|gettext}}</label> <div class="row"> <div class="col-xs-6 col-sm-4"> <div class="field has-addons"> <div class="control is-expanded"><input type=\'number\' v-model=\'values.carousel_interval\' class=\'input\' :disabled="info.is_readonly || !values.carousel_ride"></div> <div class="control"><span class="button is-static">{{\'сек\'|gettext}}</span></div> </div> </div> <div class="col-xs-6 col-sm-8"> <b-checkbox v-model=\'values.carousel_ride\' :disabled="info.is_readonly">{{\'Включить\'|gettext}}</b-checkbox> </div> </div> </div> </div> </section> <section v-if="currentTab == \'options\'" @click="$parent.scrollToTariff"> <div class="label-pro-container"> <div class="tag is-pro" v-if="$account.tariff != \'pro\' && $account.tariff != \'business\'" v-tippy :content="\'Эта возможность доступна<br>на pro тарифе\'|gettext">pro</div> <div :class="{disabled: $account.tariff != \'pro\' && $account.tariff != \'business\'}"> <div class="has-mb-2"><mx-toggle v-model=\'values.design.on\' :title="\'Свои настройки дизайна\'|gettext" :disabled="info.is_readonly"></mx-toggle></div> <div class="has-mb-4" v-if="values.design.on"> <vue-component-design-pictures v-model="values.design" :disabled="info.is_readonly"></vue-component-design-pictures> </div> </div> </div> <div class="has-mb-2"><mx-toggle v-model=\'values.remove_border\' :title="\'Убрать бордюр\'|gettext" :disabled="info.is_readonly"></mx-toggle></div> <div class="has-mb-2"><mx-toggle v-model=\'values.is_desktop_fullwidth\' :title="\'Отображать боковые слайды на ПК\'|gettext" :disabled="info.is_readonly"></mx-toggle></div> <vue-pages-blocks-form-options :values.sync="values" :options.sync="options" :info="info"/> </section> <slot></slot> </section>'}),window.$app.defineComponent("pages","vue-pages-blocks-pricing",{props:["values","options","variants","info","block","block_id","tabs","currentTab"],mixins:[FormModel],data:function(){return{currentTab:"common",beforeCurrency:"",afterCurrency:""}},created:function(){this.block.title=this.$gettext("Прайс лист"),this.$emit("update:tabs",[{name:"common",title:this.block.title},"options","section"]);var e=this.$account.currency.format.replace("%c",this.$account.currency.title),t=e.indexOf("%p");this.beforeCurrency=e.substring(0,t),this.afterCurrency=e.substr(t+2)},computed:{styleText:function(){var e=this.values.styles.text_size;return{"font-size":FontsFactory.getTextSize(e),"line-height":FontsFactory.getLineHeight(e)}}},methods:{changeTextSize:function(){this.$nextTick(function(){$mx(".autoresize-init").trigger("change")})},prepareValues:function(){var e=this.$clone(this.values);return e.fields=Object.values(e.fields),e},onRemove:function(e){var t=this;this.$confirm(this.$gettext("Вы уверены что хотите удалить этот элемент?"),"is-danger").then(function(){t.values.fields.splice(e,1)})},onAdd:function(){var t=this;this.values.fields.push({title:"",price:null}),this.$nextTick(function(){var e=$mx(t.$refs.fields).find("textarea");e[e.length-1].focus()})}},template:'<section class="modal-card-body modal-card-body-blocks"> <section v-if="currentTab == \'common\'" @click="$parent.scrollToTariff" class="is-toolbar"> <vue-component-font-size-chooser class="toolbar-item toolbar-item-first toolbar-item-last" v-model="values.styles.text_size" :groups="[\'t\']" :disabled="info.is_readonly" @input="changeTextSize"/> </section> <section v-if="currentTab == \'common\'" ref=\'fields\' @click="$parent.scrollToTariff"> <vue-component-sortable-form-fields v-model="values.fields" :current="null" class="block-pricing-title has-mb-2" v-if="values.fields.length"> <template v-slot:title="{ item }"> <span :style="styleText"> <textarea type="text" v-model="item.title" :disabled="info.is_readonly" :style="styleText" class="has-rtl input autoresize-init" :placeholder="\'Текст\'|gettext"></textarea> <span v-html="beforeCurrency" style="font-weight: normal;white-space: pre;"></span> <number type="text" class="input has-text-right input-price autoresize-init" :style="styleText" :precision="$account.currency.precision" v-model="item.price" :disabled="info.is_readonly" :placeholder="0"/> <span v-html="afterCurrency" style="font-weight: normal;white-space: pre;"></span> </span> </template> <template v-slot:action="{ index }"> <a class="is-pulled-right has-text-danger" @click.stop="onRemove(index)" :class="{disabled: info.is_readonly}"><i class="fa fa-trash-alt"></i></a> </template> </vue-component-sortable-form-fields> <button type="button" @click="onAdd" class="button is-light has-text-primary is-fullwidth has-p-3 is-form-adding" :class="{disabled: info.is_readonly}"><i class="fas fa-plus has-mr-2"></i>{{\'Добавить новый пункт\'|gettext}}</button> </section> <section v-if="currentTab == \'options\'" @click="$parent.scrollToTariff"> <vue-pages-blocks-form-options :values.sync="values" :options.sync="options" :info="info"/> </section> <slot></slot> </section>'}),window.$app.defineComponent("pages","vue-pages-blocks-products-breadcrumbs",{props:["values","options","variants","info","block","block_id","tabs","currentTab"],mixins:[FormModel],created:function(){this.block.title=this.$gettext("Меню оформления заказа"),this.$emit("update:tabs",[{name:"common",title:"Общие"},"options","section"])},methods:{prepareValues:function(){return this.values}},template:'<section class="modal-card-body modal-card-body-blocks"> <section v-if="currentTab == \'common\'"> </section> <section v-if="currentTab == \'options\'"> <vue-pages-blocks-form-options :values.sync="options" :info="info"/> </section> <slot></slot> </section>'}),window.$app.defineComponent("pages","vue-pages-blocks-products-checkout",{props:["values","options","variants","info","block","block_id","tabs","currentTab"],mixins:[FormModel],created:function(){this.block.title=this.$gettext("Оформления заказа"),this.$emit("update:tabs",[{name:"common",title:"Общие"},"options","section"])},methods:{prepareValues:function(){return this.values}},template:'<section class="modal-card-body modal-card-body-blocks"> <section v-if="currentTab == \'common\'"> </section> <section v-if="currentTab == \'options\'"> <vue-pages-blocks-form-options :values.sync="options" :info="info"/> </section> <slot></slot> </section>'}),window.$app.defineComponent("pages","vue-pages-blocks-products-collections",{props:["values","options","variants","info","block","block_id","tabs","currentTab"],mixins:[FormModel],created:function(){this.block.title=this.$gettext("Список коллекций"),this.$emit("update:tabs",[{name:"common",title:"Общие"},"options","section"])},methods:{prepareValues:function(){return this.values}},template:'<section class="modal-card-body modal-card-body-blocks"> <section v-if="currentTab == \'common\'"> </section> <section v-if="currentTab == \'options\'"> <vue-pages-blocks-form-options :values.sync="options" :info="info"/> </section> <slot></slot> </section>'}),window.$app.defineComponent("pages","vue-pages-blocks-products-description",{props:["values","options","variants","info","block","block_id","tabs","currentTab"],mixins:[FormModel],created:function(){this.block.title=this.$gettext("Описание товара"),this.$emit("update:tabs",[{name:"common",title:"Общие"},"options","section"])},methods:{prepareValues:function(){return this.values}},template:'<section class="modal-card-body modal-card-body-blocks"> <section v-if="currentTab == \'common\'"> </section> <section v-if="currentTab == \'options\'"> <vue-pages-blocks-form-options :values.sync="options" :info="info"/> </section> <slot></slot> </section>'}),window.$app.defineComponent("pages","vue-pages-blocks-products-feed",{props:["values","options","variants","info","block","block_id","tabs","currentTab"],mixins:[FormModel],created:function(){this.block.title=this.$gettext("Список товаров"),this.$emit("update:tabs",[{name:"common",title:"Общие"},"options","section"])},methods:{prepareValues:function(){return this.values}},template:'<section class="modal-card-body modal-card-body-blocks"> <section v-if="currentTab == \'common\'"> </section> <section v-if="currentTab == \'options\'"> <vue-pages-blocks-form-options :values.sync="options" :info="info"/> </section> <slot></slot> </section>'}),window.$app.defineComponent("pages","vue-pages-blocks-products-filters",{props:["values","options","variants","info","block","block_id","tabs","currentTab"],mixins:[FormModel],created:function(){this.block.title=this.$gettext("Поиск по товарам"),this.$emit("update:tabs",[{name:"common",title:"Общие"},"options","section"])},methods:{prepareValues:function(){return this.values}},template:'<section class="modal-card-body modal-card-body-blocks"> <section v-if="currentTab == \'common\'"> </section> <section v-if="currentTab == \'options\'"> <vue-pages-blocks-form-options :values.sync="options" :info="info"/> </section> <slot></slot> </section>'}),window.$app.defineComponent("pages","vue-pages-blocks-products-header",{props:["values","options","variants","info","block","block_id","tabs","currentTab"],mixins:[FormModel],created:function(){this.block.title=this.$gettext("Заголовок товара"),this.$emit("update:tabs",[{name:"common",title:"Общие"},"options","section"])},methods:{prepareValues:function(){return this.values}},template:'<section class="modal-card-body modal-card-body-blocks"> <section v-if="currentTab == \'common\'"> </section> <section v-if="currentTab == \'options\'"> <vue-pages-blocks-form-options :values.sync="options" :info="info"/> </section> <slot></slot> </section>'}),window.$app.defineComponent("pages","vue-pages-blocks-products-offers",{props:["values","options","variants","info","block","block_id","tabs","currentTab"],mixins:[FormModel],created:function(){this.block.title=this.$gettext("Варианты товара"),this.$emit("update:tabs",[{name:"common",title:"Общие"},"options","section"])},methods:{prepareValues:function(){return this.values}},template:'<section class="modal-card-body modal-card-body-blocks"> <section v-if="currentTab == \'common\'"> </section> <section v-if="currentTab == \'options\'"> <vue-pages-blocks-form-options :values.sync="options" :info="info"/> </section> <slot></slot> </section>'}),window.$app.defineComponent("pages","vue-pages-blocks-products-options",{props:["values","options","variants","info","block","block_id","tabs","currentTab"],mixins:[FormModel],created:function(){this.block.title=this.$gettext("Опции товара"),this.$emit("update:tabs",[{name:"common",title:"Общие"},"options","section"])},methods:{prepareValues:function(){return this.values}},template:'<section class="modal-card-body modal-card-body-blocks"> <section v-if="currentTab == \'common\'"> </section> <section v-if="currentTab == \'options\'"> <vue-pages-blocks-form-options :values.sync="options" :info="info"/> </section> <slot></slot> </section>'}),window.$app.defineComponent("pages","vue-pages-blocks-products-pictures",{props:["values","options","variants","info","block","block_id","tabs","currentTab"],mixins:[FormModel],created:function(){this.block.title=this.$gettext("Картинки товара"),this.$emit("update:tabs",[{name:"common",title:"Общие"},"options","section"])},methods:{prepareValues:function(){return this.values}},template:'<section class="modal-card-body modal-card-body-blocks"> <section v-if="currentTab == \'common\'"> </section> <section v-if="currentTab == \'options\'"> <vue-pages-blocks-form-options :values.sync="options" :info="info"/> </section> <slot></slot> </section>'}),window.$app.defineComponent("pages","vue-pages-blocks-socialnetworks",{props:["values","options","parent","variants","info","block","block_id","block_type_id","tabs","currentTab","section"],mixins:[FormModel],data:function(){return{current:-1,addons_values:null,mode:"edit",selected:[]}},created:function(){this.block.title=this.$gettext("Социальные сети"),this.$emit("update:tabs",[{name:"common",title:this.$gettext("Ссылки")},"options","statistics","section","addons"]),this.values.items.length||this.setMode("choose")},computed:{items:function(){var s={};return _.each(this.variants.list,function(e){_.each(e.items,function(e,t){return s[t]=e})}),s},samples:function(){var t=this,s=_.map(this.values.items,function(e){return null!=t.items[e.n].icon?t.items[e.n].icon:e.n}).reverse();return _.sortBy(_.map(this.items,function(e,t){return{i:null!=e.icon?e.icon:t,t:e.title}}),function(e,t){return s.indexOf(t.i)-s.indexOf(e.i)})}},watch:{values:{handler:function(){this.values.items.length||this.setMode("choose")},deep:!0}},methods:{deleteItem:function(e){var t=this;this.$confirm(this.$format(this.$gettext("Вы уверены что хотите удалить {1}?"),this.items[this.values.items[e].n].title),"is-danger").then(function(){t.values.items.splice(e,1)})},icon:function(e){var t=this.items[e];return null!=t.icon?t.icon:e},iconPaths:function(e){var t=this.items[e],s="";if(null!=t.icon_paths)for(i=1;i<=t.icon_paths;i++)s+='<em class="p'+i+'"></em>';return s},setMode:function(e){var i=this;switch(e){case"choose":this.selected=_.map(this.values.items,"n");break;case"edit":var t=_.map(this.values.items,"n");_.each(this.selected,function(e){var s;-1==t.indexOf(e)&&(s={n:e,t:"",v:""},null!=i.items[e].checkboxes&&_.each(i.items[e].checkboxes,function(e,t){s[t]=!1}),i.values.items.push(s))}),_.each(t,function(e){var t;-1==i.selected.indexOf(e)&&(t=_.map(i.values.items,"n"),i.values.items.splice(t.indexOf(e),1))})}this.mode=e},selectItem:function(e){-1!=this.selected.indexOf(e)||(this.selected.push(e),this.setMode("edit"),this.current=this.selected.length-1)},prepareValues:function(){var e=this.$clone(this.values);return"custom"!=e.socials_style.design&&(e.socials_style.colors={bg:null,text:null,icon:null}),e},getError:function(e,t){return this.errors[e]?this.errors[e][t]:null}},template:'<section class="modal-card-body modal-card-body-blocks"> <section v-if="info.is_readonly && (currentTab == \'common\')" class="message is-warning"> <div class="message-body">{{\'Добавьте кнопки на другие социальные сети\'|gettext}}</div> </section> <section class="is-static is-toolbar" v-if="currentTab == \'common\' && values.items.length && (mode == \'edit\')" @click="$parent.scrollToTariff"> <div class="component-group toolbar-item toolbar-item-first toolbar-item-last"> <vue-pages-blocks-socials-style v-model="values.socials_style" :section="section" :items="samples"/> </div> </section> <section class="is-static" v-if="currentTab == \'common\' && values.items.length && (mode == \'choose\')" @click="$parent.scrollToTariff"> <div class="row row-small"> <div class="col-xs" v-if="mode == \'choose\'" style="align-self: center"> <span v-if="mode == \'choose\'"><b>{{\'Выберите социальную сеть\'|gettext}}</b></span> </div> <div class="col-xs col-shrink"> <button class="button is-dark" @click="mode = \'edit\'"><i class="fa fa-long-arrow-left has-mr-1"></i>{{\'Назад\'|gettext}}</button> </div> </div> </section> <section v-if="currentTab == \'common\' && mode== \'choose\'" @click="$parent.scrollToTariff"> <div v-for="(w, i) in variants.list"> <h4 class="has-mb-1" :class="{\'has-mt-2\': i}">{{w.group}}</h4> <div class="select-list row row-small"> <label v-for="(item, index) in w.items" class="col-xs-6 col-sm-4 has-mb-2" :class="{in: selected.indexOf(index) != -1, disabled: info.is_readonly}"><span :class="[\'btn-socials is-shape-brand is-design-brand is-service-\'+icon(index)]" @click="selectItem(index)"><i :class="\'fa fab fa-\'+icon(index)" v-html="iconPaths(index)"></i><div>{{item.title}}</div></span></label> </div> </div> </section> <section v-if="currentTab == \'common\' && mode== \'edit\'" @click="$parent.scrollToTariff"> <vue-component-sortable-form-fields v-model="values.items" class="has-mb-2" :current.sync="current"> <template v-slot:title="{ item }"> <span>{{items[item.n].title}}</span> </template> <template v-slot:action="{ index }"> <a class="is-pulled-right has-text-danger" @click.stop="deleteItem(index)"><i class="fa fa-trash-alt"></i></a> </template> <template v-slot:form="{ item, index }"> <b-field :label="\'Текст ссылки\'|gettext"> <input v-model="item.t" class="input" :placeholder="items[item.n].p" :disabled="info.is_readonly" v-focus> </b-field> <b-field :label="items[item.n].v" :message="getError(item.n, \'link\')" :class="{\'has-error\': getError(item.n, \'link\')}"> <mx-phone v-model="item.v" v-if="item.n == \'phone\'" :disabled="info.is_readonly" classname="input"/> <input v-model="item.v" v-else class="input" :disabled="info.is_readonly"> </b-field> <div v-if="items[item.n].checkboxes"> <div v-for="(c, ci) in items[item.n].checkboxes"> <b-checkbox v-model="item[ci]" :disabled="info.is_readonly">{{c}}</b-checkbox> </div> </div> </template> </vue-component-sortable-form-fields> <button type="button" class="button is-light has-text-primary is-fullwidth has-p-3 is-form-adding" @click="setMode(\'choose\')" :class="{disabled: _.size(values.items)>= _.size(items)}"><i class="fas fa-plus has-mr-2"></i>{{\'Добавить новый пункт\'|gettext}}</button> </section> <section v-if="currentTab == \'options\'" @click="$parent.scrollToTariff"> <vue-pages-blocks-form-options :values.sync="values" :options.sync="options" :info="info"></vue-pages-blocks-form-options> </section> <slot></slot> </section>'}),window.$app.defineComponent("pages","vue-pages-blocks-socials-style-colors",{data:function(){return{colorPickerOpened:!1}},props:{colors:Object,shape:String,value:String},methods:{activeChange:function(e){this.$emit("active-change",e)},activeChangeColorpicker:function(e){this.colorPickerOpened=e,this.$emit("update:colors",this.colors)},click:function(e){($mx(e.target).is(".socials-style-color")||$mx(e.target).find(".socials-style-color").length)&&this.$refs.dropdown.toggle()}},template:'<div :class="{in: $parent.value == value}" @click.prevent="click"> <vue-component-dropdown class="socials-style-color is-fullwidth" :class="{\'is-color-picker-opened\': colorPickerOpened}" ref="dropdown" :title="\'Цвета\'|gettext" button-class="button is-default is-fullwidth" position="is-top-right" :withArrow="false" @active-change="activeChange"> <span slot="button"> <slot></slot> </span> <b-dropdown-item custom style="min-width:300px"> <div v-if="shape == \'icon\'"> <vue-component-colorpicker @active-change="activeChangeColorpicker" v-model="colors.icon" :label="\'Цвет текста кнопки\'|gettext" :colors="[$account.theme.link.color]"/> </div> <div v-else> <vue-component-colorpicker @active-change="activeChangeColorpicker" v-model="colors.bg" :label="\'Цвет фона кнопки\'|gettext" :colors="[$account.theme.link.bg]"/> <vue-component-colorpicker @active-change="activeChangeColorpicker" class="has-mt-2" v-if="[\'square-outline\', \'square-outline\', \'circle-outline\'].indexOf(shape) == -1" v-model="colors.text" :label="\'Цвет текста кнопки\'|gettext" :colors="[$account.theme.link.color]"/> </div> </b-dropdown-item> </vue-component-dropdown> </div>'}),window.$app.defineComponent("pages","vue-pages-blocks-socials-style",{data:function(){return{layouts:["square","compact","full"],shapes:{full:["brand","flat"],compact:["square-fill","square-outline"],square:["square-fill","square-outline","circle-fill","circle-outline","icon"]},designs:{theme:this.$gettext("Дизайн"),brand:this.$gettext("Бренд"),custom:this.$gettext("Выбрать")}}},props:{value:Object,section:Object,disabled:Boolean,colorPickerOpened:!1,items:Object},watch:{value:{handler:function(){this.$emit("input",this.value)},deep:!0}},computed:{stylePreview:function(){return{"min-width":"375px",background:null!=this.section.bg?this.section.bg.color1:this.$account.theme.bg.color1,"pointer-events":"none"}},styleIcon:function(){var e={},t=this.section?StylesFactory.restoreSection(this.section,this.$account.theme):null;return t&&t.link.transparent&&(e["--link-border-width"]=t.link.border.width+"px"),"theme"==this.value.design&&t&&(e["--link-background-digs"]=hexToRgb(t.link.bg),e["--link-background"]=transparentColor(t.link.transparent,t.link.bg),e["--link-border-color"]=t.link.bg,e["--color-text"]=t.link.color,e["--icon-text"]=t.text.color),"custom"==this.value.design&&(e["--link-background-digs"]=hexToRgb(this.value.colors.bg),e["--link-background"]=transparentColor(t?t.link.transparent:this.$account.theme.link.transparent,this.value.colors.bg),e["--link-border-color"]=this.value.colors.bg,e["--color-text"]=this.value.colors.text,e["--icon-text"]=this.value.colors.icon),e},isFlat:function(){return"full"==this.value.layout&&"flat"==this.value.shape},sample:function(){return"full"==this.value.layout?this.items.slice(0,1):this.items.slice(0,2)}},methods:{activeChangeColorpicker:function(e){this.colorPickerOpened=e,this.value.design="custom"},styleDesign:function(e){switch(e){case"custom":return"icon"==this.value.shape?{"--color-fore":this.value.colors.icon}:{"--color-fore":this.value.colors.bg,"--color-back":this.value.colors.text};case"theme":var t=this.section?StylesFactory.restoreSection(this.section,this.$account.theme):null;return"icon"==this.value.shape?{"--color-fore":t.text.color}:{"--color-fore":t.link.bg,"--color-back":t.link.color}}},checkShape:function(){-1==this.shapes[this.value.layout].indexOf(this.value.shape)&&(this.value.shape=this.shapes[this.value.layout][0])},linkClass:function(e){return["button btn-link is-service-"+e,"is-layout-"+this.value.layout,this.isFlat?null:"btn-socials","is-shape-"+this.value.shape,"is-design-"+this.value.design,"full"==this.value.layout?"btn-link-styled":null]}},template:'<vue-component-dropdown class="is-socials-styles is-fullwidth" :class="{\'is-color-picker-opened\': colorPickerOpened}" :disabled="disabled" ref="dropdown" :title="\'Внешний вид\'|gettext" button-class="button is-default is-fullwidth"> <span slot="button"><i class="fas fa-palette has-mr-2 has-text-grey-light"></i>{{\'Внешний вид\'|gettext}}</span> <b-dropdown-item custom class="is-hidden-mobile"> <label class="label">{{\'Предпросмотр\'|gettext}}</label> </b-dropdown-item> <b-dropdown-item custom class="main-theme has-transparent-bg has-mb-2" :style="stylePreview"> <div class="social-style-socials socials block-item"> <div class="row row-small"> <div v-for="item in sample" :class="{\'col-shrink\': value.layout == \'square\', \'col-xs\': value.layout != \'full\', \'col-xs-12\': value.layout == \'full\'}"> <span :class="linkClass(item.i)" :style="styleIcon"> <i :class="\'fa fab fa-\'+item.i" v-if="!isFlat"></i> <div v-if="value.layout == \'full\'">{{item.t}}</div> </span> </div> </div> </div> </b-dropdown-item> <b-dropdown-item custom> <b-field :label="\'Расположение блоков\'|gettext" class="has-mb-2"> <vue-component-toggle-list class="social-style-layout" v-model="value.layout" :items="layouts" @input="checkShape"> <template v-slot="props"> <div :class="\'is-\'+props.value"> <dd></dd><dd></dd> </div> </template> </vue-component-toggle-list> </b-field> <b-field :label="\'Стиль\'|gettext" class="has-mb-2"> <vue-component-toggle-list class="social-style-shape" v-model="value.shape" :items="shapes[value.layout]"> <template v-slot="props"> <div :class="\'is-\'+props.value"> <span :data-layout="value.layout"><em style="-webkit-mask-image:url(/s/icons/icofont/twitter.svg);mask-image: url(/s/icons/icofont/twitter.svg)"></em><i></i></span> </div> </template> </vue-component-toggle-list> </b-field> <b-field :label="\'Цвета\'|gettext"> <vue-component-toggle-list class="social-style-color" v-model="value.design" :items="designs"> <template v-slot="props"> <component v-bind:is="(props.key == \'custom\')?\'vue-pages-blocks-socials-style-colors\':\'div\'" :colors.sync="value.colors" :shape="value.shape" :class="[\'is-\'+props.key]" @active-change="activeChangeColorpicker"> <em :class="\'is-shape-\'+value.shape" :style="styleDesign(props.key)"></em><span>{{props.value}}</span> </component> </template> </vue-component-toggle-list> </b-field> </b-dropdown-item> </vue-component-dropdown>'}),window.$app.defineComponent("pages","vue-pages-blocks-text",{props:["values","options","info","variants","block","block_id","tabs","currentTab","section"],mixins:[FormModel],data:function(){return{text_aligns:{left:this.$gettext("Слева"),center:this.$gettext("По центру"),right:this.$gettext("Справа"),justify:this.$gettext("По обоим краям")},lastDefaultColor:"",lastDefaultFont:"",lastTextSize:"",cached_text_aligns:["left","center"],styles:{bold:!1,italic:!1,strikethrough:!1,underline:!1,color:"#000000"},styles_text:{bold:this.$gettext("Жирный"),italic:this.$gettext("Курсив"),strikethrough:this.$gettext("Зачеркнутый"),underline:this.$gettext("Подчеркнутый")}}},watch:{section:{handler:function(){this.lastDefaultColor==this.values.color&&(this.values.color=this.defaultColor),this.lastDefaultFont==this.values.font&&(this.values.font=this.defaultFont),this.lastDefaultColor=this.defaultColor,this.lastDefaultFont=this.defaultFont},deep:!0},values:{handler:function(e){var t=this.lastTextSize.substr(0,1)!=e.text_size.substr(0,1)&&("h"==this.lastTextSize.substr(0,1)||"h"==e.text_size.substr(0,1));t&&this.lastDefaultFont==this.values.font&&(this.lastDefaultFont=this.values.font=this.defaultFont),t&&this.lastDefaultColor==this.values.color&&(this.lastDefaultColor=this.values.color=this.defaultColor),this.lastTextSize=e.text_size,this.styles.color=e.color},deep:!0}},computed:{isHeading:function(){return"h"==this.values.text_size.substr(0,1)},bg:function(){return null!=this.section.bg?this.section.bg.color1:this.$account.theme.bg.color1},color:function(){return this.values.color?this.values.color:this.defaultColor},font:function(){return""!==this.values.font?this.values.font:this.defaultFont},s:function(){return this.isHeading?this.section.heading:this.section.text},t:function(){return this.isHeading?this.$account.theme.heading:this.$account.theme.screen},defaultColor:function(){return null!=this.s&&null!=this.s.color?this.s.color:this.t.color},defaultFont:function(){return null!=this.s&&null!=this.s.font?this.s.font:this.t.font},weight:function(){var e=this.section.heading,t=this.$account.theme.heading;return FontsFactory.getWeight(this.font,null!=e&&null!=e.weight?e.weight:t.weight)},style:function(){return{"font-family":this.values.font?globalFontsFallback[this.font]:null,"text-transform":(this.isHeading?FontsFactory.getTransform((this.section.heading?this.section.heading:this.$account.theme.heading).transform):"none")+" !important","font-weight":(this.isHeading?this.weight:400)+" !important","line-height":FontsFactory.getLineHeight(this.values.text_size)+" !important","text-align":this.values.text_align+" !important","font-size":FontsFactory.getTextSize(this.values.text_size)+" !important",color:this.color,background:this.color!=this.bg?this.bg:null}}},created:function(){this.block.title=this.$gettext("Текст"),this.values.color||(this.values.color=this.defaultColor),""===this.values.font&&(this.values.font=this.defaultFont),null==this.block_id&&"rtl"==this.$account.locale.text_direction&&(this.values.text_align="right"),this.values.text=this.values.text.replace(/\n/g,"<br>"),this.cached_text_aligns[this.isHeading?1:0]=this.values.text_align,this.lastTextSize=this.values.text_size,this.lastDefaultColor=this.defaultColor,this.lastDefaultFont=this.defaultFont,this.$emit("update:tabs",[{name:"common",title:this.$gettext("Текст")},"options","section"])},methods:{colorChanged:function(e){var t=this.$refs.text;t.isEmptyRange?this.values.color=e:t.changeColor(this.color==e?null:e)},textCommand:function(e){this.$refs.text.changeState(e)},changedTextAlign:function(e){this.cached_text_aligns[this.isHeading?1:0]=e},prepareValues:function(){var e=this.$clone(this.values);return e.text=e.text.replace(/<br>/g,"\n").trim(),e.color==this.defaultColor&&(e.color=""),e.font==this.defaultFont&&(e.font=""),e}},template:'<section class="modal-card-body modal-card-body-block-text modal-card-body-blocks"> <section v-if="currentTab == \'common\'" class="is-toolbar is-paddingless is-paddingless-mobile"> <vue-component-font-size-chooser class="toolbar-item toolbar-item-first" v-model="values.text_size" :disabled="info.is_readonly"/> <div class="component-group toolbar-item"> <vue-component-font-chooser v-model="values.font" :fullwidth="true" :default-font="defaultFont" position="is-bottom-right"/> <b-field class="is-hidden-mobile"> <b-radio-button @input="changedTextAlign" v-model="values.text_align" v-for="(t, v) in text_aligns" type="has-text-primary" class="is-expanded" :native-value="v" :disabled="info.is_readonly"><i :class="\'fa fa-align-{1}\'|format(v)"></b-radio-button> </b-field> <vue-component-dropdown class="toolbar-item is-hidden-tablet" v-model="values.text_align" :disabled="info.is_readonly" :title="\'Выравнивание текста\'|gettext" button-class="button is-focusable"> <i :class="\'fa fa-align-{1}\'|format(values.text_align)" slot="button"></i> <b-dropdown-item aria-role="listitem" v-for="(t, v) in text_aligns" :value="v"><i class="has-mr-1" :class="\'fa fa-align-{1}\'|format(v)"></i>{{t}}</b-dropdown-item> </vue-component-dropdown> <div class="toolbar-separator is-hidden-mobile"></div> <b-field class="is-hidden-mobile"> <b-checkbox-button v-for="(v, k) in styles" v-if="styles_text[k]" v-model="v" type="has-text-primary" :native-value="true" @input="textCommand(k)"><i :class="\'fa fa-\'+k" :style="(k == \'underline\')?\'top: 1px;position: relative;\':null"></i></b-checkbox-button> </b-field> <vue-component-dropdown class="toolbar-item is-hidden-tablet" :disabled="info.is_readonly" :title="\'Формат\'|gettext" button-class="button is-focusable"> <span slot="button" :style="{\'font-weight\': styles.bold?\'bold\':null, \'font-style\': styles.italic?\'italic\':null, \'text-decoration\': (styles.strikethrough?\'line-through\':\'\')+(styles.underline?\' underline\':\'\')}">T</span> <b-dropdown-item aria-role="listitem" v-for="(v, k) in styles" v-if="styles_text[k]" :class="{\'is-active\': v}" @click="textCommand(k)"><i class="has-mr-1" :class="\'fa fa-\'+k"></i>{{styles_text[k]}}</b-dropdown-item> </vue-component-dropdown> <vue-component-colorpicker class="toolbar-item toolbar-item-last" v-model="styles.color" :disabled="info.is_readonly" :colors="[defaultColor]" design="circle" :with-arrow="true" @input="colorChanged"/> </div> </section> <section v-if="currentTab == \'common\'"> <vue-component-richtext :stylesheet="style" v-model="values.text" :disabled="info.is_readonly" :styles.sync="styles" ref="text"/> </section> <section v-if="currentTab == \'options\'"> <vue-pages-blocks-form-options :values.sync="values" :options.sync="options" :info="info"/> </section> <slot></slot> </section>'}),window.$app.defineComponent("pages","vue-pages-blocks-timer",{data:function(){return{weekdays:this.$getDaysNames(),months:this.$getMonthsNames(),first_day_week:this.$getFirstDayWeek()}},props:["values","options","variants","info","block","block_id","tabs","currentTab"],mixins:[FormModel],computed:{date:{get:function(){return this.values.timer[1].date?new Date(this.values.timer[1].date):null},set:function(e){this.values.timer[1].date=e?date_format("Y-m-d",e):null}},time:{get:function(){if(this.values.timer[1].time){var e=this.values.timer[1].time.split(":");return new Date(0,0,0,e[0],e[1])}return null},set:function(e){this.values.timer[1].time=e?date_format("H:i",e):null}},timeEveryday:{get:function(){if(this.values.timer[3].time){var e=this.values.timer[3].time.split(":");return new Date(0,0,0,e[0],e[1])}return null},set:function(e){this.values.timer[3].time=e?date_format("H:i",e):null}}},created:function(){this.block.title=this.$gettext("Таймер обратного отсчета"),this.$emit("update:tabs",[{name:"common",title:this.$gettext("Таймер")},"options","section"])},methods:{prepareValues:function(){return this.values}},template:'<section class="modal-card-body modal-card-body-blocks"> <section v-if="info.is_readonly && (currentTab == \'common\')" class="message is-warning"> <div class="message-body">{{\'Добавьте таймер обратного отсчета для временного ограничения — успеть поучаствовать в акции, записаться на курс и т.д.\'|gettext}}</div> </section> <section v-if="currentTab == \'common\'" @click="$parent.scrollToTariff"> <b-field :label="\'Тип таймера\'|gettext"> <b-select v-model="values.type" :disabled="info.is_readonly" expanded> <option v-for="(v, k) in variants.type" :value="k">{{v}}</option> </b-select> </b-field> <div v-if="values.type == 1"> <div class="message is-info" v-if="!info.is_readonly"> <div class="message-body">{{\'Укажите дату и время окончания отсчета\'|gettext}}</div> </div> <div class="row"> <div class="col-xs-8"> <b-field :label="\'Дата\'|gettext" :message="errors.tms_1" :class="{\'has-error\': errors.tms_1}"> <div class="has-feedback"> <b-datepicker v-model="date" icon="calendar-alt" :disabled="info.is_readonly" :day-names="weekdays" :month-names="months" :first-day-of-week="first_day_week"></b-datepicker> <a class="form-control-feedback has-text-grey-light" @click="date = null" :class="{disabled: info.is_readonly}"><i class="fal fa-times"></i></a> </div> </b-field> </div> <div class="col-xs-4"> <label class="label">{{\'Время\'|gettext}}:</label> <div class="has-feedback"> <b-clockpicker v-model="time" :disabled="info.is_readonly" hour-format="24"></b-clockpicker> <a class="form-control-feedback has-text-grey-light" @click="time = null" :class="{disabled: info.is_readonly}"><i class="fal fa-times"></i></a> </div> </div> </div> </div> <div v-if="values.type == 2"> <div class="message is-info"><div class="message-body">{{\'Таймер будет запущен при первом посещении страницы клиентом. Укажите длительность таймера.\'|gettext}}</div></div> <b-field :message="errors.tms_2" :class="{\'has-error\': errors.tms_2}"> <div class="row has-mb-3"> <div class="col-xs-4 col-sm-3"> <label class="label">{{\'Дни\'|gettext}}:</label> <input type=\'number\' v-model=\'values.timer[2].days\' class=\'input\' placeholder="0" maxlength="3" :disabled="info.is_readonly" min="1" max="99"> </div> <div class="col-xs-4 col-sm-3"> <label class="label">{{\'Часы\'|gettext}}:</label> <input type=\'number\' v-model=\'values.timer[2].hours\' class=\'input\' placeholder="00" maxlength="2" :disabled="info.is_readonly" min="1" max="24"> </div> <div class="col-xs-4 col-sm-3"> <label class="label">{{\'Минуты\'|gettext}}:</label> <input type=\'number\' v-model=\'values.timer[2].minutes\' class=\'input\' placeholder="00" maxlength="2" :disabled="info.is_readonly" min="1" max="60"> </div> </div> </b-field> <b-field :label="\'Через сколько дней сбрасывать таймер\'|gettext" :message="errors.expires_2" :class="{\'has-error\': errors.expires_2}"> <div class="row"> <div class="col-xs-4 col-sm-3"> <input type=\'number\' v-model=\'values.timer[2].expires\' class=\'input\' placeholder="0" maxlength="3" :disabled="info.is_readonly"> </div> </div> </b-field> </div> <div v-if="values.type == 3"> <div class="message is-info"><div class="message-body">{{\'Таймер будет перезапускаться каждый день. Укажите время окончания таймера.\'|gettext}}</div></div> <b-field :label="\'Время\'|gettext" :message="errors.tms_3" :class="{\'has-error\': errors.tms_3}"> <div class="row"> <div class="col-md-3 col-sm-4 col-xs-6"> <div class="has-feedback"> <b-clockpicker v-model="timeEveryday" :disabled="info.is_readonly" hour-format="24"></b-clockpicker> <a class="form-control-feedback has-text-grey-light" @click="timeEveryday = null" :class="{disabled: info.is_readonly}"><i class="fal fa-times"></i></a> </div> </div> </div> </b-field> </div> </section> <section v-if="currentTab == \'options\'" @click="$parent.scrollToTariff"> <vue-pages-blocks-form-options :values.sync="values" :options.sync="options" :info="info"/> </section> <slot></slot> </section>'}),window.$app.defineComponent("pages","vue-pages-blocks-video",{props:["values","options","info","variants","block","block_id","tabs","currentTab"],mixins:[FormModel],created:function(){this.block.title=this.$gettext("Видео"),this.$emit("update:tabs",[{name:"common",title:this.block.title},"options","section"])},computed:{provider:function(){return VideoHelper.getProviderName(this.values.url)},providerName:function(){return this.provider?this.provider.p:null},supportServices:function(){return"ru"==i18n.locale?"YouTube, Vimeo, RuTube, VK, TikTok, Twitch":"YouTube, Vimeo, TikTok, Twitch"}},methods:{prepareValues:function(){if(this.provider&&null!=this.provider.parseCode){var e=this.provider.parseCode(this.values.code);if(null==e)return alert(this.$gettext("Укажите код для вставки")),null;this.values.url=e}var t=this.$clone(this.values);return t.poster&&(t.poster=t.poster.picture_id),t}},template:'<section class="modal-card-body modal-card-body-blocks"> <section v-if="info.is_readonly && (currentTab == \'common\')" class="message is-warning"> <div class="message-body">{{\'Вставьте видео для быстрого просмотра прямо на вашу страницу, без перехода на другой сайт\'|gettext}}</div> </section> <section v-if="currentTab == \'common\'" @click="$parent.scrollToTariff"> <b-field :label="\'Ссылка на видео\'|gettext" :message="errors.url" :class="{\'has-error\': errors.url}"> <div class="control"> <input type="text" class="input" v-model="values.url" placeholder=\'http://\' autocorrect="off" autocapitalize="none" :disabled="info.is_readonly"></input> <p class="help has-text-grey" v-if="!errors.url">{{\'Поддерживается {1} и видео формата mp4, m3u8 и webm\'|gettext|format(supportServices)}}</p> </div> </b-field> <transition name="fade"> <vue-component-pictures v-model="values.poster" v-if="providerName == \'file\'" :button-title="\'Загрузить обложку\'|gettext" button-icon="fa fal fa-cloud-upload" updatable class="addon-opengraph-picture has-mb-2"></vue-component-pictures> </transition> <transition name="fade"> <div class="has-mb-2" v-if="provider && provider.isNeedCode && provider.isNeedCode(values.url)"> <b-field :label="\'Код для вставки\'|gettext" :message="errors.code" :class="{\'has-error\': errors.code}"> <textarea v-model="values.code" class="input" rows="4"></textarea> </b-field> </div> </transition> <mx-toggle v-model="values.is_autoplay" :title="\'Автовоспроизведение на компьютере\'|gettext" class="has-mb-2" :disabled="info.is_readonly"></mx-toggle> <mx-toggle v-model="values.is_autohide" :title="\'Скрыть элементы управления\'|gettext" :disabled="info.is_readonly"></mx-toggle> </section> <section v-if="currentTab == \'options\'" @click="$parent.scrollToTariff"> <vue-pages-blocks-form-options :values.sync="values" :options.sync="options" :info="info"/> </section> <slot></slot> </section>'}),window.$app.defineComponent("pages","vue-pages-choose-form",{data:function(){return{mainPage:null,isFetching:!1,isMainpageChanging:!1,values:{pages:[]}}},props:["is_readonly"],created:function(){this.fetchData(!0)},methods:{onAction:function(e){switch(e){case"change":this.mainPage=this.$account.page_id,this.isMainpageChanging=!0}},saveMainpage:function(){var t=this;this.$account.page_id!=this.mainPage?this.$api.get("pages/changemainpage",{page_id:this.mainPage},this).then(function(e){t.$account.page_id=t.mainPage,t.isFetching=!1,t.isMainpageChanging=!1}):this.isMainpageChanging=!1},fetchData:function(e){var t=this;this.isFetching=e,this.$api.get("pages/list").then(function(e){t.isFetching=!1,t.values.pages=e.response.pages})},openPage:function(e){this.$router.replace({name:"pages",params:{page_id:e}}),this.$parent.close()},newPage:function(){this.$modal("vue-pages-page-form",null,this),this.$parent.close()}},template:'<div class="modal-card"> <header class="modal-card-head"> <p class="modal-card-title" v-if="isMainpageChanging">{{\'Смена главной страницы\'|gettext}}</p> <p class="modal-card-title" v-else>{{\'Страницы\'|gettext}}</p> <button class="modal-close is-large" @click="$parent.close()"></button> </header> <section class="modal-card-body modal-card-body-blocks"> <div class="modal-pages-list"> <div v-if="isMainpageChanging"> <label class="item radio" v-for="f in values.pages"> <input type="radio" v-model="mainPage" :value="f.page_id"> <span v-if="f.title">{{f.title}}</span><span v-else class="has-text-grey">{{\'Без имени\'|gettext}}</span> </label> </div> <div v-else> <a class="item" @click="newPage" v-if="!is_readonly"><i class="fa fal fa-plus"></i> {{\'Создать новую страницу\'|gettext}}</a> <div class="modal-pages-list-hr" v-if="values.pages.length"></div> <a class="item" @click="openPage(f.page_id)" v-for="f in values.pages"> <i class="fa fal fa-mobile-android"></i> <span v-if="f.title">{{f.title}}</span><span v-else class="has-text-grey">{{\'Без имени\'|gettext}}</span> <span class="tag is-rounded is-success is-pulled-right" v-if="$account.page_id == f.page_id">{{\'Главная страница\'|gettext}}</span> </a> </div> </div> </section> <footer class="modal-card-foot level"> <div class="level-left"> <vue-component-action-button @action="onAction" v-if="!isMainpageChanging && !is_readonly" :title="\'Действие\'|gettext"> <template slot="actions"> <b-dropdown-item value="change"><i class="fa fa-home"></i> {{\'Сменить главную страницу\'|gettext}}</b-dropdown-item> </template> </vue-component-action-button> </div> <div class="level-right" v-if="isMainpageChanging"> <button class="button is-dark" type="button" @click="isMainpageChanging = false" :disabled="isFetching">{{\'Отмена\'|gettext}}</button> <button class="button is-primary" type="button" @click="saveMainpage" :disabled="isFetching">{{\'Сохранить\'|gettext}}</button> </div> <div class="level-right" v-else> <button class="button is-dark" type="button" @click="$parent.close()">{{\'Закрыть\'|gettext}}</button> </div> </footer> <b-loading :is-full-page="false" :active.sync="isFetching"></b-loading> </div>'}),window.$app.defineComponent("pages","vue-pages-page-blocks",{props:{isViewMode:Boolean,page_id:Number,theme:Object,readonly:Boolean,account:Object,pageData:Object,canNavigate:Boolean,canSelect:Boolean,selected:{type:Array,default:[]},isSelectMode:Boolean,showHidden:{type:Boolean,default:!0},showReorder:{type:Boolean,default:!0},allowWelcome:Boolean,mustchange:Array,pageOptions:{default:{}}},data:function(){return{selectingBlockId:null}},computed:{accountData:function(){return this.account?Object.assign({},this.$account,this.account):this.$account},showWelcome:function(){return this.allowWelcome&&this.data.blocks_order.length<2&&0==(16&this.$account.tips_bits)},scrollContainer:function(){return this.$device.mobile?$mx(".main-block")[0]:document.scrollingElement||document.documentElement},data:function(){return this.pageData?this.pageData:this.$page.data},sections:function(){var e=null,t=[],s={blocks:[]};for(i=0;i<this.data.blocks_order.length;i++){var a=this.data.blocks[this.data.blocks_order[i]];null!=a&&(a.section_id!=e&&(s.blocks.length&&t.push(s),s={section_id:a.section_id,blocks:[]}),s.blocks.push({i:i,block_id:a.block_id}),e=a.section_id)}return s.blocks.length&&t.push(s),t.length&&t[0].section_id&&t.unshift({section_id:null,bg:null,bg_layer:null,blocks:[]}),t},is_readonly:function(){return this.data.page.is_readonly||this.readonly}},methods:{selectBlock:function(e){var t=this.selected.indexOf(e);-1==t?this.selected.push(e):this.selected.splice(t,1)},blockLongPress:function(e){this.canSelect&&this.$device.mobile&&(this.$emit("long-press",{block_id:e}),this.selectingBlockId=null)},blockPreLongPress:function(e){this.canSelect&&!this.isSelectMode&&this.$device.mobile&&(this.selectingBlockId=e)},isVisible:function(e){return e.is_visible&&this.$auth.isAllowTariff(e.tariff)},iconPaths:function(e){var t="";if(null!=e.ip)for(i=1;i<=e.ip;i++)t+='<em class="p'+i+'"></em>';return t},helperClass:function(e){e.resolve($mx(e.node).closest(".blocks-section")[0].className.replace("blocks-section",""))},newBlock:function(){this.$modal("vue-pages-blocks-form-modal",{page_id:this.page_id},this)},openForm:function(e){if(this.isSelectMode)return this.selectBlock(e);this.selectingBlockId=null;var t=this.data.blocks[e];this.is_readonly&&"link"==t.block_type_name&&"page"==t.options.type&&t.options.value?this.$router.push({name:"pages",params:{page_id:t.options.value}}):this.is_readonly||this.$modal("vue-pages-blocks-form-modal",{page_id:this.page_id,block_id:e},this)},addLinkPage:function(e,t){this.$modal("vue-pages-page-form",{values:{block_id:e,title:t}},this)},sectionHandleDown:function(e,c){var a=this,o=$mx(".main-block"),d=o[0].scrollTop,r=$mx(e.target).addClass("in"),p=r.position().top,u=e.touches?e.touches[0].pageY+d:e.pageY,l=this.data;var m=function(a){var o={before:[],after:[]};_.each($mx.makeArray(r.closest(".blocks-list").find(".section-main > div > .block-item")),function(e){var t=$mx(e),s=e.className.match(/\bb-([0-9a-z]+)/)[1],i={b:l.blocks[s],y:t.offset().top+.5*t.outerHeight()};o[a<i.y?"after":"before"].push(i)}),o.before=o.before.reverse();for(var e=o.before.length?o.before[0].b.section_id:null,t=o.after.length?o.after[0].b.section_id:null,s=0,s=0;s<o.before.length&&o.before[s].b.section_id==e;s++);for(o.before.splice(e?s-1:s),s=0;s<o.after.length&&o.after[s].b.section_id==t;s++);return o.after.splice(t?s-1:s),o}(u);r.css("top",p);var v=this.sections,h={};function n(e){var t=e.touches?e.touches[0].pageY+d:e.pageY;e.preventDefault();if(u<t){for(var s=0;s<m.after.length;s++){var i=m.after[s].b;m.after[s].y<t?i.section_id=v[c].section_id:i.section_id=h[i.block_id]}var a=m.after.length?m.after[m.after.length-1].y+8:u,t=Math.min(t,a)}else{for(var o=0;o<m.before.length;o++){var l=m.before[o].b;m.before[o].y>t?l.section_id=null!=v[c+1]?v[c+1].section_id:null:l.section_id=h[l.block_id]}var n=m.before.length?m.before[m.before.length-1].y-8:u;t=Math.max(t,n)}r.css("top",p+(t-u))}_.each(l.blocks,function(e,t){return h[t]=e.section_id}),o.on("mousemove touchmove",n),o.one("mouseup touchend",function(e){o.off("mousemove touchmove",n);var s={};_.each(h,function(e,t){e&&(null==s[e]&&(s[e]=[]),s[e].push(t))});var t={};_.each(a.data.blocks,function(e){e.section_id&&(null==t[e.section_id]&&(t[e.section_id]=[]),t[e.section_id].push(e.block_id))});var i={};_.each(t,function(e,t){null==s[t]||_.isEqual(e,s[t])||(i[t]=e)}),_.size(i)&&(Vue.prototype.$page.isUpdating=!0,a.$api.post("pages/sections",{page_id:a.page_id,modified:i},null,"sections").then(function(e){Vue.prototype.$page.isUpdating=!1,"fail"==e.result&&a.$page.fetchData(a.page_id,!0)}),a.$emit("sectionsChanged")),r.removeClass("in"),r.css("top",null)})},sortStart:function(e){this.$emit("sortStart",this.data.blocks_order[e.index])},sortMove:function(){},sortEnd:function(e){var t,s,i,a,o,l,n,c=this,d=this.data.blocks_order[e.oldIndex];e.oldIndex!=e.newIndex&&(s=-1!=(t=e.oldIndex<e.newIndex?e.newIndex:e.newIndex?e.newIndex-1:-1)?this.data.blocks_order[t]:null,0<_.size(this.data.sections)&&(i=this.data.blocks[this.data.blocks_order[e.oldIndex]].section_id,a=null!=this.data.blocks[s]?this.data.blocks[s].section_id:null,o=null!=this.data.blocks[this.data.blocks_order[t+1]]?this.data.blocks[this.data.blocks_order[t+1]].section_id:null,i!=a&&i!=o&&(a&&a==o?this.data.blocks[this.data.blocks_order[e.oldIndex]].section_id=a:(l=this.data.blocks[this.data.blocks_order[e.oldIndex]].section_id,n=0,_.each(this.data.blocks,function(e){n+=l==e.section_id?1:0}),1<n&&(this.data.blocks[this.data.blocks_order[e.oldIndex]].section_id=null)))),Vue.prototype.$page.isUpdating=!0,this.$api.post("pages/resort",{page_id:this.page_id,id:d,after:s},null,"resort").then(function(e){Vue.prototype.$page.isUpdating=!1,"fail"==e.result&&c.$page.fetchData(c.page_id,!0)})),this.$emit("sortEnd",d)}},template:'<div class="theme-main" :class="StylesFactory.getPageClasses(theme)"> <div v-if="theme && theme.extended"><div v-for="a in theme.extended.items" v-html="a.html"></div></div> <sortable-list class="blocks-list" :class="[{\'is-select-mode\': isSelectMode, \'has-hide-reorder\': !showReorder || is_readonly}, \'valign-\'+((pageOptions && pageOptions.valign != undefined)?pageOptions.valign:\'top\')]" :style="{\'flex-grow\':showWelcome?0:1}" lockAxis="y" v-model="data.blocks_order" :useDragHandle="!isSelectMode" :helperClass="(\'page-blocks main-theme theme-main is-reording \'+StylesFactory.getPageClasses(theme).join(\' \')).trim()" @helper="helperClass" @sortBeforeStart="sortStart" @sortEnd="sortEnd" @sortMove="sortMove" :useWindowAsScrollContainer="true" :scrollContainer="scrollContainer" :contentWindow="scrollContainer"> <div v-for="(section, si) in sections" class="blocks-section" :class="[((!section.section_id || data.sections[section.section_id].bg == undefined || data.sections[section.section_id].bg.color1 == undefined))?null:(\'is-\'+lightOrDark(data.sections[section.section_id].bg.color1)), section.section_id?(\'has-s s-\'+section.section_id+((data.sections[section.section_id].bg == undefined || data.sections[section.section_id].bg.color1 == undefined)?\' is-transparent\':\'\')):null, (sections[si+1] != undefined && sections[si+1].section_id)?(\'has-next-s\'+((data.sections[sections[si+1].section_id].bg == undefined || data.sections[sections[si+1].section_id].bg.color1 == undefined)?\' is-next-transparent\':\'\')):null, {\'is-empty\': !section.blocks.length}]"> <div> <div class="page-container"> <div class="section-main" :class="{\'handles-hidden\': !showReorder}" v-if="section.blocks.length"> <div> <sortable-item v-for="b in section.blocks" :class="[\'b-\'+b.block_id, \'block-item\', \'block-\'+data.blocks[b.block_id].block_type_name, {\'is-mustchange\': mustchange && mustchange.indexOf(b.block_id) != -1, \'is-textable\': data.blocks[b.block_id].block_type_name == \'text\', \'is-headline\': data.blocks[b.block_id].block_type_name == \'text\' && data.blocks[b.block_id].options.text_size != undefined && data.blocks[b.block_id].options.text_size[0] == \'h\', \'is-selected\': selected.indexOf(b.block_id) != -1, \'is-selecting\': selectingBlockId== b.block_id, \'is-readonly\': is_readonly && !(canNavigate && (data.blocks[b.block_id].block_type_name == \'link\' && data.blocks[b.block_id].options.type == \'page\' && data.blocks[b.block_id].options.value))}]" :index="b.i" :key="b.i" :item="data.blocks[b.block_id]" v-if="showHidden || isVisible(data.blocks[b.block_id])"> <div v-if="data.blocks[b.block_id].block_type_name != \'link\'" :style="{opacity: isVisible(data.blocks[b.block_id])?1:0.4}"> <div> <div v-sortable-handle class="block-handle" :class="{\'block-handle-socials\': [\'socialnetworks\', \'messenger\'].indexOf(data.blocks[b.block_id].block_type_name) != -1}" v-show="!is_readonly && showReorder" @click="selectBlock(b.block_id)"></div> <component v-bind:is="isViewMode?\'div\':\'a\'" @click="openForm(b.block_id)" @long-press.prevent="blockLongPress(b.block_id)" @pre-long-press="blockPreLongPress(b.block_id)" class="btn-link-block"> <component v-bind:is="\'vue-frontend-blocks-\'+data.blocks[b.block_id].block_type_name" :options="data.blocks[b.block_id].options" :block="data.blocks[b.block_id]" :section="data.sections[section.section_id]" :theme="theme" mode="edit" :account="accountData" :key="b.block_id"/> </component> </div> </div> <div v-if="data.blocks[b.block_id].block_type_name == \'link\'" :class="!is_readonly?$format(\'block-link-{1}\', data.blocks[b.block_id].options.type):null" :style="{opacity: isVisible(data.blocks[b.block_id])?1:0.4}"> <div> <div v-sortable-handle class="block-handle" v-show="!is_readonly && showReorder" @click="selectBlock(b.block_id)"></div> <router-link v-if="([\'page\', \'embeded\'].indexOf(data.blocks[b.block_id].options.type) != -1) && data.blocks[b.block_id].options.value && !is_readonly && showReorder" class="block-handle-link" :to="{name: \'pages\', params: {page_id: data.blocks[b.block_id].options.value}}"></router-link> <a v-if="(data.blocks[b.block_id].options.type == \'page\') && !data.blocks[b.block_id].options.value && !is_readonly && showReorder" class="block-handle-link block-handle-link-plus" @click="addLinkPage(b.block_id, data.blocks[b.block_id].options.title)"></a> <component v-bind:is="isViewMode?\'div\':\'a\'" @click="openForm(b.block_id)" @long-press.prevent="blockLongPress(b.block_id)" @pre-long-press="blockPreLongPress(b.block_id)"> <vue-frontend-blocks-link :options="data.blocks[b.block_id].options" :block="data.blocks[b.block_id]" :section="data.sections[section.section_id]" :theme="theme" mode="edit" :key="b.block_id"/> </component> </div> </div> </sortable-item> </div> </div> </div> </div> <div class="section-handle" v-if="(section.section_id || si < sections.length-1) && !is_readonly && showReorder" @mousedown="sectionHandleDown($event, si)" @touchstart="sectionHandleDown($event, si)"></div> </div> </sortable-list> <div v-if="showWelcome" style="flex:1;flex-direction: column;display: flex;"> <div style="flex:1"></div> <div style="overflow:hidden"> <div class="row"> <div class="col-xs-8 col-xs-offset-2 has-text-centered has-mt-4" style="font-size: 1.2rem;line-height: 1.5;color: #7a7a7a"> {{\'Начните создание страницы с добавления нового блока\'|gettext}}<br><i class="fal fa-long-arrow-down fa-2x has-mt-2 has-mb-2 has-text-grey-light" style="animation: fa-down 1s infinite"></i> </div> </div> </div> </div> </div>'}),window.$app.defineComponent("pages","vue-pages-page-form",{data:function(){return{activeTab:"common",isFetching:!1,isUpdating:!1,page_options:[],values:{title:"",page_base_id:null}}},props:{page_id:Number,page_base_id:Number,values:{default:{}}},mixins:[FormModel],created:function(){this.page_id?this.fetchData(!0):this.values.page_base_id=this.page_base_id},computed:{path:function(){return this.$account.page_id!=this.page_id?"/p/"+parseInt(this.page_id).toString(16)+"/":""},pageLink:function(){return this.$account.link+this.path},pageSafeLink:function(){return this.$account.link_safe+this.path}},methods:{fetchData:function(e){var t=this;this.isFetching=e,this.$api.get("pages/props/get",{page_id:this.page_id}).then(function(e){t.isFetching=!1,t.values=e.response.pages.props.values,t.page_options=e.response.pages.props.page_options})},updateData:function(){var t=this;this.isUpdating=!0,this.$api.post("pages/props/set",this.values,this).then(function(e){"success"==e.result&&(t.$parent.close(),t.page_id||(t.values.title="",t.$router.replace({name:"pages",params:{page_id:e.response.values.page_id}})),t.values={}),t.isUpdating=!1}).catch(function(e){t.isUpdating=!1})},onAction:function(e){var t=this;switch(e){case"delete":this.$confirm(this.$gettext("Вы уверены что хотите удалить эту страницу? Вы не сможете её вернуть!"),"is-danger").then(function(){t.$api.get("pages/delete",{page_id:t.page_id},t).then(function(e){"success"==e.result&&(t.$parent.close(),t.$router.replace({name:"pages",params:{page_id:t.$account.page_id}}))})})}}},template:'<div class="modal-card"> <header class="modal-card-head"> <p class="modal-card-title" v-if="page_id">{{\'Страница\'|gettext}}</p> <p class="modal-card-title" v-else>{{\'Новая страница\'|gettext}}</p> <button class="modal-close is-large" @click="$parent.close()"></button> </header> <ul class="nav nav-tabs" v-if="page_id"> <li :class="{active: activeTab== \'common\'}"><a href="#" @click="activeTab = \'common\'">{{\'Ссылка\'|gettext}}</a></li> <li :class="{active: activeTab== \'qr\'}"><a href="#" @click="activeTab = \'qr\'">{{\'QR-код\'|gettext}}</a></li> <li :class="{active: activeTab== \'seo\'}"><a href="#" @click="activeTab = \'seo\'">{{\'Настройки SEO\'|gettext}}</a></li> </ul> <section class="modal-card-body" v-show="activeTab == \'common\'"> <b-field :label="\'Название страницы\'|gettext" :message="errors.title" :class="{\'has-error\': errors.title}"> <input type="text" class="input" v-model="values.title"> </b-field> <div class="field" v-if="values.page_id"> <label class="label">{{\'Ссылка на страницу\'|gettext}}</label> <div class="field has-addons"> <div class="control is-expanded"><input type=\'text\' class=\'input\' readonly=\'on\' id=\'pageLink\' :value="pageLink"></div> <div class="control"> <vue-component-clipboard :text="pageLink" class="button is-default" :show-icon="false">{{\'Скопировать\'|gettext}}</vue-component-clipboard> </div> </div> </div> </section> <section class="message is-info" v-if="activeTab == \'qr\'"><div class="message-body">{{\'Вы можете скачать и использовать ваш QR-код на визитках или флайерах\'|gettext}}</div></section> <section class="modal-card-body" v-if="activeTab == \'qr\'"> <vue-component-qrcode :value="pageSafeLink" :with-download="true" class="has-text-centered"></vue-component-qrcode> </section> <section class="modal-card-body" v-if="activeTab == \'seo\'"> <b-field :label="\'Заголовок страницы\'|gettext"> <div class="control"> <input type="text" class="input" maxlength="180" :disabled="isUpdating" v-model="values.seo_title" :placeholder="page_options.seo.title"> <p class="has-mt-1 has-text-grey">{{\'Отображается в названии вкладки браузера и в результатах поисковых систем\'|gettext}}</p> </div> </b-field> <b-field :label="\'SEO описание\'|gettext"> <div class="control"> <textarea class="input" maxlength="512" rows="4" :disabled="isUpdating" v-model="values.seo_description" :placeholder="page_options.seo.description"></textarea> <p class="has-mt-1 has-text-grey">{{\'Отображается в результатах поисковых систем под ссылкой\'|gettext}}</p> </div> </b-field> </section> <footer class="modal-card-foot level"> <div class="level-left"> <vue-component-action-button @action="onAction" :title="\'Действие\'|gettext" v-if="values.page_id"> <template slot="actions"> <b-dropdown-item value="delete" class="has-text-danger"><i class="fa fa-trash-alt has-mr-1"></i>{{\'Удалить\'|gettext}}</b-dropdown-item> </template> </vue-component-action-button> <button v-else class="button is-dark is-hidden-tablet" type="button" @click="$parent.close()">{{\'Отмена\'|gettext}}</button> </div> <div class="level-right"> <button class="button is-primary" :class="{\'is-loading\': isUpdating}" @click="updateData">{{\'Сохранить\'|gettext}}</button> </div> </footer> <b-loading :is-full-page="false" :active.sync="isFetching"></b-loading> </div>'}),window.$app.defineComponent("pages","vue-pages-page",{data:function(){return{componentKey:0,isFetching:!1,isDeleting:!1,tipsInited:!1,tipsChoose:!1,showHidden:!1,viewModeTooltipTimeout:0,wait_scroll_block_id:null,viewModeTooltipVisible:!1,isSelectMode:!1,selectedBlocks:[],mustchangeTips:{},vertical_aligns:{top:this.$gettext("Сверху"),middle:this.$gettext("По центру"),bottom:this.$gettext("Снизу")},view_modes:{xs:{title:this.$gettext("Телефон"),icon:"mobile"},md:{title:this.$gettext("Компьютер"),icon:"desktop",mobile_title:this.$gettext("Недоступно в телефоне")}},view_mode:"xs",showHidden:!!Storage.get("float-panel-hidden",!0)}},props:["page_id","back_page_id"],watch:{selectedBlocks:function(e){$mx("html").toggleClass("is-dragging",e.length)},page_id:function(){this.fetchData(!0)},showHidden:function(e){var t=this;Storage.set("float-panel-hidden",e),this.$nextTick(function(){t.createMustchangeTips()})},view_mode:function(){"md"==this.view_mode?this.destroyMustchangeTips():setTimeout(this.createMustchangeTips,350)}},mounted:function(){this.$account.is_completed||this.$account.template_id?(this.fetchData(!0),this.$events.on("page.styles:updated",this.eventStylesUpdated),this.$events.on("page:updated",this.pageUpdated),this.$events.on("account:updated",this.pageUpdated)):this.$router.push({name:"pages-templates",params:{page_id:this.page_id}})},computed:{isAllowDelete:function(){return!0&this.$account.access},tipsChoosePage:function(){return!this.isFetching&&this.page_id!=this.$account.page_id&&this.tipsChoose?this.$gettext("Вы создали новую страницу, для навигации между вашими страницами нажмите тут"):""},inited:function(){return!this.isFetching&&this.tipsInited},linkScheme:function(){var e=this.$account;return(!e.custom_domain_verified||e.custom_domain_secured?"https":"http")+"://"},linkPath:function(){return this.$account.link+this.$page.data.page.link.path},tippyFloatPanelContent:function(){var e=this.$page.isViewMode;return this.$device.mobile?e?this.$gettext("Включен режим просмотра"):this.$gettext("Включен режим редактирования"):e?this.$gettext("Режим редактирования"):this.$gettext("Режим просмотра")}},beforeDestroy:function(){this.viewModeTooltipTimeout&&clearTimeout(this.viewModeTooltipTimeout),this.$events.off("account:updated",this.pageUpdated),this.$events.off("page:updated",this.pageUpdated),this.$events.off("page.styles:updated",this.eventStylesUpdated),this.destroyMustchangeTips()},beforeRouteLeave:function(e,t,s){this.$page.setViewMode(!1),s()},methods:{onAction:function(t){var s=this,i=this.selectedBlocks[0],a=this.$page.data.blocks[i].block_type_id;switch(t){case"select":this.isSelectMode=!this.isSelectMode;break;case"edit":this.$refs.blocks.openForm(i);break;case"clone":this.$api.get("pages/blocks/clone",{block_id:i,page_id:this.page_id,weight:this.$page.getWeight([a])}).then(function(e){"success"==e.result&&s.$events.fire("statistic:event",{name:"page_edit"})});break;case"archive":case"delete":this.$confirm("delete"==t?this.$gettext("Вы уверены что хотите удалить этот блок?"):this.$gettext("Вы уверены что хотите отправить этот блок в архив?"),"delete"==t?"is-danger":"is-warning","delete"==t?{yes:this.$gettext("Удалить")}:{}).then(function(){var e=s.$page.data.mustchange.indexOf(i);s.$api.get("pages/blocks/"+t,{block_id:i,page_id:s.page_id,is_mustchange:-1!=e,weight:s.$page.getWeight(void 0,[a])}).then(function(e){"success"==e.result&&(s.$events.fire("statistic:event",{name:"block_delete"}),s.$events.fire("statistic:event",{name:"page_edit"}))})})}},blockLongPress:function(e){this.isSelectMode||(this.$refs.blocksAction.toggle(),this.selectedBlocks=[e],navigator.vibrate&&navigator.vibrate(250))},deleteBlocks:function(){var i=this;this.$confirm(this.$gettext("Вы уверены что хотите удалить эти блоки?"),"is-danger",{yes:this.$gettext("Удалить")}).then(function(){var t=i.$page.data.mustchange,s=i.$page.data.blocks;i.isDeleting=!0,i.$api.post("pages/blocks/bulk_delete",{blocks:_.map(i.selectedBlocks,function(e){return{block_id:e,is_mustchange:-1!=t.indexOf(e)}}),page_id:i.page_id,weight:i.$page.getWeight(void 0,_.map(i.selectedBlocks,function(e){return s[e].block_type_id}))},i.$refs.model).then(function(e){i.isDeleting=!1,i.$events.fire("statistic:event",{name:"block_delete"}),i.$events.fire("statistic:event",{name:"page_edit"}),i.floatPanelClick("selectMode")})})},userFlowStepClick:function(e){var t,s;2<=e&&this.$page.data.mustchange.length?(t=this.$page.data.mustchange[0],s=$mx(".b-"+t),this.scrollToBlock(t),setTimeout(function(){s.addClass("shake animated"),setTimeout(function(){s.removeClass("shake animated")},1e3)},450)):3==e&&this.installPage()},tippyFloatPanelMouseEnter:function(){this.viewModeTooltipVisible=!0},tippyFloatPanelMouseLeave:function(){this.viewModeTooltipVisible=!1},toggleViewMode:function(){var e=this;this.$page.setViewMode(!this.$page.isViewMode),this.$device.mobile&&(this.viewModeTooltipVisible=!0,this.viewModeTooltipTimeout&&clearTimeout(this.viewModeTooltipTimeout),this.viewModeTooltipTimeout=setTimeout(function(){e.viewModeTooltipVisible=!1,e.viewModeTooltipTimeout=0},2e3)),this.$page.isViewMode?this.destroyMustchangeTips():setTimeout(this.createMustchangeTips,350)},floatDropdownActiveChange:function(e){$mx("html").toggleClass("is-clipped",e)},addTemplate:function(){this.$modal("vue-templates-form",{page_id:this.page_id},this)},clonePage:function(){this.$modal("vue-pages-page-form",{page_base_id:this.page_id},this)},newBlock:function(){this.$page.setViewMode(!1),this.$page.pageChanged(),this.$modal("vue-pages-blocks-form-modal",_.merge({page_id:this.page_id},this.getBeforeBlockId()),this)},scrollToBlock:function(i){var a=this;this.$nextTick(function(){var e,t,s=$mx(".b-"+i);s.length&&($mx(".float-panel").viewportOffset(),e=s.offset().top+s.height()+15-$mx(".float-panel").viewportOffset().top,t=a.$device.mobile?$mx(".main-block").scrollTop():window.pageYOffset,e&&t<e&&$app.scrollScreen(e)),a.wait_scroll_block_id=s.length?null:i})},pageUpdated:function(){this.componentKey++,this.wait_scroll_block_id&&this.scrollToBlock(this.wait_scroll_block_id),this.createMustchangeTips()},getBeforeBlockId:function(){var e=$mx(".theme-main").offset().top,t=$mx(".float-panel").viewportOffset().top,s=$mx(".theme-main .section-main > div > .block-item"),a=null,o=t-e+(this.$device.mobile?$mx(".main-block").scrollTop():window.pageYOffset);for(i=0;i<s.length;i++)if(s[i].offsetTop+s[i].clientHeight>o){a=s[i];break}if(a){var l=a.closest(".blocks-section").className.match(/\bs\-([0-9a-z]+)/);return{before_block_id:a.className.match(/\bb\-([0-9a-z]+)/)[1],before_section_id:l?l[1]:null}}return{before_block_id:null,before_section_id:null}},floatPanelClick:function(e){switch(e){case"showHidden":this.showHidden=!this.showHidden;break;case"selectMode":this.isSelectMode=!this.isSelectMode,this.floatDropdownActiveChange(!1),this.selectedBlocks=[]}},updatetipsbits:function(){$mx.get("/api/account/updatetipsbits.json?bit=1")},eventStylesUpdated:function(){StylesFactory.updateCSSBlock(this.$page.styles,this.$refs.styles)},fetchData:function(e){var s=this;this.tipsChoose=this.tipsInited=!1,this.isFetching=e,$app.scrollScreen(0,0).then(function(){window.scrollTo(0,0),s.$page.fetchData(s.page_id,!1).then(function(e){var t;s.isFetching=!1,"fail"==e.result||1!=(t=s.$page.data.page).page_type_id&&s.$form.open(null,{},function(){null!=t.event_close&&null!=t.event_close.link&&s.$router.replace(t.event_close.link.replace(":back_page_id",s.back_page_id))},function(){s.$form.top.title=t.title}),"success"==e.result?(0==(2&s.$account.tips_bits)?s.checkWelcomePartnerAccess():s.createMustchangeTips(),0==(1&s.$account.tips_bits)&&s.$auth.isAllowTariff("business")&&s.page_id!=s.$account.page_id&&(s.tipsChoose=!0,s.$account.tips_bits|=1),(m=document.location.hash.match("publish:?([a-z_]+)?"))&&(s.installPage(1<m.length?m[1]:null),document.location.hash="")):404==e.code&&s.$router.replace({name:"pages",params:{page_id:$account.page_id}}),s.eventStylesUpdated()}).catch(function(e){s.isFetching=!1})})},sortStart:function(e){null!=this.mustchangeTips[e]&&(this.mustchangeTips[e].destroy(),delete this.mustchangeTips[e])},sortEnd:function(){var e=this;this.$nextTick(function(){e.createMustchangeTips()})},sectionsChanged:function(){this.createMustchangeTips()},createMustchangeTip:function(e){var t;!this.$device.desktop||(t=$mx(".b-"+e)).length&&t[0].children.length&&(this.mustchangeTips[e]=tippy(t[0].children[0],{theme:"dark mustchange",placement:"right",appendTo:$mx(".device")[0],trigger:"manual",duration:0,zIndex:0,hideOnClick:!1,interactive:!1,arrow:tippy.roundArrow,showOnCreate:!0,allowHTML:!1,content:this.$gettext("Блок необходимо отредактировать")}))},createMustchangeTips:function(){var e=this;this.destroyMustchangeTips(),this.$nextTick(function(){_.each(e.$page.data.mustchange,e.createMustchangeTip)})},destroyMustchangeTips:function(){_.each(this.mustchangeTips,function(e){e.destroy()}),this.mustchangeTips=[]},showStartupTips:function(t){var s=this;this.$nextTick(function(){var e=$mx("html");e.addClass("hide-mustchange-tips"),window.initStartup({langNewblock:s.$gettext("Чтобы добавить новый блок,<br>нажмите сюда"),langSort:s.$gettext("Вы можете менять блоки местами,<br>для этого перетащите нужный вам блок"),langEditblock:s.$gettext("Чтобы отредактировать блок,<br>просто нажмите на него")},function(){e.removeClass("hide-mustchange-tips"),t&&t()})})},checkWelcomePartnerAccessAfter:function(){var e=this;0==(2&this.$account.tips_bits)&&this.showStartupTips(function(){e.$account.tips_bits=2|e.$account.tips_bits}),this.createMustchangeTips()},checkWelcomePartnerAccess:function(){null!=this.$account.partner&&null!=this.$account.partner.with_message&&this.$account.partner.with_message?this.$modal("vue-pages-partner-access-form",{},this):this.checkWelcomePartnerAccessAfter()},installPage:function(e){null==window.vkBridge?this.$modal("vue-pages-publish-form",{is_readonly:this.$page.data.page.is_readonly,target:e},this):this.$modal("vue-pages-publish-vk-form",{is_readonly:this.$page.data.page.is_readonly},this)},configurePage:function(){this.$modal("vue-pages-page-form",{page_id:this.$page.data.page.page_id},this)},choosePage:function(){this.$modal("vue-pages-choose-form",{is_readonly:this.$page.data.page.is_readonly},this)}},template:'<div> <div ref=\'styles\'></div> <div class="top-panel is-top-level hero-block hero-link" v-if="!$form.isOpenedHeader" :key="componentKey"> <div class="container"> <div class="row"> <div class="col-xs-12"> <vue-pages-user-flow-steps :step="2" v-if="!$account.is_completed" :page_id="page_id" @click="userFlowStepClick"/> <div class="form-control-link is-size-5 has-text-grey" v-else> <div class="form-control-link-text has-text-danger" v-if="$account.ban"><i class="fa fa-exclamation-circle has-mr-1"></i>{{\'Ваш аккаунт заблокирован\'|gettext}}</div> <div class="form-control-link-text" v-else> <span v-if="$account.link"> <span class=\'is-hidden-mobile\'>{{\'Моя ссылка\'|gettext}}: </span><a :href="linkPath" target="_blank" v-if="!isFetching"><span :class="{\'is-hidden-mobile\':!$account.custom_domain || $page.data.page.link.path}">{{linkScheme}}</span>{{$account.link_details.domain}}{{$account.link_path}}{{$page.data.page.link.path}}</a> </span> <span v-else> <span class="is-hidden-mobile">{{\'Для получения ссылки нажмите кнопку "Установить"\'|gettext}}</span> <span class="is-hidden-tablet">{{\'Получить ссылку\'|gettext}}</span> <i class="fa fa-long-arrow-right has-ml-1"></i> </span> </div> <router-link v-if="$account.tariff == \'business\' && ($account.page_id != page_id) && (page_id != 0)" :to="{name: \'pages\', params: {page_id: $account.page_id}}" class="button is-light link-pages is-hidden-mobile"><i class="fa fa-undo has-text-grey-light has-mr-1"></i>{{\'На главную\'|gettext}}</router-link> <button v-if="$auth.isAllowTariff(\'business\') && !tipsChoose" class="button link-pages" :class="$device.mobile?\'is-light\':\'is-dark\'" @click="choosePage"><i class="fas fa-chevron-down"></i></button> <a v-if="$auth.isAllowTariff(\'business\') && tipsChoose" class="button link-pages" :class="$device.mobile?\'is-light\':\'is-dark\'" @click="choosePage" :content="tipsChoosePage" v-tippy="{placement: \'bottom\', showOnCreate: true, trigger: \'manual\', onCreate: updatetipsbits}"><i class="fas fa-chevron-down"></i></a> <button type="button" class="button is-primary" @click="installPage()" style="min-width:100px" :disabled="$account.ban" :class="{\'is-loading\': $page.isUpdating}">{{\'Установить\'|gettext}}</button> </div> </div> </div> </div> </div> <vue-component-action-button @action="onAction" ref="blocksAction" :hasInvisibleButton="true"> <template slot="actions"> <b-dropdown-item value="select">{{\'Выбрать\'|gettext}}</b-dropdown-item> <b-dropdown-item value="edit">{{\'Редактировать\'|gettext}}</b-dropdown-item> <b-dropdown-item value="clone">{{\'Дублировать\'|gettext}}</b-dropdown-item> <b-dropdown-item value="archive">{{\'В архив\'|gettext}}</b-dropdown-item> <b-dropdown-item value="delete" class="has-text-danger">{{\'Удалить\'|gettext}}</b-dropdown-item> </template> </vue-component-action-button> <vue-component-screen-breakpoint v-if="view_mode == \'md\' && !$page.isViewMode && !this.$page.data.page.is_readonly" v-model="$page.data.options.max_width" :page_id="page_id "/> <div class=\'main-block1 main-block-xs-clear is-xs-marginless\' style="display: flex;flex-direction: column;flex:1" :class="[{\'has-mt-5 has-mb-5\': view_mode== \'xs\'}, ($page.data && $page.data.options)?(\'max-page-container-\'+$page.data.options.max_width):null]"> <div class="main-theme is-large has-padding-top has-padding-bottom has-shadow is-hide-mobile page-blocks is-flex-fullheight" :class="{device: view_mode== \'xs\'}" style="display: flex"> <div class="screen page" style="display: flex;flex-grow: 1" :key="componentKey"> <vue-pages-page-blocks :page_id="page_id" :page-options="$page.data.options" :mustchange="$page.data.mustchange" :theme="$account.theme" :show-hidden="showHidden && !$page.isViewMode" :show-reorder="!$page.isViewMode" :is-view-mode="$page.isViewMode" :is-select-mode="isSelectMode" :selected="selectedBlocks" class="has-floatpanel" :allow-welcome="true" :readonly="$page.isViewMode" :can-navigate="true" @sortStart="sortStart" @sortEnd="sortEnd" @sectionsChanged="sectionsChanged" @long-press="blockLongPress($event.block_id)" :canSelect="isAllowDelete" ref="blocks"/> </div></div> <tippy to="viewModeButton" :visible="viewModeTooltipVisible" trigger="manual" theme="light">{{tippyFloatPanelContent}}</tippy> <div class="float-panel is-light-mobile is-page-edit"> <div class="container"> <div style="margin: 0 auto" v-if="!isSelectMode"> <button name="viewModeButton" class="button is-black is-large" :class="{in: $page.isViewMode}" @click="toggleViewMode" @mouseenter="tippyFloatPanelMouseEnter" @mouseleave="tippyFloatPanelMouseLeave" style="flex:0;min-width:60px"> <transition mode="in-out"> <i class="fa fa-pencil" v-if="$page.isViewMode" style="font-size:1.4rem"></i> </transition> <transition mode="out-in"> <i class="fa fa-eye" v-if="!$page.isViewMode" style="font-size:1.5rem"></i> </transition> </button> <button class="button is-primary is-large is-new-block is-main" @click="newBlock" :disabled="$page.data.page.is_readonly">{{\'Добавить блок\'|gettext}}</button> <vue-component-dropdown position="is-top-right" @active-change="floatDropdownActiveChange" :title="\'Редактор страницы\'|gettext" button-class="button is-black is-large in" :with-arrow="false"> <i class="fas fa-sliders-h" slot="button"></i> <b-dropdown-item aria-role="listitem" @click="configurePage" :disabled="$page.data.page.is_readonly"><i class="fa fa-cog has-mr-1"></i>{{\'Настройки страницы\'|gettext}}</b-dropdown-item> <b-dropdown-item aria-role="listitem" @click="addTemplate" v-if="$auth.hasFeature(\'templates_creater\')"><i class="fa fa-plus has-mr-1"></i>{{\'Добавить в шаблоны\'|gettext}}</b-dropdown-item> <b-dropdown-item aria-role="listitem" @click="floatPanelClick(\'selectMode\')" :disabled="!isAllowDelete"><i class="fa fa-trash has-mr-1"></i>{{\'Удалить блоки\'|gettext}}</b-dropdown-item> <hr class="dropdown-divider" aria-role="menuitem"> <b-dropdown-item aria-role="listitem" @click="floatPanelClick(\'showHidden\')"><i class="fa fa-check has-mr-1" :class="{\'is-invisible\': !showHidden}"></i>{{\'Показывать скрытые блоки\'|gettext}}</b-dropdown-item> <hr class="dropdown-divider" aria-role="menuitem"> <b-dropdown-item custom aria-role="menuitem" class="has-text-grey has-text-nowrap">{{\'Вертикальное выравнивание блоков\'|gettext}}</b-dropdown-item> <b-dropdown-item aria-role="listitem" v-for="(v, k) in vertical_aligns" @click="$page.setOption(\'valign\', k)" :disabled="$page.data.page.is_readonly"><i class="fa fa-check has-mr-1" :class="{\'is-invisible\': $page.data && $page.data.options && ($page.data.options.valign !== k)}"></i>{{v}}</b-dropdown-item> <hr class="dropdown-divider" aria-role="menuitem"> <b-dropdown-item custom aria-role="menuitem" class="has-text-grey">{{\'Режим отображения\'|gettext}}</b-dropdown-item> <b-dropdown-item aria-role="listitem" v-for="(v, k) in view_modes" @click="view_mode = k" :class="{\'disabled-mobile\': k== \'md\'}"><i class="fa fa-check has-mr-1" :class="{\'is-invisible\': view_mode != k}"></i>{{v.title}}<span v-if="v.mobile_title" class="is-hidden-desktop"> ( {{v.mobile_title}} )</span></b-dropdown-item> </vue-component-dropdown> </div> <div style="margin: 0 auto" v-if="isSelectMode"> <button class="button is-black is-large" @click="floatPanelClick(\'selectMode\')" :disabled="isDeleting">{{\'Отмена\'|gettext}}</button> <button class="button is-danger is-large" :class="{\'is-loading\': isDeleting}" :disabled="!selectedBlocks.length" @click="deleteBlocks">{{\'Удалить\'|gettext}}<b v-if="selectedBlocks.length" class="has-ml-1">({{selectedBlocks.length}})</b></button> </div> </div> </div> </div> </div>'}),window.$app.defineComponent("pages","vue-pages-partner-access-form",{data:function(){return{isUpdating:!1,isAllow:!0}},created:function(){},mixins:[FormModel],methods:{update:function(){var t=this;this.isAllow&&this.$account.partner.with_access?this.$api.post("access/set",{account_id:this.$account.partner.account_id,part:"main"}).then(function(e){t.close(),t.isUpdating=!1}).catch(function(e){e.data;t.isUpdating=!1}):this.close()},close:function(){var e=this;this.$parent.close(),setTimeout(function(){e.$parent.$parent.checkWelcomePartnerAccessAfter()},300)}},template:'<div class="modal-card"> <header class="modal-card-head"> <p class="modal-card-title">{{\'Добро пожаловать\'|gettext}}</p> <button class="modal-close is-large" @click="update"></button> </header> <section class="modal-card-body"> <h4 class="has-mb-2">{{$account.partner.welcome_message}}</h4> <mx-toggle v-model=\'isAllow\' v-if="$account.partner.with_access" :title="\'Предоставить полный доступ\'|gettext"></mx-toggle> </section> <footer class="modal-card-foot"> <button class="button is-primary" :class="{\'is-loading\': isUpdating}" @click="update" v-if="$account.partner.with_access">{{\'Сохранить\'|gettext}}</button> <button class="button is-dark" type="button" @click="close()" v-else>{{\'Закрыть\'|gettext}}</button> </footer> </div>'}),window.$app.defineComponent("pages","vue-pages-publish-form",{data:function(){return{domainInputFocused:!1,isUnattaching:!1,isFetching:!1,isUpdating:!1,isUpdatingSubdomain:!1,isButtonLoading:"",current:null,profiles:{},widget:{},variants:{},is_installed:!1,activeTab:"instagram",instagram_basic:!0,instagram_business:!1,prepare:null,link:{domain_id:1,username:""},domain:null,subdomain:null,username:"",colorPickerOpened:!1}},props:{is_readonly:Boolean,target:String},mixins:[FormModel],computed:{widgetCode:function(){return'<script src="//taplink.cc/id:'+this.$account.profile_id+'/widget/" async><\/script>'},instagramLink:function(){return"https://taplink.cc/"+this.$account.nickname},currentDomain:function(){var e=_.filter(this.variants.domains,{domain_id:this.link.domain_id||this.domain_id});return _.size(e)?e[0]:this.variants.domains[0]},usernameMask:function(){return 1==this.link.domain_id?"a-z0-9_.":"a-z0-9-"}},watch:{"link.domain_id":function(){this.link.username&&(this.link.username=this.link.username.replace(new RegExp("[^"+this.usernameMask+"]*","g"),""))}},created:function(){this.$account.custom_domain&&(this.activeTab="domain"),-1!=["instagram_business","instagram_basic"].indexOf(this.target)&&(this.activeTab="instagram"),this.activeTab="subdomain",this.$account.link||this.$events.fire("statistic:event",{name:"publish_open"}),this.fetchData(!0)},methods:{colorActiveChange:function(e){this.colorPickerOpened=e},instagramBusinessCancel:function(){this.profiles={},this.target=""},connectUsername:function(){var s=this;this.$prompt(this.$gettext("Укажите имя профиля или ссылку на Instagram"),{}).then(function(e){s.isButtonLoading="instagram",$mx.request({url:"/instagram/resolve",method:"get",json:{username:e.toLowerCase().trim()}}).then(function(e){var t=e.data;s.isFetching=!1,s.isButtonLoading="","fail"==t.result?s.$alert(t.message||s.$gettext("Профиль не найден"),"is-danger"):(s.prepare=t.response,s.username="")})})},toggleTab:function(e){this.activeTab=this.activeTab==e&&window.matchMedia("(max-width: 767px)").matches?null:e},check:function(){var t=this;this.isUpdating=!0,this.$api.get("pages/publish/check",{target:this.target}).then(function(e){t.$parent.close()})},confirmAttach:function(){this.target="instagram_basic_confirm",this.fetchData(!0)},fetchData:function(e){var s=this;this.isFetching=e,this.$api.get("pages/publish/info",{target:this.target,prepare:this.prepare}).then(function(e){s.isFetching=!1;var t=e.response;switch(Object.assign(s,t),"instagram_basic_confirm"==s.target&&s.$events.fire("statistic:event",{name:"publish_done"}),s.profiles.length||"instagram_business"!=s.target||(s.$alert(s.$gettext("У вас нет подключенных Instagram Business профилей"),"is-danger"),s.target=""),s.target){case"instagram_basic":s.prepare=e.response.prepare;break;case"instagram_basic_confirm":s.prepare=null}t.message&&s.$alert(t.message,"is-danger"),"subdomain"==s.activeTab&&s.$nextTick(function(){s.$refs.domainInput&&s.$refs.domainInput.focus()})})},updateSubdomain:function(){var t=this;this.isUpdatingSubdomain=!0,this.$api.post("pages/publish/attach",this.link,this).then(function(e){"success"==e.result&&t.$events.fire("statistic:event",{name:"publish_done"}),t.isUpdatingSubdomain=!1})},choose:function(e){var t=this;this.isFetching=!0,this.$api.get("pages/publish/set",{id:e.id,uniq:e.uniq}).then(function(e){t.isFetching=!1,t.$parent.$parent.installPage(),t.$events.fire("statistic:event",{name:"publish_done"}),t.$parent.close()})},unattach:function(){var t=this;this.$confirm(this.$gettext("Вы уверены что хотите отключить текущую ссылку от вашей страницы?"),"is-danger").then(function(){t.isUnattaching=!0,t.$api.get("pages/publish/unattach",{id:t.current}).then(function(e){t.isUnattaching=!1})})},onWidgetChanged:_.debounce(function(){this.is_readonly||this.$api.get("pages/install/set",{widget:this.widget})},500)},template:'<div class="modal-card"> <header class="modal-card-head"> <p class="modal-card-title">{{\'Установка ссылки\'|gettext}}</p> <button class="modal-close is-large" @click="$parent.close()"></button> </header> <section class="modal-card-body modal-card-body-blocks" style="display:flex"> <div class="publish-form-collapse"> <div class="is-title" @click="toggleTab(\'subdomain\')" :class="{in: activeTab== \'subdomain\'}"> <span><i class="fal fa-chevron-right has-mr-2"></i>{{\'Ссылка\'|gettext}}</span> </div> <div> <div style="display: flex;flex-direction: column;"> <transition name="fade"> <div class="publish-form-domains" v-if="(!$account.link && !$account.custom_domain) && variants.domains"> <label class="label has-mb-2 is-hidden-mobile">{{\'Выберите домен\'|gettext}}</label> <div class="row row-noborder"> <div class="col-xs-12" v-for="d in variants.domains"> <label class="item radio has-p-2"> <input type="radio" :value="d.domain_id" v-model="link.domain_id" :disabled="is_readonly"> <span style="flex-grow: 1"><span class="is-hidden-mobile" v-if="d.type == \'subdomain\'"><span class="has-text-grey-light">{{\'вашеимя\'|gettext}}</span>.</span><b>{{d.domain}}</b><span class="is-hidden-mobile" v-if="d.type == \'folder\'">/<span class="has-text-grey-light">{{\'вашеимя\'|gettext}}</span></span></span> </label> </div> <div class="col-xs-12"> <label class="item radio has-p-2"><input type="radio" :value="null" v-model="link.domain_id"> <span style="flex-grow: 1"><b>{{\'Свое доменное имя\'|gettext}}</b></span> <div v-if="!$auth.isAllowTariff(\'business\')" class="tag is-business" style="position: relative" v-tippy :content="\'Эта возможность доступна на Business тарифе\'|gettext">biz</div> </label> </div> </div> </div> </transition> <section style="flex-grow: 1"> <label class="label has-mb-2" v-if="$account.link">{{\'Адрес вашего сайта\'|gettext}}</label> <div v-if="link.domain_id"> <div v-if="$account.link"> <b-field class="is-marginless"> <div class="control is-expanded is-clearfix"> <div disabled="on" class="input is-mouse-locked has-text-black">{{$account.link}}</div> </div> <p class="control"> <vue-component-action-button @action="unattach" :title="\'Действие\'|gettext" position="is-bottom-left" :disabled="is_readonly"> <template slot="actions"> <b-dropdown-item value="delete" class="has-text-danger"><i class="fa fa-trash-alt has-mr-1"></i>{{\'Отключить ссылку\'|gettext}}</b-dropdown-item> </template> </vue-component-action-button> </p> </b-field> </div> <div v-else-if="link.domain_id"> <label class="label has-mb-2">{{\'Укажите адрес сайта\'|gettext}}</label> <div v-if="link && variants.domains" class="row row-small"> <div class="col-xs-12 col-sm has-mb-2-mobile" :key="link.domain_id"> <div class="publish-form-username-input input" :class="{\'is-focused\': domainInputFocused}" :disabled="isUpdatingSubdomain" @click="$refs.domainInput.focus()"> <span v-if="currentDomain.type == \'folder\'">https://{{currentDomain.domain}}/</span> <span v-if="currentDomain.type == \'subdomain\'">https://</span> <input v-model="link.username" class="input" v-mask="{transform: \'lower\', preg: usernameMask}" :disabled="isUpdatingSubdomain" :placeholder="\'вашеимя\'|gettext" @focus="domainInputFocused = true" @blur="domainInputFocused = false" ref="domainInput"></input> <span v-if="currentDomain.type == \'subdomain\'">.{{currentDomain.domain}}</span> </div> </div> <div class="col-xs-12 col-sm col-sm-shrink"> <button type="button" class="button is-primary is-fullwidth" :class="{\'is-loading\': isUpdatingSubdomain}" @click="updateSubdomain" :disabled="is_readonly">{{\'Подключить\'|gettext}}</button> </div> </div> </div> </div> <div v-else> <label class="label has-mb-2" v-if="!$account.link">{{\'Подключение своего домена к странице\'|gettext}}</label> <section class="message is-danger no-remove-border" v-if="!$auth.isAllowTariff(\'business\')"> <div class="message-body has-mb-2">{{\'Доступно на business-тарифе\'|gettext}}<a @click="$form.open(\'vue-index-pricing-form\')" class=\'is-pulled-right\'>{{\'Подробнее\'|gettext}} <i class="fa fa-angle-right" style="margin-left: 5px"></i></a></div> </section> <vue-component-domain-attach v-model="domain" :disabled="is_readonly" v-if="domain"/> </div> <div v-if="$account.link" class="has-mt-4"> <label class="label has-mb-2">{{\'Разместите ссылку на сайт\'|gettext}}</label> <div class="row row-small publish-form-share"> <div class="col-xs-12 col-sm-6 has-mb-1"><vue-component-clipboard :text="$account.link" class="button is-fullwidth" :show-icon="false"><i class="fal fa-copy fa-lg"></i>{{\'Скопировать ссылку\'|gettext}}</vue-component-clipboard></div> <div class="col-xs-12 col-sm-6 has-mb-1" v-if="i18n.locale == \'ru\'"><button class="button is-fullwidth" @click="$modal(\'vue-pages-share-form\', {target: \'vk\'})"><i class="fa fab fa-vk fa-lg"></i>{{\'Разместить в {1}\'|gettext|format(\'ВКонтакте\')}}</button></div> <div class="col-xs-12 col-sm-6 has-mb-1"><button class="button is-fullwidth" @click="$modal(\'vue-pages-share-form\', {target: \'instagram\'})"><i class="fa fab fa-ig fa-lg"></i>{{\'Разместить в {1}\'|gettext|format(\'Instagram\')}}</button></div> <div class="col-xs-12 col-sm-6 has-mb-1"><button class="button is-fullwidth" @click="$modal(\'vue-pages-share-form\', {target: \'tiktok\'})"><i class="fa fab fa-tk fa-lg"></i>{{\'Разместить в {1}\'|gettext|format(\'TikTok\')}}</button></div> <div class="col-xs-12 col-sm-6 has-mb-1"><button class="button is-fullwidth" @click="$modal(\'vue-pages-share-form\', {target: \'twitter\'})"><i class="fa fab fa-tw fa-lg"></i>{{\'Разместить в {1}\'|gettext|format(\'Twitter\')}}</button></div> <div class="col-xs-12 col-sm-6 has-mb-1"><button class="button is-fullwidth" @click="$modal(\'vue-pages-share-form\', {target: \'facebook\'})"><i class="fa fab fa-fb fa-lg"></i>{{\'Разместить в {1}\'|gettext|format(\'Facebook\')}}</button></div> <div class="col-xs-12 col-sm-6 has-mb-1" v-if="i18n.locale != \'ru\'"><button class="button is-fullwidth" @click="$modal(\'vue-pages-share-form\', {target: \'linkedin\'})"><i class="fa fab fa-in fa-lg"></i>{{\'Разместить в {1}\'|gettext|format(\'LinkedIn\')}}</button></div> <div class="col-xs-12" v-if="navigator.share"><button class="button is-fullwidth" @click="navigator.share({url: $account.link})"><i class="fas fa-share fa-lg"></i>{{\'More share options\'|gettext}}</button></div> </div> </div> </section> </div> </div> <div class="is-title" @click="toggleTab(\'qr\')" :class="{in: activeTab== \'qr\'}"> <span><i class="fal fa-chevron-right has-mr-2"></i>{{\'QR-код\'|gettext}}</span> </div> <div> <div> <section class="message is-info"><div class="message-body">{{\'Вы можете скачать и использовать ваш QR-код на визитках или флайерах\'|gettext}}</div></section> <section> <transition name="fade"> <vue-component-qrcode :value="$account.link_safe" :with-download="true" class="has-text-centered"></vue-component-qrcode> </transition> </section> </div> </div> <div class="is-title" @click="toggleTab(\'widget\')" :class="{in: activeTab== \'widget\', \'is-last-tab\': activeTab != null}"> <span><i class="fal fa-chevron-right has-mr-2"></i>{{\'Виджет на сайт\'|gettext}}</span> </div> <div :style="{overflow: colorPickerOpened?\'unset\':null}"> <div :style="{overflow: colorPickerOpened?\'unset\':null}"> <section> <label class=\'label\'>{{\'Скопируйте код и разместите его в HTML-разметке вашего сайта\'|gettext}}</label> <div class="field has-addons"> <div class="control is-expanded"><input class="input" onfocus="this.select()" readonly="on" :value="widgetCode"></div> <div class="control"> <vue-component-clipboard :text="widgetCode" class="button is-default" :show-icon="false"><i class="fal fa-copy has-mr-1"></i>{{\'Скопировать\'|gettext}}</vue-component-clipboard> </div> </div> <div class="field has-mb-4"> <label class=\'label\'>{{\'Цвет кнопки\'|gettext}}</label> <vue-component-colorpicker colors=\'#F7464A,#e600a3,#1fb6ff,#1EB363,#4f5a67\' v-model="widget.color" @input="onWidgetChanged" position-vertical="top" :disabled="is_readonly" @active-change="colorActiveChange"/> </div> <div class="row"> <div class="col-xs-12 col-sm-6"> <div class="field"> <label class=\'label\'>{{\'Расположение кнопки\'|gettext}}</label> <label class="radio is-block has-mb-1" v-for="(v, k) in variants.widget_button_placement"><input type="radio" name=\'widget_button_placement\' :value="k" v-model="widget.placement" @change="onWidgetChanged" :disabled="is_readonly"> {{v}}</label> </div> </div> <div class="col-xs-12 col-sm-6"> <div class="field"> <label class=\'label\'>{{\'Вид окна\'|gettext}}</label> <label class="radio is-block has-mb-1" v-for="(v, k) in variants.widget_button_view"><input type="radio" name=\'widget_button_view\' :value="k" v-model="widget.view" @change="onWidgetChanged" :disabled="is_readonly"> {{v}}</label> </div> </div> </div> </section> </div> </div> </div> </section> <footer class="modal-card-foot is-hidden-mobile"> <button class="button is-dark" type="button" @click="$parent.close()">{{\'Закрыть\'|gettext}}</button> </footer> <b-loading :is-full-page="false" :active.sync="isFetching"></b-loading> </div>'}),window.$app.defineComponent("pages","vue-pages-publish-vk-form",{data:function(){return{vkGroups:null,isFetching:!0,isUpdating:!1,id:null}},props:[],created:function(){this.fetchData()},methods:{installVKontakte:function(){vkBridge.send("VKWebAppAddToCommunity")},fetchData:function(){var t=this;vkBridge.send("VKWebAppGetAuthToken",{app_id:6094770,scope:"groups"}).then(function(e){vkBridge.send("VKWebAppCallAPIMethod",{method:"groups.get",params:{v:"5.131",extended:!1,filter:"admin",fields:"id,name,screen_name",access_token:e.access_token}}).then(function(e){t.vkGroups=e.response.items,t.$api.get("pages/publish/apps/get",{app_name:"vk"}).then(function(e){"success"==e.result&&(t.id=e.response.id),t.isFetching=!1})})})},updateData:function(){var t=this;this.isUpdating=!0,this.$api.post("pages/publish/apps/set",{app_name:"vk",id:this.id},this).then(function(e){t.isUpdating=!1})}},template:'<div class="modal-card modal-card-little"> <header class="modal-card-head"> <p class="modal-card-title">{{\'Установка приложения в сообщество\'|gettext}}</p> <button class="modal-close is-large" @click="$parent.close()"></button> </header> <section class="modal-card-body"> <div class="row row-small"> <div class="col-xs-12 col-sm-8 has-mb-2"> <b-select v-model="id" :loading="isFetching" :disabled="isUpdating || isFetching" icon-pack="fal" expanded> <option :value=\'null\'>-- Сообщество не выбрано --</option> <option v-for="v in vkGroups" :value="v.id"> {{v.name}} </option> </b-select> </div> <div class="col-xs-12 col-sm-1 has-mb-2"> <a class="button is-dark" target="_blank" :href="\'https://vk.com/app6094770_-\'+id" :disabled="id == null" :class="{disabled: id== null}"><i class="fa fa-external-link"></i></a> </div> <div class="col-xs-12 col-sm-3 has-xs-mb-2"> <button class="button is-primary is-fullwidth" @click="updateData" :class="{\'is-loading\': isUpdating}" :disabled="isFetching">Сохранить</button> </div> </div> <button class="button is-dark" @click="installVKontakte">Установить приложение в сообщество</button> </section> <footer class="modal-card-foot"> <button class="button is-dark" type="button" @click="$parent.close()" :disabled="isUpdating">{{\'Закрыть\'|gettext}}</button> </footer> <b-loading :is-full-page="false" :active.sync="isFetching"></b-loading> </div>'}),window.$app.defineComponent("pages","vue-pages-share-form",{data:function(){return{isFetching:!0,titles:{instagram:"Instagram",facebook:"Facebook",tiktok:"TikTok",linkedin:"LinkedIn",twitter:"Twitter",vk:"ВКонтакте"},platform:null,locale:i18n.locale,slides:[],anim:!1,index:0}},props:["target"],created:function(){var s=this;VueHammer.config.swipe={threshold:100},this.$api.get("pages/publish/share",{target:this.target,locale:this.locale}).then(function(e){var t;"success"==e.result&&(t=e.response,s.slides=t.slides,s.platform=t.platform,s.locale=t.locale),s.isFetching=!1})},watch:{index:function(e){var t=this;this.anim=!0,setTimeout(function(){t.index=e,t.anim=!1},250)}},methods:{swipe:function(e){e.deltaX<0?this.next():this.prev()},next:function(){this.index<this.slides.length-1&&this.index++},prev:function(){this.index&&this.index--}},template:'<div class="modal-card share-form" :class="\'is-platform-\'+platform"> <section class="modal-card-body is-clipped"> <p class="share-form-title">{{\'Разместить в {1}\'|gettext|format(titles[target])}}</p> <button class="modal-close is-large" @click="$parent.close()"></button> <div class="index-screens-container is-crop" v-hammer:swipe="swipe"> <div class="index-screens has-text-centered"> <div class="device is-black is-screen"> <div class="screen is-clipped" :class="{skeleton: isFetching}"> <img :src="\'/s/i/share/{1}/{2}/{3}/{4}\'|format(locale, platform, target, (i+1)+\'.jpg\')" v-for="(v, i) in slides" :class="{\'is-hidden\': i != index}"> </div> </div> </div> </div> <div class="slider-nav has-mt-1"> <div class="slider-dot" v-for="(v, i) in slides" :class="{active: index== i}" @click="index = i"></div> </div> <div class="row share-form-aminations" :class="{in: anim}"> <div class="col-xs-10 col-xs-offset-1 col-sm-8 col-sm-offset-2" v-if="slides.length"> <p class="has-text-centered">{{slides[index]}}</p> </div> </div> <div class="has-text-centered has-mt-2 has-mb-3"> <button class="button is-black is-large is-rounded" v-if="index < slides.length-1" type="button" @click="next" style="padding-left: 2em;padding-right: 2em">{{\'Далее\'|gettext}} <i class="fal fa-long-arrow-right index-button-arrow"></i></button> <button class="button is-black is-large is-rounded" v-else type="button" @click="$parent.close()" :class="{\'is-loading\': isFetching}" style="padding-left: 2em;padding-right: 2em">{{\'Готово\'|gettext}}</button> </div> </section> </div>'}),window.$app.defineComponent("pages","vue-pages-thumbnail-chooser-form",{data:function(){return{isFetching:!1,tmp:null}},props:{value:Object,useObject:Boolean,onSave:Function,preferedIcons:Array,hasTypes:{type:Boolean,default:!0}},created:function(){this.tmp=_.clone(this.value)},methods:{save:function(){this.onSave(this.tmp),this.$parent.close()}},template:'<div class="modal-card"> <header class="modal-card-head"> <p class="modal-card-title">{{\'Миниатюра\'|gettext}}</p> <button class="modal-close is-large" @click="$parent.close()"></button> </header> <section class="modal-card-body"> <vue-component-thumbnail-chooser :pictures="tmp" v-model="tmp" :use-object="useObject" :need-focus="false" :prefered-icons="preferedIcons" :has-types="hasTypes"/> </section> <footer class="modal-card-foot love"> <div class="level-left is-hidden-tablet"><button type="button" class="button is-dark" @click="$parent.close()">{{\'Отмена\'|gettext}}</button></div> <div class="level-right"><button class="button is-primary level-item" type="button" @click="save">{{\'Применить\'|gettext}}</button></div> </footer> <b-loading :is-full-page="false" :active.sync="isFetching"></b-loading> </div>'}),window.$app.defineComponent("pages","vue-pages-user-flow-steps",{data:function(){return{tippyDone:null,steps:[this.$gettext("Выбрать шаблон"),this.$gettext("Внести изменения"),this.$gettext("Опубликовать")]}},props:{step:Number,page_id:Number,page_has_template:Boolean},computed:{hasMustchange:function(){return this.$page.data.mustchange.length},hasTemplate:function(){return this.page_has_template&&this.$account.template_id}},watch:{hasMustchange:function(e){e||(this.$events.fire("statistic:event",{name:"template_done"}),this.showTippyDone())}},beforeDestroy:function(){this.hideTippyDone()},methods:{showTippyDone:function(){this.hideTippyDone(),this.tippyDone=tippy(this.$device.mobile?this.$refs.step3xs:this.$refs.step3sm,{placement:"bottom",trigger:"manual",theme:"dark themesdone",hideOnClick:!1,showOnCreate:!0,popperOptions:{strategy:"fixed",modifiers:[{name:"preventOverflow",options:{enabled:!0,altAxis:!0,padding:15,boundariesElement:"window"}}]},interactive:!0,allowHTML:!0,content:'<div onclick="window.__clickTippyDone()">'+this.$gettext("Получите ссылку для своего сайта и разместите ее в соцсетях")+"</div>"}),window.$events.one("modals:opened",this.hideTippyDone),window.__clickTippyDone=this.clickTippyDone},hideTippyDone:function(){this.tippyDone&&(this.tippyDone.destroy(),this.tippyDone=null,window.$events.off("modals:opened",this.hideTippyDone))},clickTippyDone:function(){scrollIt(0,"y",this.$device.mobile?$mx(".main-block")[0]:null),setTimeout(this.hideTippyDone,1500)},toTemplates:function(){this.$router.push({name:"pages-templates",params:{page_id:this.page_id}})},toPage:function(){this.$router.push({name:"pages",params:{page_id:this.page_id}})},click:function(e){if(this.step!=e){if(1==e)return this.toTemplates();if(2==e&&this.hasTemplate)return this.toPage()}this.$emit("click",e)}},template:'<div> <div class="user-flow-steps-mobile is-hidden-tablet has-text-left"> <div> <div class="pie-wrapper" :data-step="step"> <div class="pie"> <div class="left-side half-circle"></div> <div class="right-side half-circle"></div> </div> <div class="shadow"></div> </div> <span class="user-flow-steps-mobile-step has-text-black has-mr-2">{{step}}/{{steps.length}}</span> </div> <div style="flex-grow: 1" @click="click(step)"> {{steps[step-1]}} </div> <div> <button class="button is-text" @click="click(step-1)" :class="{disabled: (step == 1)}"><i class="fal fa-long-arrow-left"></i></button> <button class="button is-text" @click="click(step+1)" :class="{disabled: ((step == 2) && hasMustchange) || ((step == 1) && !hasTemplate)}" ref=\'step3xs\'><i class="fal fa-long-arrow-right"></i></button> </div> </div> <div class="user-flow-steps is-hidden-mobile"> <div :class="{in: step>= 1}"><em data-value="1"></em><a @click="click(1)" v-if="step != 1">{{steps[0]}}</a><span v-else>{{steps[0]}}</span></div> <dd :class="{in: step>= 2}"></dd> <div :class="{in: step>= 2}"><em data-value="2"></em><a @click="click(2)" v-if="step != 2 && hasTemplate">{{steps[1]}}</a><span v-else @click="click(2)">{{steps[1]}}</span></div> <dd :class="{in: step>= 3}"></dd> <div :class="{\'is-available\': (step> 1) && !hasMustchange}"><em data-value="3"></em><a @click="click(3)" v-if="step> 1" ref=\'step3sm\'>{{steps[2]}}</a><span v-else>{{steps[2]}}</span></div> </div> </div>'});
