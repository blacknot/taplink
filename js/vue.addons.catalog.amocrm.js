window.$app.defineComponent("addons.catalog.amocrm","vue-addons-catalog-amocrm-entry",{props:["addons","addon","options","variants","values"],mixins:[FormModel],computed:{placeholderField:function(){return"-- "+this.$gettext("Выберите поле")+" --"},allowCustomField:function(){return this.values&&(this.values.fields&&_.size(this.values.fields)||this.values.fields_extended&&_.size(this.values.fields_extended)||this.variants.custom_fields&&_.size(this.variants.custom_fields))}},methods:{hasErrors:function(e,s){var l=null,o=null;for(i=0;i<this.values.fields.length;i++){var t=this.values.fields[i];if(t.idx==e){l=t.value_type;break}}if(!l)for(i=0;i<this.values.fields_extended.length;i++){var a=this.values.fields_extended[i];for(j=0;j<a.fields.length;j++)if(a.fields[j].idx==e){l=a.fields[j].value_type;break}if(l)break}return s&&(s=s.split(":"),null!=this.variants.custom_fields[s[0]]&&null!=this.variants.custom_fields[s[0]][s[1]]&&(o=this.variants.custom_fields[s[0]][s[1]].value_type)),"time"==l&&(l="string"),!(l==o||"string"==l&&"text"==o||null==l||null==o)},addCustomField:function(){this.options.fields.push({name:"",idx:null})},removeCustomField:function(e){this.options.fields.splice(e,1)}},template:'<div> <b-field :label="\'Добавить метки\'|gettext"> <b-taginput v-model="options.tags" attached confirm-key-codes=\'[13]\'></b-taginput> </b-field> <div v-if="options.fields && options.fields.length"> <label class="label has-mt-2">{{\'Настраиваемые поля\'|gettext}}</label> <div v-for="(f, i) in options.fields" class="row row-small has-mb-2" :class="{\'has-error\': hasErrors(f.idx, f.field)}"> <div class="col-xs-5"> <vue-component-select-custom-fields v-model="f.idx" :values="values"></vue-component-select-custom-fields> </div> <div class="col-xs"> <b-select :placeholder="placeholderField" v-model="f.field" expanded> <option :value="null">{{placeholderField}}</option> <optgroup :label="k" v-for="(g, k) in variants.custom_fields" v-if="_.size(g)"> <option v-for="(v, id) in g" :value="k+\':\'+id">{{v.title}}</option> </optgroup> </b-select> </div> <div class="col-xs col-shrink"><button type="button" class="button is-danger" @click="removeCustomField(i)"><i class="fa fa-trash-alt"></i></button></div> </div> </div> <div><a @click="addCustomField" v-if="allowCustomField">{{\'Добавить настраиваемое поле\'|gettext}}</a></div> </div>'}),window.$app.defineComponent("addons.catalog.amocrm","vue-addons-catalog-amocrm-options",{props:["values","variants","addon_id","isInstalling","currentTab","isStep"],mixins:[FormModel],data:function(){return{domains:["amocrm.ru","amocrm.com"]}},created:function(){this.$io.on("events:addons.amocrm:connected",this.connected),this.$parent.setStep(!0)},destroyed:function(){this.$io.off("events:addons.amocrm:connected",this.connected)},watch:{values:function(){this.$parent.setStep(!this.values.options.pipeline)}},methods:{connected:function(e){this.values.options.auth=e.auth,this.values.options.auth_type="oauth",this.values.options.subdomain=e.subdomain,this.values.options.domain=e.domain,this.$parent.install(),this.$parent.save()},isSuccess:function(){return this.$parent.setStep(this.values.external_id),this.values.options.pipeline&&null!=this.variants.pipelines}},template:'<section class="modal-card-body modal-card-body-blocks"> <section class="content" v-if="currentTab == \'description\'"> <slot name="allow"></slot> <p>amoCRM – Система учета клиентов и сделок для отдела продаж.</p> <p>Данные с форм и магазина попадают в раздел "Заявки" вашего личного кабинета. Этот модуль поможет вести новых клиентов также и в сервисе amoCRM.</p> <p>Нет аккаунта? <a href=\'http://amocrm.ru/\' target="_blank">Зарегистрировать</a></p> </section> <section v-if="currentTab == \'options\'"> <div class="row"> <div class="col-xs-12 col-sm-6 has-xs-mb-3"> <vue-component-subdomain-field label="Адрес аккаунта" v-model="values.options.subdomain" :domain.sync="values.options.domain" :domains="domains" :error="errors.subdomain" :disabled="variants.pipelines || values.options.auth_type == \'oauth\'"></vue-component-subdomain-field> <b-field label="Логин пользователя" :message="errors.login" :class="{\'has-error\': errors.login}" v-if="values.options.auth_type == \'api_key\'"> <input type="text" class="input" v-model="values.options.login" placeholder="name@mail.ru" :disabled="variants.pipelines"> </b-field> <b-field label="API ключ пользователя" :message="errors.key" :class="{\'has-error\': errors.key}" v-if="values.options.auth_type == \'api_key\'"> <input type="text" class="input" v-model="values.options.key" :disabled="variants.pipelines"> </b-field> <b-field label="Воронка" :message="errors.pipeline" :class="{\'has-error\': errors.pipeline}" v-if="variants.pipelines"> <b-select v-model="values.options.pipeline" expanded> <option :value="null">-- Не выбрано --</option> <option v-for="(p, pipeline_id) in variants.pipelines" :value="pipeline_id">{{ p.name }}</option> </b-select> </b-field> </div> <div class="col-xs-12 col-sm-6" v-if="!values.options.auth"> <label class="label has-text-danger">Ошибка подключения</label> <a class="button is-danger" target="_blank" :href="values.install_link">Переподключить</a> </div> <div class="col-xs-12 col-sm-6" v-if="variants.pipelines"> <b-field label="Уровень синхронизации"> <b-select v-model="values.options.mode" expanded> <option v-for="(m, k) in variants.mode" :value="k">{{ m }}</option> </b-select> </b-field> <b-field label="Новая заявка попадает"> <b-select v-model="values.options.target" expanded> <option v-for="(t, k) in variants.target" :value="k">{{ t }}</option> </b-select> </b-field> <div class="field"> <label class="label">Ответственный</label> <b-select v-model="values.options.responsible_user" expanded> <option :value="null">-- Не выбрано --</option> <option v-for="(user, id) in variants.users" :value="id">{{user}}</option> </b-select> </div> <b-field label="Добавить метки"> <b-taginput v-model="values.options.tags" attached confirm-key-codes=\'[13]\'></b-taginput> </b-field> </div> </div> </section> <section v-if="(currentTab == \'options\') && (variants.pipelines && values.options.pipeline) && (variants.pipelines[values.options.pipeline] != undefined)"> <div class="row"> <div class="col-xs-12 col-sm-6 has-mb-2"> <div class="field"> <label class="label">Этапы продаж</label> </div> <div class="field"> <div class="row"> <div class="col-xs-5 form-control-static">Новая</div> <div class="col-xs-7"> <div class="select is-fullwidth block-xs"> <b-select v-model="values.options.status[1]" expanded> <option :value="null">-- Не выбрано --</option> <option v-for="p in variants.pipelines[values.options.pipeline].statuses" :value="p.id">{{ p.name }}</option> </b-select> </div> </div> </div> </div> <div class="field"> <div class="row"> <div class="col-xs-5 form-control-static">В работе</div> <div class="col-xs-7"> <div class="select is-fullwidth block-xs"> <b-select v-model="values.options.status[2]" expanded> <option :value="null">-- Не выбрано --</option> <option v-for="p in variants.pipelines[values.options.pipeline].statuses" :value="p.id">{{ p.name }}</option> </b-select> </div> </div> </div> </div> <div class="field"> <div class="row"> <div class="col-xs-5 form-control-static">Выполнена</div> <div class="col-xs-7"> <div class="select is-fullwidth block-xs"> <b-select v-model="values.options.status[3]" expanded> <option :value="null">-- Не выбрано --</option> <option v-for="p in variants.pipelines[values.options.pipeline].statuses" :value="p.id">{{ p.name }}</option> </b-select> </div> </div> </div> </div> <div class="field"> <div class="row"> <div class="col-xs-5 form-control-static">Отменена</div> <div class="col-xs-7"> <div class="select is-fullwidth block-xs"> <b-select v-model="values.options.status[4]" expanded> <option :value="null">-- Не выбрано --</option> <option v-for="p in variants.pipelines[values.options.pipeline].statuses" :value="p.id">{{ p.name }}</option> </b-select> </div> </div> </div> </div> </div> <div class="col-xs-12 col-sm-6"> <div class="field"> <label class="label">Поля формы</label> </div> <div class="field"> <div class="row"> <div class="col-xs-5 form-control-static">Телефон</div> <div class="col-xs-7"> <div class="select is-fullwidth block-xs has-mb-1"> <b-select v-model="values.options.fields.phone" expanded> <option :value="null">-- Не выбрано --</option> <option v-for="(name, field_id) in variants.fields" :value="field_id">{{ name }}</option> </b-select> </div> <div class="select is-fullwidth block-xs"> <b-select v-model="values.options.fields.phone_enum" expanded> <option value="WORK">Рабочий</option> <option value="WORKDD">Рабочий прямой</option> <option value="MOB">Мобильный</option> <option value="FAX">Факс</option> <option value="HOME">Домашний</option> </b-select> </div> </div> </div> </div> <div class="field"> <div class="row"> <div class="col-xs-5 form-control-static">Email</div> <div class="col-xs-7"> <div class="select is-fullwidth block-xs has-mb-1"> <b-select v-model="values.options.fields.email" expanded> <option :value="null">-- Не выбрано --</option> <option v-for="(name, field_id) in variants.fields" :value="field_id">{{ name }}</option> </b-select> </div> <div class="select is-fullwidth block-xs"> <b-select v-model="values.options.fields.email_enum" expanded> <option value="WORK">Рабочий</option> <option value="PRIV">Личный</option> </b-select> </div> </div> </div> </div> </div> </div> </section> </section>'}),window.$app.defineModule("addons.catalog.amocrm",[]);
