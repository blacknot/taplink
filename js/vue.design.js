var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};window.$app.defineComponent("design","vue-design-editor-modal",{props:["theme","group_id","design_id"],methods:{themeChanged:function(e){this.$parent.$parent.themeChanged(e)},cancel:function(){this.$parent.$parent.editThemeCancel(),this.$parent.close()},save:function(){this.$parent.$parent.editThemeSave(),this.$parent.close()},onAction:function(e){switch(e){case"section_add":$refs.editor.sectionAdd()}}},template:'<div class="modal-card design-modal-form"> <header class="modal-card-head"> <p class="modal-card-title">{{\'Редактирование дизайна\'|gettext}}</p> <button class="modal-close is-large" @click="cancel"></button> </header> <section class="modal-card-body is-paddingless" style="position: relative"> <vue-design-editor :theme="theme" :group_id="group_id" :design_id="design_id" @update:theme="themeChanged" ref="editor"></vue-design-editor> </section> <footer class="modal-card-foot level"> <div class="level-left"> <vue-component-action-button @action="onAction" :title="\'Действие\'|gettext"> <template slot="actions"> <b-dropdown-item value="section_add"><i class="fa fa-plus has-mr-1"></i>{{\'Добавить новую секцию\'|gettext}}</b-dropdown-item> </template> </vue-component-action-button> </div> <div class="level-right"> <button class="button is-primary" @click="save">{{\'Сохранить\'|gettext}}</button> </div> </footer> </div>'}),window.$app.defineComponent("design","vue-design-editor",{data:function(){return{part:1,linkHovers:[this.$gettext("Нет"),this.$gettext("Прозрачность"),this.$gettext("Увеличение")]}},props:["theme","group_id","design_id"],watch:{theme:{handler:function(){this.$emit("update:theme",this.theme)},deep:!0},part:function(e){var t=null;switch(e){case"block":this.$parent.view="pictures",t=$mx(this.$refs.b3);break;default:"string"==typeof e&&"s"==e.substring(0,1)?(t=$mx(this.$refs[e]),this.$parent.view="section",this.$parent.section=e.substring(1)):(t=$mx(this.$refs["b"+e]),this.$parent.view="")}this.$device.mobile&&this.$nextTick(function(){scrollIt(t.position().top+1,"y",t.closest("section")[0])}),this.$emit("update:theme",this.theme)}},computed:{isAllow:function(){return 0==this.design_id||this.$auth.isAllowEndpoint("design/manage/update")}},methods:{addExtended:function(){this.theme.options.extended.items.push({title:{en:""},html:"",css:""}),this.editExtended(this.theme.options.extended.items.length-1)},baseCssExtended:function(){var t=this;this.$modal("vue-design-extended-form",{extended:this.theme.options.extended,index:-1}).then(function(e){e.$on("save",function(e){t.theme.options.extended.base=e})})},editExtended:function(t){var i=this;this.$modal("vue-design-extended-form",{extended:this.theme.options.extended,index:t}).then(function(e){e.$on("save",function(e){i.$set(i.theme.options.extended.items,t,e)})})},deleteExtended:function(e){var t=this;this.$confirm("Удалить анимацию?").then(function(){t.$delete(t.theme.options.extended.items,e)})},properyChanged:function(e,t,i,s){var n=3<arguments.length&&void 0!==s&&s;return this.isAllow?StylesFactory.properyChanged(e,t,i,n,this):null},selectPart:function(e){this.part=this.part==e?null:e},sectionAdd:function(){var i=this;this.$confirm(this.$gettext("Добавить новую секцию?")).then(function(){var e=++i.theme.options.sections._,t=i.theme.options;i.$set(i.theme.options.sections,e,StylesFactory.getDefaultSection(t)),i.part="s"+e,i.$device.mobile||i.$nextTick(function(){t=$mx(i.$refs[i.part]),scrollIt(t.offset().top-35,"y")})})},sectionDelete:function(e){var t=this;this.$confirm(this.$gettext("Вы хотите удалить эту секцию?")).then(function(){t.$delete(t.theme.options.sections,e)})}},template:'<div :class="{disabled: !isAllow || !$auth.isAllowTariff(\'pro\')}" v-if="theme"> <div class="design-panel is-white" :class="{in: part== 1}" ref=\'b1\'> <p @click="selectPart(1)">{{\'Общие\'|gettext}}</p> <div> <div class="has-mb-2"> <vue-component-colorpicker v-model="theme.options.avatar.color" :label="\'Цвет названия профиля\'|gettext"/> </div> <div class="has-mb-2 with-label color-picker-container"> <label class="form-control-static">{{\'Заголовок\'|gettext}}</label> <div class="component-group"> <vue-component-font-weight-chooser v-model="theme.options.heading.weight" :with-arrow="false" :font="theme.options.heading.font"/> <vue-component-text-transform-chooser v-model="theme.options.heading.transform" :with-arrow="false"/> <vue-component-font-chooser v-model="theme.options.heading.font" view="name"/> <vue-component-colorpicker v-model="theme.options.heading.color" design="circle" :with-arrow="false" position-horizontal="left"/> </div> </div> <div class="with-label color-picker-container"> <label class="form-control-static">{{\'Текст\'|gettext}}</label> <div class="component-group"> <vue-component-font-chooser v-model="theme.options.screen.font" view="name"/> <vue-component-colorpicker v-model="theme.options.screen.color" design="circle" :with-arrow="false" position-horizontal="left"/> </div> </div> </div> </div> <div class="design-panel is-white" :class="{in: part== 2}" ref=\'b2\'> <p @click="selectPart(2)">{{\'Ссылки\'|gettext}}</p> <div> <div class="has-mb-2 with-label color-picker-container"> <label class="form-control-static">{{\'Заголовок ссылки\'|gettext}}</label> <div class="component-group"> <vue-component-font-weight-chooser v-model="theme.options.link.weight" :with-arrow="false" :font="theme.options.link.font"/> <vue-component-text-transform-chooser v-model="theme.options.link.transform" :with-arrow="false" :font="theme.options.link.transform"/> <vue-component-font-chooser v-model="theme.options.link.font" view="name"/> <vue-component-colorpicker v-model="theme.options.link.color" design="circle" :with-arrow="false" position-horizontal="left"/> </div> </div> <div class="has-mb-2 with-label color-picker-container"> <label class="form-control-static">{{\'Подзаголовок ссылки\'|gettext}}</label> <div class="component-group"> <vue-component-font-chooser v-model="theme.options.link.subtitle.font" view="name"/> <vue-component-colorpicker v-model="theme.options.link.subtitle.color" design="circle" :with-arrow="false" position-horizontal="left"/> </div> </div> <div class="has-mb-2"> <vue-component-colorpicker v-model="theme.options.link.bg" :label="\'Цвет фона ссылки\'|gettext"/> </div> <div class="has-mb-2 link-styles-container"> <label class="form-control-static">{{\'Прозрачность ссылки\'|gettext}}</label> <vue-component-design-transparent-cooser v-model="theme.options.link.transparent" :disabled="!isAllow"/> </div> <transition name="fade"> <div class="has-mb-2 link-styles-container" v-if="theme.options.link.transparent"> <label class="form-control-static">{{\'Толщина границы\'|gettext}}</label> <input type="number" v-model.number="theme.options.link.border.width" max="10" min="0" class="input" style="width: 100px"> </div> </transition> <div class="has-mb-2 link-styles-container"> <label class="form-control-static">{{\'Тень ссылки\'|gettext}}</label> <vue-component-design-shadow-chooser v-model="theme.options.link.shadow"/> </div> <div class="has-mb-2 link-styles-container"> <label class="form-control-static">{{\'Эффект при наведении\'|gettext}}</label> <div class="select is-hidden-mobile"> <select v-model="theme.options.link.hover" :disabled="!isAllow"> <option v-for="(v, k) in linkHovers" :value="k">{{v}}</option> </select> </div> <vue-component-dropdown position="is-bottom-left" v-model="theme.options.link.hover" :disabled="!isAllow" :title="\'Эффект при наведении\'|gettext" class="is-hidden-tablet" button-class="button is-default is-focusable"> <span slot="button">{{linkHovers[theme.options.link.hover]}}</span> <b-dropdown-item v-for="(v, k) in linkHovers" :value="k" aria-role="menuitem">{{v}}</b-dropdown-item> </vue-component-dropdown> </div> <div class="has-mb-2 link-styles-container"> <label class="form-control-static">{{\'Скругление ссылки\'|gettext}}</label> <vue-component-design-radius-chooser v-model="theme.options.link.radius"></vue-component-design-radius-chooser> </div> <div class="has-mb-2 link-styles-container"> <label class="form-control-static">{{\'Стиль ссылки\'|gettext}}</label> <ul class="link-styles"> <li class="link-styles-center" :class="{in: theme.options.link.align == \'center\'}" @click="theme.options.link.align = \'center\'"><dd></dd></li> <li class="link-styles-left fa" :class="{in: theme.options.link.align == \'left\'}" @click="theme.options.link.align = \'left\'"><dd></dd></li> </ul> </div> <transition name="fade"> <div class="link-styles-container" v-if="theme.options.link.align == \'center\'"> <label class="form-control-static">{{\'Миниатюра\'|gettext}}</label> <ul class="link-styles link-thumbs"> <li class="link-thumb-left" :class="{in: theme.options.link.thumb == \'left\'}" @click="theme.options.link.thumb = \'left\'"><dt></dt><dd></dd><dt></dt></li> <li class="link-thumb-center" :class="{in: theme.options.link.thumb == \'center\'}" @click="theme.options.link.thumb = \'center\'"><dt></dt><dd></dd><dt></dt></li> </ul> </div> </transition> </div> </div> <div class="design-panel is-white" :class="{in: part== \'block\'}" ref=\'b3\'> <p @click="selectPart(\'block\')">{{\'Блоки\'|gettext}}</p> <div> <div class="link-styles-container has-mb-2"> <label class="form-control-static">{{\'Скругление блока\'|gettext}}</label> <vue-component-design-radius-chooser v-model="theme.options.block.radius"></vue-component-design-radius-chooser> </div> <div class="link-styles-container"> <label class="form-control-static">{{\'Карусель картинок\'|gettext}}</label> <vue-component-design-pictures-chooser v-model="theme.options.block.pictures"/> </div> </div> </div> <div class="design-panel is-white" :class="{in: part== 4}" ref=\'b4\'> <p @click="selectPart(4)">{{\'Фон\'|gettext}}</p> <div> <vue-component-background-editor v-model="theme.options.bg"/> <mx-toggle v-model="theme.options.bg.fixed" :space-between="true" :title="\'Фиксировать при прокрутке\'|gettext" class="has-mb-2"></mx-toggle> </div> </div> <div class="design-panel is-white" :class="{in: part== 5}" ref=\'b5\' v-if="$auth.hasFeature(\'design_animations\')"> <p @click="selectPart(5)">{{\'Анимация\'|gettext}}</p> <div> <b-table :data="theme.options.extended.items" :mobile-cards="false" class="table-header-hide has-mb-2" v-if="theme.options.extended.items.length"> <b-table-column field="title" v-slot="props"> <div style="display: flex;justify-content: space-between"> <span> <span v-if="props.row.title.en">{{props.row.title.en}}</span> <span class="has-text-grey" v-else>{{\'Без имени\'|gettext}}</span> </span> <span> <a @click="deleteExtended(props.index)" class="has-text-danger">{{\'Удалить\'|gettext}}</a><span class="has-ml-1 has-mr-1">&bull;</span> <a @click="editExtended(props.index)">{{\'Редактировать\'|gettext}}</a> </span> </div> </b-table-column> </b-table> <button class="button is-light" @click="addExtended"><i class="fa fa-plus has-mr-1"></i>{{\'Новая анимация\'|gettext}}</button> <button class="button is-light" @click="baseCssExtended">{{\'Базовые стили\'|gettext}}</button> </div> </div> <div class="design-panel is-white" :class="{in: part== \'s\' + i}" v-for="(s, i) in theme.options.sections" v-if="i != \'_\'" :ref="\'s\'+i"> <p @click="selectPart(\'s\' + i)">{{\'Секция\'|gettext}}<span v-if="_.size(theme.options.sections)> 2"> {{i}} </span> <a class="has-text-danger is-text has-ml-2" @click.prevent.stop="sectionDelete(i)" v-if="part == \'s\' + i"><i class="fal fa-trash-alt"></i></a></p> <div> <div class="link-styles-container has-mb-2"> <label class="form-control-static">{{\'Отступ сверху\'|gettext}}</label> <div style="width:120px"> <div class="row row-small"> <div class="col-xs col-shrink" style="display: flex;align-items: center"> <b v-if="s.padding.top">{{s.padding.top}}x</b> <b v-else>{{\'Нет\'|gettext}}</b> </div> <div class="col-xs"> <b-slider :min="0" :max="4" :tooltip="false" v-model="s.padding.top" size="is-line" rounded> <template v-for="(s, i) in [0, 1, 2, 3, 4, 5]"> <b-slider-tick :value="i" :key="i"></b-slider-tick> </template> </b-slider> </div> </div> </div> </div> <div class="link-styles-container has-mb-2"> <label class="form-control-static">{{\'Отступ снизу\'|gettext}}</label> <div style="width:120px"> <div class="row row-small"> <div class="col-xs col-shrink" style="display: flex;align-items: center"> <b v-if="s.padding.bottom">{{s.padding.bottom}}x</b> <b v-else>{{\'Нет\'|gettext}}</b> </div> <div class="col-xs"> <b-slider :min="0" :max="4" :tooltip="false" v-model="s.padding.bottom" size="is-line" rounded> <template v-for="(s, i) in [0, 1, 2, 3, 4, 5]"> <b-slider-tick :value="i" :key="i"></b-slider-tick> </template> </b-slider> </div> </div> </div> </div> <mx-toggle v-model="s.indent.on" :space-between="true" :title="\'Отступ сбоку\'|gettext" :disabled="s.bg.size == \'adaptive\'"></mx-toggle> <div class="has-mt-2 link-styles-container" v-if="s.indent.on"> <label class="form-control-static">{{\'Скругление секции\'|gettext}}</label> <vue-component-design-radius-chooser v-model="s.indent.radius"></vue-component-design-radius-chooser> </div> </div> <div> <vue-component-background-editor v-model="s.bg" :sizes="s.indent.on?[\'width\', \'tile\']:[\'adaptive\', \'width\', \'tile\']" :withOpacityBackground="true"/> </div> <div> <div class="link-styles-container has-mb-2"> <label class="form-control-static"><span :class="properyChanged(theme.options.heading, s.heading, \'heading\')" @click="properyChanged(theme.options.heading, s.heading, \'heading\', true)">{{\'Заголовок\'|gettext}}</span></label> <div class="component-group"> <vue-component-font-weight-chooser v-model="s.heading.weight" :with-arrow="false" :font="s.heading.font"/> <vue-component-text-transform-chooser v-model="s.heading.transform" :with-arrow="false"/> <vue-component-font-chooser v-model="s.heading.font" view="name"/> <vue-component-colorpicker v-model="s.heading.color" design="circle" :withArrow="false" position-horizontal="left"/> </div> </div> <div class="link-styles-container"> <label class="form-control-static"><span :class="properyChanged(theme.options.screen, s.text, \'text\')" @click="properyChanged(theme.options.screen, s.text, \'text\', true)">{{\'Текст\'|gettext}}</span></label> <div class="component-group"> <vue-component-font-chooser v-model="s.text.font" view="name"/> <vue-component-colorpicker v-model="s.text.color" design="circle" :withArrow="false" position-horizontal="left"/> </div> </div> </div> <div> <div class="link-styles-container has-mb-2"> <label class="form-control-static"><span :class="properyChanged(theme.options.link, s.link, \'link\')" @click="properyChanged(theme.options.link, s.link, \'link\', true)">{{\'Цвет заголовка ссылки\'|gettext}}</span></label> <vue-component-colorpicker v-model="s.link.color" :disabled="!isAllow" position-horizontal="left"/> </div> <div class="link-styles-container has-mb-2"> <label class="form-control-static"><span :class="properyChanged(theme.options.link.subtitle, s.link.subtitle, \'link.subtitle\')" @click="properyChanged(theme.options.link.subtitle, s.link.subtitle, \'link.subtitle\', true)">{{\'Цвет подзаголовка ссылки\'|gettext}}</span></label> <vue-component-colorpicker v-model="s.link.subtitle.color" :disabled="!isAllow" position-horizontal="left"/> </div> <div class="has-mb-2 link-styles-container"> <label class="form-control-static"><span :class="properyChanged(theme.options.link, s.link, \'link.bg\')" @click="properyChanged(theme.options.link, s.link, \'link.bg\', true)">{{\'Цвет фона ссылки\'|gettext}}</span></label> <vue-component-colorpicker v-model="s.link.bg" :disabled="!isAllow" position-horizontal="left"/> </div> <div class="has-mb-2 link-styles-container"> <label class="form-control-static"><span :class="properyChanged(theme.options.link, s.link, \'link.transparent\')" @click="properyChanged(theme.options.link, s.link, \'link.transparent\', true)">{{\'Прозрачность ссылки\'|gettext}}</span></label> <vue-component-design-transparent-cooser v-model="s.link.transparent" :disabled="!isAllow"/> </div> <transition name="fade"> <div class="has-mb-2 link-styles-container" v-if="s.link.transparent"> <label class="form-control-static"><span :class="properyChanged(theme.options.link.border, s.link.border, \'link.border\')" @click="properyChanged(theme.options.link.border, s.link.border, \'link.border\', true)">{{\'Толщина границы\'|gettext}}</span></label> <input type="number" v-model.number="s.link.border.width" max="10" min="0" class="input" style="width: 100px"> </div> </transition> <div class="link-styles-container"> <label class="form-control-static"><span :class="properyChanged(theme.options.link.shadow, s.link.shadow, \'link.shadow\')" @click="properyChanged(theme.options.link.shadow, s.link.shadow, \'link.shadow\', true)">{{\'Тень ссылки\'|gettext}}</span></label> <vue-component-design-shadow-chooser v-model="s.link.shadow"/> </div> </div> </div> <div class="design-panel is-plus has-text-primary is-hidden-mobile" @click="sectionAdd"><p>{{\'Добавить секцию\'|gettext}}</p></div> </div>'}),window.$app.defineComponent("design","vue-design-extended-form",{data:function(){return{data:null}},props:["extended","index"],created:function(){this.data=this.$clone(-1==this.index?this.extended.base:this.extended.items[this.index])},mounted:function(){this.update()},methods:{update:function(){StylesFactory.updateCSSBlock(this.data.css,this.$refs.styles),StylesFactory.updateCSSBlock(this.extended.base.css,this.$refs.styles_base)},save:function(){this.$parent.$emit("save",this.data),this.$parent.close()}},template:'<div class="modal-card is-fullscreen"> <header class="modal-card-head"> <p class="modal-card-title"><input type="text" v-model="data.title.en" placeholder="Без имени" class="input is-large is-paddingless" style="border: 0;box-shadow: none" v-if="index != -1"><span v-else>Базовые стили</span></p> <button class="button is-light" type="button" @click="$parent.close()">{{\'Закрыть\'|gettext}}</button> <button class="button is-primary has-ml-1" type="button" @click="save">{{\'Сохранить\'|gettext}}</button> </header> <section class="modal-card-body is-paddingless extended-editor"> <div class="row is-marginless"> <div class="col-xs-6 is-paddingless"> <div class="extended-editor-panel" v-if="index != -1"> <label>HTML</label> <vue-component-codemirror v-model="data.html"></vue-component-codemirror> </div> <div class="extended-editor-panel"> <label>CSS</label> <vue-component-codemirror v-model="data.css" mode="text/css" @input="update"></vue-component-codemirror> <label>&nbsp;</label> </div> </div> <div class="col-xs-6 is-paddingless"> <div class="extended-editor-panel"> <label>Preview</label> <div style="transform: translate(0, 0);height:100%" class="has-transparent-bg page"> <div ref=\'styles\'></div> <div ref=\'styles_base\'></div> <div class="theme-main" v-html="data.html"></div> </div> <label>&nbsp;</label> </div> </div> </div> </section> </div>'}),window.$app.defineComponent("design","vue-design-index",{data:function(){return{isUpdating:!1,isSetting:!1,isFetching:!1,isDeleting:!1,isAllowPro:!1,isScrollingThemes:!1,groups:[{group_id:0,groupname:this.$gettext("Мои дизайны")},{group_id:1,groupname:this.$gettext("Стандартные")}],designs:[],designsTitles:[],themes:{},design_id:null,theme_id:null,need_theme_id:null,current_theme_id:null,current_design_id:null,current_group_id:null,fetchingGroups:[],isFetchingThemes:!1,deltaMouseWheel:0,timerMouseWheel:null,tmpTheme:null,stopTransition:!1,deviceFix:"",devicePageFix:{},buttonsPanelFix:{},deviceParentFix:"",themeScrollIndex:0,themeIndex:0,mode:"themes",stage:0,stageEnded:!1,select_theme:null,widthDevice:395,touchClientX:0,touchClientY:0,touchMouseStarted:!1,demoText:"Lorem ipsum dolor sit amet, consectetuer adipiscing elit. Aenean commodo ligula eget dolor. Aenean massa. Cum sociis natoque penatibus et magnis dis parturient montes, nascetur ridiculus mus.",view:"",section:null,widthScrollView:0,buttonsHide:!0,viewModal:null}},props:{group_id:Number,page_id:Number},created:function(){this.isAllowPro=this.$auth.isAllowTariff("pro"),this.select_theme=this.$account.theme,this.current_theme_id=this.$account.theme_id,this.$page.fetchData(this.page_id,!1),this.group_id=parseInt(this.group_id),$mx(window).on("resize orientationchange scroll",this.scrollCheck)},destroyed:function(){$mx(window).off("resize orientationchange scroll",this.scrollCheck)},beforeRouteEnter:function(e,t,i){$mx(document.body).addClass("is-hide-support"),i()},beforeRouteLeave:function(e,t,i){"edit"==this.mode&&this.editThemeCancel(),"view_modal"==this.mode&&this.viewThemeCancel(),$mx(document.body).removeClass("is-hide-support"),i()},computed:{showAdminButton:function(){return"themes"==this.mode&&this.isAdmin&&null!=this.themes[this.design_id]},withView:function(){return 1<this.$page.data.blocks_order.length},show_theme_editor:function(){return!this.$auth.isAllowTariff("pro")&&!this.design_id&&!this.isFetching&&!this.$device.mobile&&null!=this.themes[0]&&this.themes[0].length<2},theme_editor:function(){return this.show_theme_editor?this.prepare_theme_editor(this.$account.theme):this.tmpTheme},translateThemesScroll:function(){var e=Math.max(0,null==this.themes[this.design_id]?0:this.widthDevice*this.themes[this.design_id].length-this.widthScrollView),t=this.themeScrollIndex*this.widthDevice+this.deltaMouseWheel;return-(this.$device.mobile?t:Math.min(e,Math.max(0,t-(this.widthScrollView-this.widthDevice)/2)))},isAdmin:function(){return this.$auth.isAllowEndpoint("design/manage/list")||this.$auth.isAllowEndpoint("design/manage/move")||this.$auth.isAllowEndpoint("design/manage/clone")||this.$auth.isAllowEndpoint("design/manage/reorder")},menu:function(){return _.map(this.groups,function(e,t){return{meta:{title:e.groupname},params:{group_id:e.group_id}}})},designTitle:function(){return"edit"==this.mode?"":"view"==this.mode?this.$gettext("Предпросмотр"):0==this.design_id?this.$gettext("Мои дизайны"):null!=this.designsTitles[this.design_id]?this.$gettext(this.designsTitles[this.design_id]):this.$gettext("Выберите цветовую схему")},showSection:function(){return"section"==this.view}},mixins:[FormModel],watch:{group_id:function(e){this.group_id=parseInt(e),this.scrollCheckForce(),this.fetchData(),"edit"==this.mode&&this.editThemeCancel(),"view"!=this.mode&&"view_modal"!=this.mode||this.viewThemeCancel()},theme_id:function(e){this.setThemeId(e)}},methods:{keyboardMove:function(e){var t;"edit"!=this.mode&&null!=this.themes[this.design_id]&&(t=this.themes[this.design_id],37==e.keyCode&&0<this.themeIndex&&this.prevTheme(),39==e.keyCode&&this.themeIndex<t.length-1&&this.nextTheme(),27==e.keyCode&&"view"==this.mode&&this.viewThemeCancel())},nextTheme:function(){var e=this.themes[this.design_id];this.setThemeId(e[this.themeIndex+1].theme_id,!0)},prevTheme:function(){var e;0==this.group_id&&1==this.themeIndex||(e=this.themes[this.design_id],this.setThemeId(e[this.themeIndex-1].theme_id,!0))},nextScroll:function(){"view"==this.mode?this.nextTheme():this.themeScrollIndex=Math.min(this.themes[this.design_id].length-1,this.themeScrollIndex+Math.floor(this.$refs.device.clientWidth/this.widthDevice))},prevScroll:function(){"view"==this.mode?this.prevTheme():this.themeScrollIndex=Math.max(0,this.themeScrollIndex-Math.floor(this.$refs.device.clientWidth/this.widthDevice))},scrollCheckForce:function(e){var t=this;setTimeout(function(){t.$nextTick(t.scrollCheck)},0<arguments.length&&void 0!==e?e:200)},scrollCheck:function(){var e,t,i,s,n,o,l,d,a;null!=this.$refs.device&&(e=window.scrollY,t=window.innerHeight||document.documentElement.clientHeight,i=null==this.$refs.buttonsPanel?0:this.$refs.buttonsPanel.clientHeight,s=e>this.$refs.device.offsetTop,this.widthScrollView=this.$refs.device.clientWidth,n=$mx(this.$refs.device).offset().top,o=$mx(".device-container").height(),l="edit"==this.mode&&35<document.documentElement.scrollHeight-(o+35)-e-35,this.deviceFix=s&&this.stageEnded?l?"position:fixed;top:35px;left:auto;":"margin-bottom: 2rem;":"",this.devicePageFix=s&&this.stageEnded?l?{position:"fixed",top:"35px",left:"auto"}:{left:"auto",bottom:"35px"}:null,this.deviceParentFix=!s||!this.stageEnded||l?"":"bottom: 0",this.widthDevice=this.$device.mobile?253:310,-1!=["edit","view"].indexOf(this.mode)?s&&l?this.buttonsPanelFix={top:Math.min(650,t-i-60)+"px",bottom:"auto"}:(d=t+e-i+60<n+o?t+e-i+60-n-o+(l?10:-10):0,this.buttonsPanelFix={transform:this.$device.mobile?null:"translate(0, "+d+"px)"}):(a=t+e-i+60<n+o?t+e-i+45-n-o:-15,this.buttonsPanelFix={transform:this.$device.mobile?null:"translate("+this.themeIndex*this.widthDevice+"px, "+a+"px)"}))},setThemeId:function(e,t){var i=1<arguments.length&&void 0!==t&&t,s=0;this.select_theme=this.themes[this.design_id][0];for(var n=0;n<this.themes[this.design_id].length;n++){var o=this.themes[this.design_id][n];if(o.theme_id==e){s=n,this.select_theme=o;break}}this.theme_id=e,(this.$device.mobile||i)&&(this.themeScrollIndex=s),this.themeIndex=s,"view"!=this.mode&&"view_modal"!=this.mode||this.viewTheme(),this.scrollCheck()},themeChanged:function(e){this.$nextTick(this.scrollCheck),this.prepareThemes([e])},onAction:function(e){var i=this;switch(e){case"clone":this.cloneTheme();break;case"manage":this.$modal("vue-design-manage-form",{},this);break;case"move":this.$modal("vue-design-move-form",{theme_id:this.theme_id},this);break;case"delete":this.deleteTheme();break;case"right":case"left":var s="right"==e?1:-1,n=this.themes[this.design_id],o=n[this.themeIndex+s];this.$api.get("design/manage/reorder",{design_id:this.design_id,theme_ids:[n[this.themeIndex].theme_id,o.theme_id]}).then(function(e){var t;"success"==e.result&&(t=n[i.themeIndex+s]=n[i.themeIndex],n[i.themeIndex]=o,i.$forceUpdate(),i.setThemeId(t.theme_id,!0))});break;case"tariff":var t="basic"==this.select_theme.tariff?"pro":"basic";this.$api.get("design/manage/tariff",{theme_id:this.theme_id,tariff:t}).then(function(e){i.select_theme.tariff=t})}},cloneTheme:function(){this.editThemeInternal()},viewTheme:function(){var t=this,i=this.select_theme;this.$device.mobile?this.$modal("vue-design-view-modal",{theme:i,page_id:this.page_id},this).then(function(e){t.viewModal=e,t.mode="view_modal"}):(this.stopTransition=!0,this.buttonsHide=!0,this.mode="view",this.stage=1,this.$nextTick(function(){t.stopTransition=!1,t.scrollCheckForce();var e={};t.$page.prepareSections(Vue.prototype.$page.data,e,i.options,".theme"+i.theme_id,"view"),StylesFactory.updateCSSBlock(e,t.$refs.styles_view),t.buttonsHide=!1}))},prepare_theme_editor:function(e){var i=this.$clone(e);return i.options=_.merge(StylesFactory.getBaseStyles(),i.options,!0),_.each(i.options.sections,function(e,t){"_"!=t&&(i.options.sections[t]=_.merge(StylesFactory.getDefaultSection(i.options),e,!0))}),i},editTheme:function(){var e,t=this;this.isAllowPro?this.design_id&&!this.$auth.isAllowEndpoint("design/manage/update")?this.$confirm(this.$gettext("Вы хотите создать новый дизайн на основе этого?"),"is-warning",{yes:this.$gettext("Да"),no:this.$gettext("Нет")}).then(this.editThemeInternal):(e=this.prepare_theme_editor(this.themes[this.design_id][this.themeIndex]),this.tmpTheme=e,this.$device.mobile?this.$modal("vue-design-editor-modal",{theme:this.tmpTheme,group_id:this.group_id,design_id:this.design_id},this):(this.stageEnded=!1,this.$nextTick(function(){t.mode="edit",t.stage=1,console.log($mx(t.$refs.themesList)),t.$refs.themesList.addEventListener("transitionend",function(){alert("end")},{once:!0}),setTimeout(function(){t.stage=2,t.scrollCheck(),setTimeout(function(){t.stage=3,t.stageEnded=!0,t.scrollCheckForce(0)},300)},200)}))):this.$alert(this.$gettext("Свой дизайн доступен на PRO-тарифе"),"is-danger")},editThemeInternal:function(){var i=this;this.isUpdating=!0,this.$api.post("design/create",{theme_id:this.theme_id},this).then(function(e){var t;"success"==e.result&&((t=e.response).themes=_.map(t.themes,function(e){return e.theme_id&&(e.options=StylesFactory.checkStyles(e.options)),e}),null==i.designs[0]&&(i.designs[0]=[]),i.prepareThemes(t.themes),i.themes[0]=t.themes,0==i.group_id?i.$nextTick(function(){i.setThemeId(t.theme_id),i.editTheme()}):(i.need_theme_id=t.theme_id,i.$router.push({name:"design",params:{page_id:i.page_id,group_id:0}}))),i.isUpdating=!1}).catch(function(e){i.isUpdating=!1})},viewThemeCancel:function(){var e=this;this.stopTransition=!0,this.buttonsHide=!0,this.mode="themes",this.stage=0,null!=this.viewModal&&(this.viewModal.close(),this.viewModal=null),setTimeout(function(){e.stopTransition=!1,e.buttonsHide=!1,e.scrollCheck()},200)},editThemeCancel:function(){var e=this;this.stopTransition=!0,this.buttonsHide=!0,this.view="",this.section=null,this.prepareThemes(this.themes[this.design_id]),this.tmpTheme=null,this.stage=0,this.mode="themes",null!=this.viewModal&&(this.viewModal.close(),this.viewModal=null),setTimeout(function(){e.stopTransition=!1,e.buttonsHide=!1,e.scrollCheck()},200)},editThemeSave:function(){var t=this,i=this.themes[this.design_id][this.themeIndex]=this.select_theme=this.tmpTheme;this.isUpdating=!0;var s,n=_.differenceWith(i.options,StylesFactory.getBaseStyles());null!=n.bg&&null!=n.bg.picture&&null!=n.bg.picture.link&&null!=n.bg.picture.picture_id&&delete n.bg.picture.link,null!=i.options.sections&&1<_.size(i.options.sections)&&(n.sections=_.clone(i.options.sections),null!=n.sections&&1<_.size(n.sections)&&(s=StylesFactory.getDefaultSection(i.options),_.each(n.sections,function(e,t){"object"==(void 0===e?"undefined":_typeof(e))&&(n.sections[t]=_.differenceWith(e,s))}))),this.$api.post("design/update",{theme_id:this.theme_id,options:n},this).then(function(e){"success"==e.result&&t.theme_id==t.current_theme_id&&(t.$account.theme=i.options,t.$auth.refreshStyles()),t.isUpdating=!1,t.editThemeCancel()}).catch(function(e){t.isUpdating=!1})},newTheme:function(){var e=this;this.isAllowPro?this.$confirm(this.$gettext("Вы хотите создать новый дизайн?"),"is-warning",{yes:this.$gettext("Да"),no:this.$gettext("Нет")}).then(function(){e.editThemeInternal()}):this.$alert(this.$gettext("Свой дизайн доступен на PRO-тарифе"),"is-danger")},themesTouchstart:function(e){this.touchClientX=e.clientX||e.changedTouches[0].clientX,this.touchClientY=e.clientY||e.changedTouches[0].clientY,$mx("html").addClass("is-dragging"),null==e.changedTouches&&(this.touchMouseStarted=!0),this.stopTransition=!0},themesTouchstop:function(){$mx("html").removeClass("is-dragging"),this.stopTransition=!1,this.deltaMouseWheel<-20&&0<this.themeIndex?this.themeScrollIndex--:20<this.deltaMouseWheel&&this.themeIndex<this.themes[this.design_id].length-1&&this.themeScrollIndex++,this.$device.mobile&&(this.theme_id=this.themes[this.design_id][this.themeScrollIndex].theme_id),this.touchMouseStarted=!1,this.deltaMouseWheel=0},themesMouseWheel:function(e){var t=this,i=deltaY=0;null!=e.changedTouches?(i=this.touchClientX-e.changedTouches[0].clientX,deltaY=this.touchClientY-e.changedTouches[0].clientY,this.themesTouchstart(e)):this.touchMouseStarted?(i=this.touchClientX-e.clientX,deltaY=this.touchClientY-e.clientY,this.touchClientX=e.clientX,this.touchClientY=e.clientY):(i=e.deltaX||0,deltaY=e.deltaY||0),"themes"==this.mode&&Math.abs(i)>Math.abs(deltaY)&&(e.preventDefault(),this.deltaMouseWheel+=i,this.isScrollingThemes=!0,this.deltaMouseWheel<0&&0==this.themeScrollIndex&&(this.deltaMouseWheel=0),0<this.deltaMouseWheel&&null!=this.themes[this.design_id]&&this.themeScrollIndex==this.themes[this.design_id].length-1&&(this.deltaMouseWheel=0),395<this.deltaMouseWheel?(this.themeScrollIndex++,this.deltaMouseWheel-=395):this.deltaMouseWheel<-395&&(this.themeScrollIndex--,this.deltaMouseWheel+=395),this.$device.mobile&&(this.theme_id=this.themes[this.design_id][this.themeScrollIndex].theme_id),e.deltaX&&(this.timerMouseWheel&&clearTimeout(this.timerMouseWheel),this.timerMouseWheel=setTimeout(function(){200<t.deltaMouseWheel?t.themeScrollIndex++:t.deltaMouseWheel<-200&&t.themeScrollIndex--,t.$device.mobile&&(t.theme_id=t.themes[t.design_id][t.themeScrollIndex].theme_id),t.deltaMouseWheel=0,t.timerMouseWheel=null},250)))},fetchData:function(e){var i,s=this;null==this.designs[this.group_id]?(i=this.group_id,this.isFetchingThemes=this.isFetching=e,this.fetchingGroups[i]=[1,2,3],_.size(this.designs)?(this.buttonsHide=!0,this.$api.get("design/designs",{group_id:i}).then(function(e){s.buttonsHide=s.isFetchingThemes=s.isFetching=!1;var t=e.response;s.fetchingGroups[i]=[],s.$set(s.designs,i,s.prepareDesigns(t.designs)),s.selectDesign(i?s.designs[i][0].design_id:0),s.scrollCheckForce()})):this.$api.get("design/current",{group_id:-1==i?null:i}).then(function(e){s.fetchingGroups[i]=[],s.buttonsHide=s.isFetchingThemes=s.isFetching=!1;var t=e.response;t.group_id!=s.group_id&&s.$router.replace({name:"design",params:{group_id:t.group_id}}),s.groups=t.groups,s.designs[t.group_id]=s.prepareDesigns(t.designs),s.group_id=t.group_id,s.themes[t.design_id]=_.map(t.themes,function(e){return e.theme_id&&(e.options=StylesFactory.checkStyles(e.options)),e}),s.design_id=t.design_id,s.current_design_id=t.current_design_id,s.current_group_id=t.current_group_id,s.prepareThemes(t.themes),s.setThemeId(t.theme_id,!0),s.scrollCheckForce(),s.$nextTick(function(){s.moveDesignMenu(0)})})):this.current_group_id==this.group_id?this.selectDesign(this.current_design_id):this.selectDesign(this.group_id?this.designs[this.group_id][0].design_id:0)},prepareDesigns:function(e){var t=this;return _.each(e,function(e){null!=e.options&&(e.options=StylesFactory.checkStyles(e.options),e.styles=t.buildStyles(e),e.title&&(t.designsTitles[e.design_id]=e.title))}),e},prepareThemes:function(e){var i=this,s="";_.each(e,function(e){var t=Object.assign({},e.options);e.theme_id&&(s+=buildStyles(t,"design",".theme"+e.theme_id)),i.showSection&&(styles_sections={},StylesFactory.prepareSectionStyles(_.merge(StylesFactory.getDefaultSection(t),t.sections[i.section]),1,t,styles_sections,".theme"+e.theme_id,"design"),s+=_.values(styles_sections["s:1"]).join("\n"))}),StylesFactory.updateCSSBlock(s,this.$refs.styles)},fetchThemes:function(s){var n=this;return new Promise(function(i,e){null==n.themes[s]?(n.isFetchingThemes=!0,n.themeScrollIndex=n.themeIndex=0,n.$api.get("design/themes",{design_id:s}).then(function(e){var t=e.response;n.$set(n.themes,s,_.map(t.themes,function(e){return e.theme_id&&(e.options=StylesFactory.checkStyles(e.options)),e})),n.isFetchingThemes=!1,i(t.themes)})):i(n.themes[s])})},buildStyles:function(e){var t=this.$clone(e.options),i={html_thumb:buildStylesBackground(t,"html","thumb"),body_thumb:buildStylesBackground(t,"body","thumb")+";font-family: "+FontsFactory.getFont(t.screen.font)+";color: "+t.screen.color+(e.thumb?";background:url("+e.thumb+")":""),header_thumb:"color: "+t.heading.color+";font-family: "+FontsFactory.getFont(t.heading.font)+";text-transform:"+FontsFactory.getTransform(t.heading.transform)+";font-weight:"+FontsFactory.getWeight(t.heading.font,t.heading.weight),link:"background: "+transparentColor(t.link.transparent,t.link.bg)+";border-color:"+t.link.bg+";box-shadow: "+StylesFactory.getShadow(t.link.shadow)+";border-width:"+t.link.border.width+"px;color: "+t.link.color+";border-radius:"+t.link.radius+"px",link_class:"left"==t.link.align?"btn-link-align-left":"",page_class:StylesFactory.getPageClasses(t)};return FontsFactory.check(),i},setGroup:function(e){var t=this;this.group_id=e,this.$nextTick(function(){t.$refs.scroll.scrollTo(0,0),0==e&&t.$refs.tabs.scrollTo(0,0)})},selectDesign:function(t){var i=this;this.stopTransition=!0,this.$nextTick(function(){"edit"==i.mode&&i.editThemeCancel(),i.design_id=t,i.moveDesignMenu(),i.fetchThemes(t).then(function(e){i.prepareThemes(e),i.setThemeId(i.need_theme_id?i.need_theme_id:e.length?i.current_design_id==t?i.current_theme_id:e[0].theme_id:null,!0),i.need_theme_id&&i.editTheme(),i.need_theme_id=null,setTimeout(function(){i.stopTransition=!1},200)})})},moveDesignMenu:function(e){var t=0<arguments.length&&void 0!==e?e:300;if(null!=this.$refs.designList){var s=0,n=this.designs[this.group_id];if(n.length){for(i=0;i<n.length;i++)if(n[i].design_id==this.design_id){s=i;break}var o=this.$refs.designList.children[s];$mx.scrollIt(o.offsetLeft-(this.$refs.designList.parentNode.offsetWidth-o.offsetWidth)/2,"x",this.$refs.designList.parentNode,t)}}},setTheme:function(e){var t,i,s,n=this;if("pro"==e.tariff&&!this.isAllowPro)return this.$alert(this.$gettext("Этот дизайн доступен на PRO-тарифе"));e.is_pro&&!this.isAllowPro||(this.isSetting=!0,t=this.theme_id,i=this.design_id,s=this.group_id,this.$api.post("design/set",{theme_id:t},this).then(function(e){"success"==e.result&&(n.$account.theme_id=n.current_theme_id=t,n.$account.theme=StylesFactory.checkStyles(e.response.theme),n.current_design_id=i,n.current_group_id=s,n.$auth.refreshStyles(),n.current_theme=n.$account.theme,n.current_style=n.$account.styles,n.viewThemeCancel()),n.isSetting=!1}).catch(function(e){n.isSetting=!1}))},deleteTheme:function(){var t=this;this.$confirm(this.$gettext("Вы уверены что хотите удалить этот дизайн?"),"is-danger").then(function(){t.isDeleting=!0,t.$api.post("design/delete",{theme_id:t.theme_id},t).then(function(e){"success"==e.result&&t.removeThemeFromList(),t.isDeleting=!1})})},removeThemeFromList:function(){var e=this;this.stopTransition=!0;var t=this.themes[this.design_id];t.splice(this.themeIndex,1),this.themeIndex=Math.min(this.themeIndex,t.length-1),this.theme_id=t[this.themeIndex].theme_id,setTimeout(function(){e.stopTransition=!1},200)},clearThemesList:function(){delete this.themes[this.design_id]}},template:'<div tabindex="0" @keydown="keyboardMove" :class="[\'design-background\', {\'has-design-edit-background\': mode== \'edit\' || show_theme_editor}]"> <vue-component-submenu :menu="menu" :page_id="page_id"></vue-component-submenu> <div ref=\'styles\'></div> <div ref=\'styles_view\'></div> <div class="design-list-panel" :class="{editmode: [\'edit\', \'view\'].indexOf(mode) != -1, \'own-designs\': !group_id}"> <vue-component-vbar v-model="designs[group_id]" class="design-panel-scroller" ref=\'scroll\' shadow="horizontal" :vBarShow="false" :hBarShow="false" :vBarEnabled="false" :hBarEnabled="true" shadow-color="var(--design-shadow-color)" shadow-color-transparent="var(--design-shadow-color-transparent)"> <div class="design-list" ref="designList"> <div class="design-item" v-for="i in fetchingGroups[group_id]"> <div class="design-block"> <div style="border: 1px solid #d9d9d9;box-shadow: none;"><div> <div><div> <span class="skeleton" style="margin:0 auto;width: 60%">Text</span> <div class="design-block-btn skeleton">Link</div> </div> </div> </div></div> </div> </div> <div class="design-item" v-for="(t, index) in designs[group_id]" :class="t.styles.page_class"> <div class="design-block" :class="{in: t.design_id == design_id, current: t.design_id == current_design_id}" @click="selectDesign(t.design_id)"> <div :style="t.styles?t.styles.html_thumb:\'\'"><div :style="t.styles?t.styles.body_thumb:\'\'"> <b :style="t.styles?t.styles.header_thumb:\'\'">Heading text</b>Lorem ipsum dolor sit amet<span class="is-hidden-mobile"> consectetuer adipiscing elit</span> <div class="design-block-btn" :class="t.styles?t.styles.link_class:\'\'" :style="t.styles?t.styles.link:\'\'">{{\'Ссылка\'|gettext}}</div><div class="design-block-btn" :class="t.styles?t.styles.link_class:\'\'" :style="t.styles?t.styles.link:\'\'">{{\'Ссылка\'|gettext}}</div> </div> </div> <svg width="16" height="6" xmlns="http://www.w3.org/2000/svg" v-if="t.design_id == design_id"><path d="M0 6s1.796-.013 4.67-3.615C5.851.9 6.93.006 8 0c1.07-.006 2.148.887 3.343 2.385C14.233 6.005 16 6 16 6H0z"></svg> </div> </div> <div class="design-item" style="pointer-events: none; visibility: hidden"></div> </div> </vue-component-vbar> </div> <div :class="{\'themes-list-panel\': mode != \'edit\'}" :data-mode="mode"> <div class="themes-list-panel-left" v-if="mode != \'edit\'"></div> <div class="themes-list-button-left" :class="{hidden: (themeScrollIndex == 0) || (group_id == 0 && this.themeIndex == 1)}" @click="prevScroll" v-if="mode != \'edit\'"></div> <h4 class="has-mt-5 has-xs-mt-3 has-xs-pb-2 has-text-centered is-hidden-mobile" style="text-transform: uppercase" v-if="designTitle"> <div class="level container"><div class="level-left">{{designTitle}}</div><div class="level-right has-text-right" v-if="themes[design_id] != undefined">{{themeIndex+1}} / {{_.size(themes[design_id])}}</div></div> </h4> <div class="container themes-container" :class="{\'has-mt-4\': mode== \'edit\'}" @mousewheel="themesMouseWheel" @mousedown="themesTouchstart" @mouseup="themesTouchstop" @touchstart="themesTouchstart" @touchend="themesTouchstop" @touchmove="themesMouseWheel" @mousemove="themesMouseWheel" ref="device" @dblclick="viewTheme"> <div style="left:0;right: 0;margin: 0 1rem" :class="{\'has-text-centered\': mode != \'edit\', \'is-hidden-tablet\': !isFetchingThemes}" :style="(isFetchingThemes?\'\':\'position:absolute;\')+((mode == \'edit\')?deviceParentFix:\'\')"> <div class="device device-theme-back is-large has-shadow" :class="[{editmode: mode== \'edit\', ended: stageEnded}, \'stage\'+stage]" :style="(mode == \'edit\')?deviceFix:\'\'"> <div class="screen page" style="background: transparent !important"></div> <b-loading :is-full-page="false" :active.sync="isFetchingThemes"></b-loading> </div> </div> <div :class="$device.mobile?[]:[\'themes-list\', {editmode: mode== \'edit\' || show_theme_editor, viewmode: mode== \'view\', stoptransition: stopTransition}, \'stage\'+stage]" :style="[{display: \'flex\', transform: (stage || $device.mobile)?null:(\'translate(\'+translateThemesScroll+\'px, 0)\')}, (mode == \'edit\')?devicePageFix:null]" ref="themesList" v-if="!isFetchingThemes"> <div :class="$device.mobile?[\'themes-list\', {editmode: mode== \'edit\', viewmode: mode== \'view\', stoptransition: stopTransition}, \'stage\'+stage]:[]"> <div :style="{transform: (stage || !$device.mobile)?null:(\'translate(\'+translateThemesScroll+\'px, 0)\')}" class="device-container"> <div v-for="(t, i) in themes[design_id]" v-if="([\'edit\', \'view\'].indexOf(mode) != -1 && themeIndex== i) || ([\'edit\', \'view\'].indexOf(mode) == -1)" class="device-outer" :style="{cursor: isScrollingThemes?\'grab\':null}"> <div class="device is-large has-transparent-mobile has-shadow page-blocks" :class="[{in: themeIndex== i, current: current_theme_id== t.theme_id, editmode: mode== \'edit\'}, \'theme\'+t.theme_id]"> <div class="screen page" :class="StylesFactory.getPageClasses(((mode == \'edit\' && tmpTheme)?tmpTheme:t).options)" @click="if (!isScrollingThemes) setThemeId(t.theme_id, true); isScrollingThemes=false"> <b-loading :is-full-page="false" :active="!$page.data.page.page_id" v-if="mode == \'view\'"></b-loading> <span class="tag is-pro" v-tippy :content="\'Этот дизайн доступен на PRO-тарифе\'|gettext" v-if="(t.tariff == \'pro\') && !isAllowPro">pro</span> <div v-if="mode == \'view\'"> <div v-for="a in select_theme.options.extended.items" v-html="a.html"></div> </div> <vue-pages-page-blocks :page_id="page_id" :theme="select_theme.options" v-if="mode == \'view\'" :readonly="true" :show-hidden="false"></vue-pages-page-blocks> <div class="theme-main" v-else-if="t.theme_id"> <div v-for="a in t.options.extended.items" v-html="a.html"></div> <div class="blocks-list has-pt-2 has-pb-2" v-if="t.theme_id"> <div class="block-item"> <div class="block-avatar container"> <div class="has-text-centered"><img src="/s/i/avatar-girl.png" class="profile-avatar profile-avatar-65"></div> <div class="has-text-centered text-avatar">username</div> </div> </div> <div :class="showSection?\'blocks-section s-1\':\'\'"> <div :class="showSection?\'section-main\':\'\'"> <div class="block-item" v-if="view == \'pictures\'"> <div class="block-slider container is-shadow-block" :class="\'is-\'+lightOrDark(tmpTheme.options.block.pictures.bg)" style="pointer-events: none"> <div class="block-slider-inner"> <div class="slider slider-pictures has-mb-2 slider-has-text slider-has-link slider-has-border"> <div class="slider-inner"> <div class="slider-slide active"> <div class="picture-container" style="background-image: url(/s/i/sample-picture.jpg)"></div> <div class="slider-slide-text"> <div class="slider-slide-title">{{\'Заголовок\'|gettext}}</div> <div class="slider-slide-snippet">{{\'Описание\'|gettext}}</div> </div> <a class="slider-slide-link">{{\'Открыть\'|gettext}}</a> </div> </div> <div class="slider-nav"> <div class="slider-dot active"></div> <div class="slider-dot"></div> </div> </div> </div> </div> </div> <div v-else> <div class="block-item"> <div class="block-text is-heading container" style="text-align: center; line-height: 1.25; font-size: 2.2rem;">{{\'Заголовок\'|gettext}}</div> </div> <div class="block-item"> <div class="block-text container" v-html="demoText"></div> </div> <div class="blocks-item" v-for="i in [0,1,2]"> <div class="block-link block-item container"> <a class="button btn-link btn-link-styled" :class="(mode == \'edit\')?\'with-thumb\':\'without-thumb\'"><figure class="thumb" v-if="mode == \'edit\'"><div class="is-icon" style="-webkit-mask-image:url(/s/icons/world.svg);mask-image:url(/s/icons/world.svg)"><img src="data:image/gif;base64,R0lGODlhAQABAPAAAP///wAAACH5BAAAAAAALAAAAAABAAEAAAICRAEAOw=="></div></figure><div><div class="btn-link-title">{{\'Заголовок\'|gettext}}</div><div class="btn-link-subtitle">{{\'Подзаголовок\'|gettext}}</div></div></a> </div> </div> </div> </div> </div> </div> </div> <div class="theme-main" v-else> <a @click="newTheme" class="plus" :class="{\'is-loading\': isSetting}" v-if="theme_id == t.theme_id"></a> <h3 class="has-mt-3" :class="{\'has-text-grey\': theme_id != t.theme_id}">{{\'Новый дизайн\'|gettext}}</h3> </div> </div> </div> </div> </div> </div> <div class="float-panel is-light-mobile" :style="buttonsPanelFix" :class="{editmode: (mode == \'edit\'), hide: theme_id== 0 || buttonsHide || ((mode == \'edit\') && stage != 3) || isFetchingThemes, \'is-top\': mode== \'view_modal\'}" ref="buttonsPanel"> <div class="container"> <div v-if="mode == \'edit\'"> <button class="button is-black" @click="editThemeCancel">{{\'Отменить\'|gettext}}</button> <button class="button is-primary" :class="{\'is-loading\': isUpdating}" @click="editThemeSave">{{\'Сохранить\'|gettext}}</button> </div> <div v-else> <vue-component-action-button @action="onAction" :withTitle="$device.mobile" :title="\'Действие\'|gettext" classname="button is-black" class="has-sm-mr-2" v-if="showAdminButton"> <template slot="actions"> <b-dropdown-item value="clone" v-if="$auth.isAllowEndpoint(\'design/manage/clone\')"><i class="fa fa-edit"></i> {{\'Редактировать\'|gettext}}</b-dropdown-item> <b-dropdown-item value="tariff" v-if="$auth.isAllowEndpoint(\'design/manage/tariff\')"><i class="fa fa-usd-circle"></i> Установить: <span v-if="select_theme.tariff == \'basic\'">PRO</span> <span v-else>BASIC</span></b-dropdown-item> <hr class="dropdown-divider" v-if="$auth.isAllowEndpoint(\'design/manage/move\')"/> <b-dropdown-item value="left" v-if="$auth.isAllowEndpoint(\'design/manage/reorder\')" :disabled="themeIndex == 0"><i class="fa fa-arrow-left"></i> {{\'Передвинуть влево\'|gettext}}</b-dropdown-item> <b-dropdown-item value="right" v-if="$auth.isAllowEndpoint(\'design/manage/reorder\')" :disabled="(themeIndex == _.size(themes[design_id])-1)"><i class="fa fa-arrow-right"></i> {{\'Передвинуть вправо\'|gettext}}</b-dropdown-item> <hr class="dropdown-divider" v-if="$auth.isAllowEndpoint(\'design/manage/move\')"/> <b-dropdown-item value="manage" v-if="$auth.isAllowEndpoint(\'design/manage/list\')"><i class="fa fa-list"></i> {{\'Настроить список\'|gettext}}</b-dropdown-item> <b-dropdown-item value="move" v-if="$auth.isAllowEndpoint(\'design/manage/move\')"><i class="fa fa-exchange"></i> {{\'Перенести в тему\'|gettext}}</b-dropdown-item> <b-dropdown-item value="clone" v-if="$auth.isAllowEndpoint(\'design/manage/clone\')"><i class="fa fa-clone"></i> {{\'Клонировать\'|gettext}}</b-dropdown-item> <hr class="dropdown-divider" v-if="$auth.isAllowEndpoint(\'design/manage/move\')"/> <b-dropdown-item value="delete"><i class="fa fa-trash-alt"></i> {{\'Удалить\'|gettext}}</b-dropdown-item> </template> </vue-component-action-button> <button class="button is-danger" style="flex:0" v-if="design_id == 0 && mode== \'themes\' && !isAdmin" :disabled="(current_theme_id == theme_id) || (theme_id == 0) || isDeleting" @click="deleteTheme"><i class="fa fa-trash-alt"></i></button> <button class="button is-black" @click="editTheme" :disabled="theme_id == 0" v-if="(mode == \'themes\')" :class="{\'is-hidden-mobile\': showAdminButton}">{{\'Редактировать\'|gettext}}</button> <button class="button is-black" @click="viewThemeCancel" :disabled="theme_id == 0" v-if="mode == \'view\' || mode== \'view_modal\'">{{\'Отмена\'|gettext}}</button> <button class="button is-primary" @click="viewTheme" :class="{\'is-loading\': isSetting}" v-if="mode == \'themes\' && withView">{{\'Просмотр\'|gettext}}</button> <button class="button is-primary" :disabled="(theme_id == current_theme_id) || (theme_id == 0) || !select_theme || (select_theme.is_pro == 1 && !isAllowPro)" @click="setTheme(select_theme)" :class="{\'is-loading\': isSetting}" v-else>{{\'Выбрать\'|gettext}}</button> </div> </div> </div> </div> <div v-if="stage == 3 || show_theme_editor" style="flex:1;padding-left:460px"> <h2 class="has-mb-5 has-pt-2">{{\'Редактирование дизайна\'|gettext}}</h2> <vue-design-editor :theme="theme_editor" :group_id="group_id" :design_id="design_id" @update:theme="themeChanged"></vue-design-editor> </div> </div> <div class="themes-list-button-right" :class="{hidden: (themes[design_id] == undefined) || (themeScrollIndex == _.size(themes[design_id])-1)}" @click="nextScroll" v-if="mode != \'edit\'"></div> <div class="themes-list-panel-right" v-if="mode != \'edit\'"></div> </div> </div>'}),window.$app.defineComponent("design","vue-design-manage-form",{data:function(){return{isFetching:!1,groups:{},currentGroup:null}},created:function(){this.fetchData()},computed:{currentGroupId:function(){return this.groups[this.currentGroup].group_id}},methods:{fetchData:function(){var t=this;this.isFetching=!0,this.$api.get("design/manage/list",{}).then(function(e){t.isFetching=!1,"success"==e.result&&(t.groups=e.response.groups)})},editGroup:function(i){var e=this;this.$prompt("Укажите имя",{value:i.title}).then(function(t){i.title!=t&&e.$api.get("design/manage/renamegroup",{group_id:i.group_id,title:t}).then(function(e){"success"==e.result&&(i.title=t)})})},editDesign:function(i){var e=this;this.$prompt("Укажите имя",{value:i.title}).then(function(t){i.title!=t&&e.$api.get("design/manage/renamedesign",{design_id:i.design_id,title:t}).then(function(e){"success"==e.result&&(i.title=t)})})},addGroup:function(){var t=this;this.$prompt("Укажите имя").then(function(e){t.$api.get("design/manage/addgroup",{title:e}).then(function(e){t.fetchData()})})},addDesign:function(){var t=this;this.$prompt("Укажите имя").then(function(e){t.$api.get("design/manage/adddesign",{title:e,group_id:t.currentGroupId}).then(function(e){t.fetchData()})})},activeGroup:function(e){e.is_active=e.is_active?0:1,this.active("group",e.group_id,e.is_active)},togglePro:function(e){var t=this;e.is_pro=e.is_pro?0:1,this.$api.get("design/manage/setpro",{value:e.is_pro,design_id:e.design_id}).then(function(e){t.fetchData()})},activeDesign:function(e){e.is_active=e.is_active?0:1,this.active("design",e.design_id,e.is_active)},active:function(e,t,i){var s=this;this.$api.get("design/manage/active",{type:e,value:i,id:t}).then(function(e){s.fetchData()})}},template:'<div class="modal-card modal-card-large"> <header class="modal-card-head"> <p class="modal-card-title">{{\'Темы\'|gettext}}</p> <button class="modal-close is-large" @click="$parent.close()"></button> </header> <section class="modal-card-body"> <div> <div class="row row-small"> <div class="col-xs-6"> <div class="manage-design-list"> <div class="is-header"><span>Группы</span><a class="button is-small is-dark" @click="addGroup"><i class="fa fa-plus"></i></a></div> <div v-for="(g, i) in groups" @click="currentGroup = i" :class="{\'has-background-primary\': i== currentGroup}"> <span style="flex:1">{{g.title}}</span> <i class="fa has-text-grey fa-edit has-mr-2" @click.stop="editGroup(g)"></i> <i class="fa has-text-grey" :class="{\'fa-eye\': g.is_active, \'fa-eye-slash\': !g.is_active}" @click.stop="activeGroup(g)"></i> </div> </div> </div> <div class="col-xs-6"> <div class="manage-design-list" v-if="currentGroup != null"> <div class="is-header"><span>Дизайны</span><a class="button is-small is-dark" @click="addDesign"><i class="fa fa-plus"></i></a></div> <div v-for="d in groups[currentGroup].list"> <span v-if="d.title" style="flex:1">{{d.title}}</span><span v-else style="flex:1">Без имени</span> <span class="tag is-pro has-mr-2" :class="{\'is-off\': !d.is_pro}" @click="togglePro(d)">pro</span> <i class="fa has-text-grey fa-edit has-mr-2" @click.stop="editDesign(d)"></i> <i class="fa has-text-grey" :class="{\'fa-eye\': d.is_active, \'fa-eye-slash\': !d.is_active}" @click.stop="activeDesign(d)"></i> </div> </div> </div> </div> </div> </section> <footer class="modal-card-foot"> <button class="button is-dark" type="button" @click="$parent.close()">{{\'Закрыть\'|gettext}}</button> </footer> <b-loading :is-full-page="false" :active.sync="isFetching"></b-loading> </div>'}),window.$app.defineComponent("design","vue-design-move-form",{data:function(){return{isFetching:!1,info:{},groups:{},group_index:null,design_id:null}},props:["theme_id"],created:function(){this.fetchData()},methods:{fetchData:function(){var i=this;this.isFetching=!0,this.$api.get(["design/manage/info","design/manage/list"],{theme_id:this.theme_id}).then(function(e){var t;i.isFetching=!1,"success"==e.result&&(t=e.response,i.info=t.info,i.groups=t.groups,i.group_index=null,_.each(t.groups,function(e,t){i.info.group_id==e.group_id&&(i.group_index=t)}),i.design_id=i.info.design_id)})},save:function(){var t=this;if(this.info.design_id==this.design_id)return this.$parent.close();this.isFetching=!0,this.$api.post("design/manage/move",{theme_id:this.theme_id,design_id:this.design_id}).then(function(e){"success"==e.result&&(t.$parent.close(),t.$parent.$parent.clearThemesList(t.design_id),t.$parent.$parent.clearThemesList(t.info.design_id),t.$nextTick(function(){t.$parent.$parent.selectDesign(t.info.design_id)})),t.isFetching=!1})}},template:'<div class="modal-card"> <header class="modal-card-head"> <p class="modal-card-title">Перенос в тему</p> <button class="modal-close is-large" @click="$parent.close()"></button> </header> <section class="modal-card-body"> <div class="has-mb-2"> <label class="label">Группа</label> <div class="select"> <b-select v-model="group_index" placeholder="-- Не выбрано --" @input="design_id = null"> <option :value="null">-- Не выбрано --</option> <option :value="idx" v-for="(g, idx) in groups">{{g.title}}</option> </b-select> </div> </div> <div v-if="group_index != null"> <label class="label">Тема</label> <div class="select"> <b-select v-model="design_id" placeholder="-- Не выбрано --"> <option :value="null">-- Не выбрано --</option> <option :value="d.design_id" v-for="d in groups[group_index].list"><span v-if="d.title">{{d.title}}</span><span v-else>Тема {{d.design_id}}</span></option> </b-select> </div> </div> </section> <footer class="modal-card-foot"> <button class="button is-dark" type="button" @click="$parent.close()">{{\'Закрыть\'|gettext}}</button> <button class="button is-primary" type="button" @click="save" :disabled="!design_id">{{\'Сохранить\'|gettext}}</button> </footer> <b-loading :is-full-page="false" :active.sync="isFetching"></b-loading> </div>'}),window.$app.defineComponent("design","vue-design-view-modal",{data:function(){return{isFetching:!1}},props:["theme","page_id"],watch:{theme:function(){this.themeChanged()}},mounted:function(){this.isFetching=!0,this.themeChanged()},methods:{themeChanged:function(){this.isFetching=!1;var e=".modal-card-view-design .theme"+this.theme.theme_id,t=buildStyles(this.theme.options,"design",e);StylesFactory.updateCSSBlock(t,this.$refs.styles_view);var i={};this.$page.prepareSections(Vue.prototype.$page.data,i,this.theme.options,e,"view"),StylesFactory.updateCSSBlock(i,this.$refs.styles_view_sections)}},template:'<div class="modal-card modal-card-view-design"> <section class="modal-card-body is-paddingless screen page page-blocks" :class="\'theme\'+theme.theme_id"> <div ref=\'styles_view\'></div> <div ref=\'styles_view_sections\'></div> <div class="screen page"> <div v-for="a in theme.options.extended.items" v-html="a.html"></div> <vue-pages-page-blocks :page_id="page_id" :readonly="true" :show-hidden="false"></vue-pages-page-blocks> </div> <b-loading :is-full-page="false" :active.sync="isFetching"></b-loading> </section> </div>'}),window.$app.defineModule("design",[]);
