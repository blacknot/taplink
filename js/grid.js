!function(m){m.fn.grid=function(e,t,i,n){var h=this,r={emptyRow:!1,sortable:!1,tableClass:"table table-bordered table-condensed",disableKeys:[],moveOnRowRemove:!0,removable:!0,readonly:!1,emptyGridMessage:null,skipOnDuplicate:null,initialSort:null,selectable:!1,toolbar:!1,getContainer:null};h.name=null,h.isEditing=!1,h.$prevRow=null,h.editorProps={},h.preventEnter=!1,h.$lastActiveCell=null,m.fn.between=function(e,t){var i=m(this).index(e),n=m(this).index(t);return i<=n?this.slice(i,n+1):this.slice(n,i+1)};function o(){return-1<navigator.userAgent.search("Firefox")}function l(e){var t,i;o()&&(i=(t=e.get(0)).style.display,t.style.display="none",t.offsetHeight,t.style.display=i)}function a(e){return e.replace(/\r\n/g,"\n")}return h.setActiveCell=function(e){h.config.readonly||(h.$prevRow=m(".sensei-grid-tbody>tr>.activeCell",h.$el).parent("tr"),h.$prevRow.removeClass("activeRow"),m(".sensei-grid-tbody>tr>.activeCell",h.$el).removeClass("activeCell"),e.addClass("activeCell"),e.parent("tr").addClass("activeRow"),l(e.parent("tr")),h.events.trigger("cell:select",e),h.$prevRow.index()!==e.parent("tr").index()&&(h.events.trigger("row:select",e.parent("tr")),h.$prevRow.hasClass("sensei-grid-dirty-row")&&h.isEditing&&(h.saveEditor(!0),h.events.trigger("row:save",h.getRowData(h.$prevRow),h.$prevRow,"row:select"))),h.$lastActiveCell=e)},m.fn.cellPosition=function(){var e=m(this).position();return o()&&(--e.left,--e.top),e},h.events=m({_events:{}}),h.registerEditor=function(e){var t=new e(h);h.editors[t.name]=t},h.registerRowAction=function(e){var t=new e(h);h.rowActions[t.name]=t},h.render=function(){var e,t;h.rowElements={},_.each(h.rowActions,function(e){e.initialize();var t="<div>"+e.rowElement()+"</div>";h.rowElements[e.name]=t}),h.renderBaseTable(),h.renderColumns(),h.renderData(),h.config.sortable&&_.isObject(h.config.initialSort)&&(e=h.config.initialSort.col,(t=h.$el.find("th").filter(function(){return m(this).data("name")===e}))&&h.showSortingIndicator(t,h.config.initialSort.order)),_.each(h.editors,function(e){e.initialize(),e.render(),e.getElement().hide()}),h.bindEvents()},h.updateData=function(e){h.renderData(e),h.bindEvents()},h.destroy=function(){h.unbindEvents(),h.$el.remove()},h.addEdit=function(e){h.editPointer===h.edits.length-1?h.editPointer+=1:(h.editPointer+=1,h.edits.splice(h.editPointer)),h.edits.push(e)},h.redo=function(){return h.editPointer+1>=h.edits.length?[]:(h.editPointer+=1,h.edits[h.editPointer])},h.undo=function(){if(h.editPointer<0)return[];var e=h.edits[h.editPointer];return--h.editPointer,e},h.bindEvents=function(){h.unbindEvents(),h.$el.on("click.grid",".sensei-grid-tbody>tr>td",h.clickCell),h.$el.on("dblclick.grid",".sensei-grid-tbody>tr>td",h.dblClickCell),h.$el.on("blur.grid",h.blur),h.$el.on("keydown.grid",h.keydown),h.$el.on("click.grid",".sensei-grid-thead .sensei-grid-sortable",h.sort),h.$el.on("change.grid",".sensei-grid-tbody td.selectable :checkbox",h.selectCell),h.$el.on("change.grid",".sensei-grid-thead th.selectable :checkbox",h.selectAll),m(document).on("click.grid",h.editorBlur)},h.unbindEvents=function(){h.$el.off("click.grid",".sensei-grid-tbody>tr>td"),h.$el.off("dblclick.grid",".sensei-grid-tbody>tr>td"),h.$el.off("blur.grid"),h.$el.off("keydown.grid"),h.$el.off("click.grid",".sensei-grid-thead .sensei-grid-sortable"),h.$el.off("change.grid",".sensei-grid-tbody td.selectable :checkbox"),h.$el.off("change.grid",".sensei-grid-thead th.selectable :checkbox"),m(document).off("click.grid")},h.showSortingIndicator=function(e,t){var i;return h.$el.find("thead th.selectable :checkbox").prop("checked",!1),h.$el.find("tbody td.selectable :checkbox").prop("checked",!1),h.$el.find("tbody tr.selectedRow").removeClass("selectedRow"),h.$el.find("th.sensei-grid-sortable .glyphicon").remove(),"desc"===t||e.data("order")&&"asc"===e.data("order")?(i="desc",e.append(m("<span>").addClass("glyphicon glyphicon-chevron-up"))):(i="asc",e.append(m("<span>").addClass("glyphicon glyphicon-chevron-down"))),t&&(i=t),e.data("order",i),i},h.sort=function(){var e=m(this).data("name"),t=h.showSortingIndicator(m(this),void 0);h.events.trigger("column:sort",e,t,m(this))},h.editorBlur=function(e){0<h.getActiveCell().length&&0===h.$el.has(m(e.target)).length&&(h.exitEditor(),h.deactivateCell())},h.hideEditors=function(){m(".sensei-grid-editor",h.$el).hide()},h.blur=function(){var e;0<h.getActiveCell().length&&!h.isEditing&&(e=h.getActiveCell(),h.exitEditor(),h.isEditing=!1,h.deactivateCell(),l(e.parent("tr")))},h.parsers={},h.parsers.string=function(e){return e.toString()},h.parsers.int=function(e){return parseInt(e)},h.parsers.float=function(e){return parseFloat(e)},h.getCellData=function(e){if(!e||0===e.length)return null;var t=e.text(),i=h.getCellType(e);return _.has(h.parsers,i)&&(t=h.parsers[i](t)),t},h.getCellColumn=function(e){return e.data("column")},h.getCellType=function(e){return e.data("type")},h.getCellStatus=function(e){return!!e.data("saved")},h.getCellDataByIndex=function(e,t){var i=h.getRowByIndex(e),n=h.getCellFromRowByIndex(i,t);return h.getCellData(n)},h.getCellDataByKey=function(e,t){var i=h.getRowByIndex(e),n=h.getCellFromRowByKey(i,t);return h.getCellData(n)},h.getCellFromRowByIndex=function(e,t){return e.find("td").eq(t)},h.getCellFromRowByKey=function(e,t){return e.find("td").filter(function(){return m(this).data("column")===t})},h.getCellRow=function(e){return e.parent("tr")},h.getRowCellsByIndex=function(e){return h.getRowByIndex(e).find("td")},h.getRowCells=function(e){return e.find("td:not(.selectable)")},h.getRowByIndex=function(e){return h.$el.find(".sensei-grid-tbody>tr").eq(e)},h.getRowDataByIndex=function(e){var t=h.getRowByIndex(e);return h.getRowData(t)},h.getRowData=function(e){if(!e||0===e.length)return null;var t=h.getRowCells(e),i={};return t.each(function(){i[h.getCellColumn(m(this))]=h.getCellData(m(this))}),i},h.getRows=function(){return h.$el.find(".sensei-grid-tbody>tr")},h.getSelectedRows=function(){return h.$el.find(".sensei-grid-tbody>tr.selectedRow")},h.getGridData=function(){return h.getRows().map(function(){return h.getRowData(m(this))})},h.getActiveCell=function(){return h.isEditing&&h.activeEditor&&h.activeEditor.activeCell?h.activeEditor.activeCell:m("td.activeCell",h.$el)},h.setRowSaved=function(e){e.removeClass("sensei-grid-dirty-row").removeClass("sensei-grid-empty-row"),e.find("td:first").data("saved",!0),e.find("td.selectable:first").html(m("<input type=checkbox>"))},h.setRowDirty=function(e){e.addClass("sensei-grid-dirty-row").removeClass("sensei-grid-empty-row"),e.find("td:first").data("saved",!1)},h.deactivateCell=function(){var e=h.getActiveCell();e.removeClass("activeCell"),e.parent("tr").removeClass("activeRow"),h.events.trigger("cell:deactivate",e)},h.clearActiveCell=function(){var e=h.getActiveCell(),t=h.getCellData(e);m("div:first",e).empty(),h.events.trigger("cell:clear",t,e)},h.removeRow=function(e,t){if(!h.config.removable)return!1;var i=e.index();if(e.hasClass("sensei-grid-empty-row"))return!1;h.config.moveOnRowRemove&&h.moveDown();var n=h.getRowData(e);h.events.trigger("row:remove",n,i,e,t),e.remove()},h.removeActiveRow=function(){var e=h.getSelectedRows();if(!(0<e.length)){var t=h.getActiveCell();if(0===t.length)return!1;var i=h.getCellRow(t);return h.removeRow(i),!0}e.each(function(){h.removeRow(m(this))})},h.duplicateActiveRow=function(){var e=h.getActiveCell();if(!e)return!1;var t=h.getCellRow(e);if(t.hasClass("sensei-grid-empty-row"))return!1;var i=h.getRowData(t);_.isEmpty(h.config.skipOnDuplicate)||(i=_.omit(i,h.config.skipOnDuplicate));var n=m(h.renderRow(i,!1,!0));return n.insertAfter(t),h.moveDown(),h.events.trigger("row:duplicate",n),!0},h.moveRight=function(){var e,t=h.getActiveCell();0<t.next().length?h.setActiveCell(t.next()):0<(e=t.parent("tr").next()).length&&h.setActiveCell(m("td:first",e))},h.moveUp=function(){var e,t,i=h.getActiveCell(),n=i.parent("tr").prev();0<n.length&&(e=i.index(),0<(t=m("td",n).eq(e)).length?h.setActiveCell(t):h.setActiveCell(m("td:last",n)))},h.moveLeft=function(){var e,t=h.getActiveCell();0<t.prev().length?h.setActiveCell(t.prev()):0<(e=t.parent("tr").prev()).length&&h.setActiveCell(m("td:last",e))},h.moveDown=function(){var e,t,i=h.getActiveCell(),n=i.parent("tr").next();0<n.length&&(e=i.index(),0<(t=m("td",n).eq(e)).length?h.setActiveCell(t):h.setActiveCell(m("td:first",n)))},h.scrollIntoView=function(e,t){var i=0,n=0;t.offset()&&(i=t.offset().top+t.scrollTop(),n=t.offset().left+t.scrollLeft()),t.scrollTop(e.offset().top-i-50),t.scrollLeft(e.offset().left-n-50)},h.move=function(e){var t,i,n,r="move"+e.charAt(0).toUpperCase()+e.substr(1);_.has(h,r)?(h[r](),h.isEditing&&h.saveEditor(),t=h.getActiveCell(),i=m(window),n={},h.config.getContainer&&(n={viewport:i=h.config.getContainer()}),m.fn.isInViewport&&0===t.isInViewport(n).length&&h.scrollIntoView(t,i),h.isEditing&&h.editCell()):console.warn("move method not found",r)},h.editCell=function(){h.config.readonly||h.showEditor()},h.getEditor=function(){return h.activeEditor},h.getEditorInstance=function(){var e=h.getActiveCell(),t=e.data("editor");if(m.isFunction(t)&&(t=t(h)),t&&_.has(h.editors,t)){var i=h.getCellColumn(e);return _.has(h.editorProps,i)&&(h.editors[t].props=h.editorProps[i]),h.editors[t]}return console.info("Editor not found, skipping cell: "+t),!1},h.saveEditor=function(e){var t,i,n,r,o,l;h.isEditing&&h.activeEditor&&(t=h.getActiveCell(),i=h.activeEditor.getValue(),a(i)!==a(t.text())&&(n={previousState:h.getCellData(t),currentState:i,row:h.getRowData(h.getCellRow(t)).id,column:t.index()},r=t.data("allowHTML"),h.addEdit(n),r?t.html(m("<div>").html(i)):t.html(m("<div>").text(i)),(o={})[t.data("column")]=i,h.events.trigger("editor:save",o,t),(l=t.parent("tr")).hasClass("sensei-grid-empty-row")&&(l.removeClass("sensei-grid-empty-row").addClass("sensei-grid-dirty-row"),h.assureEmptyRow()))),!e&&h.activeEditor&&h.getEditor().hide()},h.assureEmptyRow=function(){var e,t;h.config.emptyRow&&0===h.$el.find(".sensei-grid-tbody>tr.sensei-grid-empty-row").length&&(e=h.$el.find(".sensei-grid-tbody"),t=h.renderRow(null,!1),e.append(t))},h.exitEditor=function(e){var t,i=h.getActiveCell();h.isEditing&&h.activeEditor&&(e?h.getEditor().hide():(h.saveEditor(),(t=i.parent("tr")).hasClass("sensei-grid-dirty-row")&&h.isEditing&&h.events.trigger("row:save",h.getRowData(t),t,"editor:close"))),h.isEditing&&(h.setActiveCell(i),h.$el.focus()),h.isEditing=!1},h.moveEditor=function(){h.isEditing&&(h.showEditor(),h.editCell())},h.selectRow=function(e,t,i){var n;h.config.selectable&&(n=e.find(".selectable"),h.selectCell(n,t,i))},h.selectCell=function(e,t,i){var n;m(this)&&m(this).is("input")?e=m(this).parents("td.selectable"):(n=e.find(":checkbox"),t?n.prop("checked",!0):i?n.prop("checked",!1):n.prop("checked",!n.prop("checked"))),e.parent().hasClass("sensei-grid-empty-row")||(t?e.parent().addClass("selectedRow"):i?e.parent().removeClass("selectedRow"):e.parent().toggleClass("selectedRow"),e.parent().hasClass("selectedRow")?h.events.trigger("row:mark",e.parent()):h.events.trigger("row:unmark",e.parent()))},h.selectAll=function(){var e=!0,t=!1,i=h.$el.find("thead th.selectable :checkbox");i&&!i.is(":checked")&&(t=!(e=!1)),h.getRows().each(function(){h.selectRow(m(this),e,t)})},h.showEditor=function(){var e=h.getEditorInstance();if(!e)return h.exitEditor(),void(h.isEditing=!0);h.activeEditor=e;var t=h.activeEditor.getElement(),i=h.getActiveCell();h.activeEditor.activeCell=i,h.isEditing=!0,h.activeEditor.show(),t.css(i.cellPosition()),h.activeEditor.setDimensions(i);var n=i.data("column"),r=i.data("allowHTML")?i.find(">div").html():i.text();h.activeEditor.setValue(r),t.css(i.cellPosition());var o={};return o[n]=r,h.events.trigger("editor:load",o,i),t},h.keydown=function(e){var t,i,n,r,o,l,a,s,d,c,g,u=h.getActiveCell();if((0!==h.getActiveCell().length||h.isEditing||_.includes([8],e.which))&&_.includes([8,9,13,27,32,37,38,39,40,65,68,89,90],e.which))if(h.isEditing||!_.includes(h.config.disableKeys,e.which)){if(!(h.isEditing&&h.getEditor()&&_.includes([8,32,37,38,39,40,65,68,89,90],e.which))){switch(e.preventDefault(),e.which){case 37:h.move("left");break;case 38:e.shiftKey&&h.config.selectable&&h.selectRow(u.parent(),!0),h.move("up"),t=h.getActiveCell(),e.shiftKey&&h.config.selectable&&h.selectRow(t.parent(),!0);break;case 39:h.move("right");break;case 40:e.shiftKey&&h.config.selectable&&h.selectRow(u.parent(),!0),h.move("down"),t=h.getActiveCell(),e.shiftKey&&h.config.selectable&&h.selectRow(t.parent(),!0);break;case 13:var v,p=!1,f=!1;u&&u.data("action")&&(v=u.data("action-name"),h.rowActions[v]&&h.rowActions[v].trigger({data:{$activeCell:u}}),p=!0),u&&u.hasClass("selectable")&&(h.selectCell(u),f=!0),h.isEditing?e.ctrlKey&&e.shiftKey?h.move("up"):e.ctrlKey&&!e.shiftKey?h.move("down"):h.preventEnter||p||f||h.exitEditor():p||f||h.editCell();break;case 27:h.isEditing?h.exitEditor(!0):(n=h.getSelectedRows())&&0<n.length?((i=h.$el.find("thead th.selectable :checkbox")).prop("checked",!1),h.selectAll()):h.$el.blur();break;case 9:e.shiftKey?h.move("left"):h.move("right");break;case 32:u&&(h.config.selectable?h.selectRow(u.parent()):h.editCell());break;case 8:e.ctrlKey||e.metaKey?h.removeActiveRow():h.clearActiveCell();break;case 65:h.config.selectable&&(e.ctrlKey||e.metaKey||e.shiftKey)&&((i=h.$el.find("thead th.selectable :checkbox")).prop("checked",!i.prop("checked")),h.selectAll());break;case 90:!e.ctrlKey&&!e.metaKey||"row"in(r=h.undo())&&"column"in r&&(o=h.getRowByIndex(r.row-1),(l=h.getCellFromRowByIndex(o,r.column)).html(m("<div>").text(r.previousState)),(a={})[l.data("column")]=r.previousState,h.events.trigger("editor:save",a,l));break;case 89:!e.ctrlKey&&!e.metaKey||"row"in(s=h.redo())&&"column"in s&&(d=h.getRowByIndex(s.row-1),(c=h.getCellFromRowByIndex(d,s.column)).html(m("<div>").text(s.currentState)),(g={})[c.data("column")]=s.currentState,h.events.trigger("editor:save",g,c));break;case 68:(e.ctrlKey||e.shiftKey||e.metaKey)&&h.duplicateActiveRow()}e.preventDefault()}}else e.preventDefault()},h.clickCell=function(e){var t,i;m(this).hasClass("selectable")||e.preventDefault(),h.getActiveCell()&&(t=h.getActiveCell().parent()),h.isEditing&&h.exitEditor(),h.setActiveCell(m(this)),h.config.selectable&&e.shiftKey&&(document.selection&&document.selection.empty?document.selection.empty():window.getSelection&&window.getSelection().removeAllRanges(),i=m(this).parent(),t&&i&&h.$el.find("tbody>tr").between(t,i).each(function(){m(e.target).is(":checkbox")&&m(this).is(i)||h.selectCell(m(this).find("td.selectable"),!0)}))},h.dblClickCell=function(e){e.preventDefault(),h.setActiveCell(m(this)),h.editCell()},h.renderColumns=function(){var e,t=m("thead",h.$el),n=document.createElement("tr");h.config.selectable&&(e=m("<th class=selectable><div><input type=checkbox></div></th>")[0],n.appendChild(e)),_.each(h.columns,function(e){var t=document.createElement("th"),i=document.createElement("div");h.config.sortable&&(t.className="sensei-grid-sortable"),m(i).text(e.display?e.display:e.name),t.appendChild(i),m(t).data("name",e.name),m(t).data("type",e.type||"string"),m(t).data("editor",e.editor||"BasicEditor"),e.editorProps&&(h.editorProps[e.name]=e.editorProps),n.appendChild(t)}),t.append(n)},h.renderData=function(e){var t,i,n,r=m(".sensei-grid-tbody",h.$el);e&&(h.data=e),r.html(null),_.each(h.data,function(e){var t=h.renderRow(e,!0);r.append(t)}),h.config.emptyRow&&(t=h.renderRow(null,!1),r.append(t)),_.isEmpty(h.data)&&h.config.emptyGridMessage&&(i=m("<td colspan=999>").text(h.config.emptyGridMessage),n=m("<tr>").append(i),r.html(n))},h.renderRow=function(r,o,e){var t,i,l=document.createElement("tr");return o||(l.className="sensei-grid-empty-row"),e&&(l.className="sensei-grid-dirty-row"),h.config.selectable&&(t=m("<td><div></div></td>"),o&&(i=m("<input type=checkbox>"),t.find("div").append(i)),t.prop("class","selectable"),l.appendChild(t[0])),_.each(h.columns,function(e){var t,i=document.createElement("td"),n=document.createElement("div");_.has(r,e.name)&&(e.allowHTML&&!0===e.allowHTML?m(n).html(r[e.name]):m(n).text(r[e.name]),m.isFunction(e.style)&&(t=e.style(r[e.name],r,m(i),h),_.isEmpty(t)||m(i).css(t))),!0===e.wrap&&m(i).css("white-space","normal"),m(i).data("allowHTML",e.allowHTML),m(i).data("column",e.name),m(i).data("type",e.type||"string"),m(i).data("editor",e.editor||"BasicEditor"),m(i).data("saved",o),i.appendChild(n),l.appendChild(i)}),_.isEmpty(h.rowElements)||_.each(h.rowElements,function(e,t){var i=document.createElement("td");i.innerHTML=e,m(i).data("action",!0),m(i).data("action-name",t),m(i).addClass("row-action");var n=h.rowActions[t];n.triggerEvent&&n.triggerEvent.event&&n.triggerEvent.selector&&m(i).on(n.triggerEvent.event,n.triggerEvent.selector,{$activeCell:m(i)},n.trigger),l.appendChild(i)}),l},h.renderBaseTable=function(){var e=document.createElement("table"),t=document.createElement("thead"),i=document.createElement("tbody");i.className="sensei-grid-tbody",t.className="sensei-grid-thead",e.className=h.config.tableClass,e.appendChild(t),e.appendChild(i),h.$el.html(m("<div class='sensei-grid-table-wrapper'>").html(e)),h.$el.attr("tabindex",-1),h.config.toolbar&&h.$el.append(m("<div class='sensei-grid-toolbar'>").text("Empty toolbar."))},h.init=function(e,t,i,n){return h.config=m.extend({},r,i),h.data=e,h.columns=t,h.name=n,h.$el=m(this),h.editors={},h.rowActions={},h.edits=[],h.editPointer=-1,h},h.init(e,t,i,n)}}($mx),function(t){function e(e){this.grid=e}e.extend=function(e){function t(){this.constructor=n}var i=this,n=function(){return i.apply(this,arguments)};return t.prototype=i.prototype,n.prototype=new t,e&&(n.prototype=_.merge(this.prototype,e)),n.__super__=i.prototype,n},e.prototype.getElement=function(){return t(this.editor)},e.prototype.initialize=function(){},e.prototype.render=function(){},e.prototype.show=function(){this.getElement().show()},e.prototype.hide=function(){this.getElement().hide(),this.grid.activeEditor.activeCell=null,this.grid.activeEditor=null},e.prototype.setDimensions=function(e){this.getElement().css({width:e.outerWidth()+1,height:e.outerHeight()+1})},e.prototype.getValue=function(){throw Error("Editor.getValue not implemented")},e.prototype.setValue=function(){throw Error("Editor.setValue not implemented")},this.Editor=e,this.BasicEditor=e.extend({types:[],name:"BasicEditor",render:function(){var e;this.editor||(this.editor=document.createElement("div"),this.editor.className="sensei-grid-editor sensei-grid-basic-editor",(e=document.createElement("input")).setAttribute("type","text"),this.editor.appendChild(e),this.grid.$el.append(this.editor))},getValue:function(){return t("input",this.editor).val()},setValue:function(e){t("input",this.editor).val(e).focus()}}),this.TextareaEditor=e.extend({types:[],name:"TextareaEditor",render:function(){var e;this.editor||(this.editor=document.createElement("div"),this.editor.className="sensei-grid-editor sensei-grid-textarea-editor",e=document.createElement("textarea"),this.editor.appendChild(e),this.grid.$el.append(this.editor))},setDimensions:function(e){this.getElement().find("textarea").css({width:e.outerWidth()+50,height:e.outerHeight()+50})},getValue:function(){return t("textarea",this.editor).val()},setValue:function(e){t("textarea",this.editor).val(e).focus()}})}($mx);
