window.$app.defineComponent("addons.catalog.vkshop","vue-addons-catalog-vkshop-options",{props:["values","variants","addon_id","isInstalling","currentTab","isStep"],mixins:[FormModel],data:function(){return{progress:{value:0,max:0,percent:null},productsInited:!1}},watch:{currentTab:function(s){"products"!=s||this.productsInited||(this.productsInited=!0)}},created:function(){this.$io.on("events:addons.vkshop:connected",this.connected),this.$io.on("events:addons.vkshop:progress",this.updateProgress),this.$io.on("events:addons.vkshop:error",this.setError)},destroyed:function(){this.$io.off("events:addons.vkshop:connected",this.connected),this.$io.off("events:addons.vkshop:progress",this.updateProgress),this.$io.off("events:addons.vkshop:error",this.setError)},methods:{updateProgress:function(s){switch(console.log(s),s.action){case"value":this.progress.max=Math.max(this.progress.max,s.value),this.progress.value=s.value,this.progress.percent=this.progress.max?100-Math.round(this.progress.value/this.progress.max*100):0;break;case"done":this.progress.max=0,this.currentTab="options",this.productsInited=!1,this.$parent.reload()}},setError:function(s){this.values.message=s.message,this.values.error_id=s.error_id,5==s.error_id&&(this.is_installed=!1)},connected:function(s){console.log(s),this.variants.groups=s.groups,this.variants.categories=s.categories,this.values.options.access_token=s.access_token,this.values.is_installed?this.$parent.save(!1):this.$parent.install()}},template:'<section class="modal-card-body modal-card-body-blocks"> <section class="content" v-if="currentTab == \'description\'"> <slot name="allow"></slot> <p>Магазин ВКонтакте – Откройте новый канал продаж за несколько минут.</p> Выгрузка товаров в ВКонтакте позволяет создать дополнительную витрину ваших товаров в сообществе ВК что может привлечь дополнительный трафик к вашему основному магазину в Таплинке. <p></p> </section> <section class="message is-danger" v-if="values.message"><div class="message-body">{{values.message}}</div></section> <section v-if="currentTab == \'options\'"> <div v-if="values.error_id == 5"> <a class="button is-success" :href="values.install_link" target="_blank">Переподключить интеграцию</a> </div> <div v-else> <div class="row"> <div class="col-xs-12 col-sm-6 has-xs-mb-2"> <b-field label="Сообщество" :type="{\'is-danger\': errors.group_id}" :message=\'errors.group_id\' grouped> <b-select v-model="values.options.group_id" expanded :disabled="values.is_installed"> <option :value=\'null\'>-- Сообщество не выбрано --</option> <option v-for="v in variants.groups" :value="v.id"> {{v.name}} </option> </b-select> <p class="control" v-if="values.options.group_id"> <a :href="\'https://vk.com/club\'+values.options.group_id" class="button is-light" target="_blank"><i class="fas fa-external-link"></i></a> </p> </b-field> </div> <div class="col-xs-12 col-sm-6"> <b-field label="Категория для выгрузки" :type="{\'is-danger\': errors.category_id}" :message=\'errors.category_id\'> <b-select v-model="values.options.category_id" expanded :disabled="values.is_installed"> <option :value=\'null\'>-- Сообщество не выбрано --</option> <option v-for="v in variants.categories" :value="v.id"> {{v.name}} </option> </b-select> </b-field> </div> </div> <hr> <b-progress type="is-success" :value="progress.percent" class="has-mb-2" show-value v-if="progress.max">{{progress.max - progress.value}} / {{progress.max}}</b-progress> <div v-if="values.total && values.tms_updated" class="has-mb-1"><b>Выгруженно товаров:</b> {{values.uploaded}} из {{values.total}}</div> <div v-if="values.tms_updated"><b>Последняя выгрузка:</b> {{values.tms_updated|datetime}}</div> </div> </section> <section v-if="currentTab == \'products\'"> <vue-addons-catalog-vkshop-products v-if="productsInited"/> </section> </section>'}),window.$app.defineComponent("addons.catalog.vkshop","vue-addons-catalog-vkshop-products",{data:function(){return{isFetching:!1}},mixins:[ListModel],created:function(){this.fetchData(!0)},methods:{fetchData:function(s,e){var t=this;!e&&this.checkCache()||(this.isFetching=s,this.$parent.$parent.action("products",{next:this.next}).then(function(s){console.log(s),"success"==s.result&&(t.cachePage(s.response.products),t.isFetching=!1)}))}},template:'<div> <b-table paginated backend-pagination pagination-simple :data="fields" :loading="isFetching" :per-page="perPage" :total="total" @page-change="onPageChange" bordered> <b-table-column field="title" label="Название товара" v-slot="props"> {{ props.row.title }} <span class="has-text-danger is-pulled-right" v-tippy :content="props.row.error" v-if="props.row.error"><i class="fal fa-exclamation-triangle"></i></span> </b-table-column> <b-table-column :label="\'Дата выгрузки\'|gettext" v-slot="props" cell-class="has-width-20" numeric>{{ props.row.tms_updated|datetime }}</b-table-column> </b-table> </div> </div> </div>'}),window.$app.defineModule("addons.catalog.vkshop",[]);
