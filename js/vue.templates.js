window.$app.defineComponent("templates","vue-templates-form",{data:function(){return{isFetching:!1,isUpdating:!1,language_code:i18n.locale,values:{snapshot_id:null,title:"",category_id:null}}},props:["page_id"],mixins:[FormModel],created:function(){this.fetchData()},methods:{fetchData:function(){var a=this;this.isFetching=!0,this.$api.get(["templates/get","templates/info"],{page_id:this.page_id}).then(function(e){var t;"success"==e.result&&(t=e.response.templates,a.variants=t.variants,null!=t.values?(a.values=t.values,_.each(t.variants.category_id,function(e){_.each(e,function(e){_.each(e.items,function(e){e.category_id==t.values.category_id&&(a.language_code=e.language_code)})})})):a.language_code=Object.keys(t.variants.category_id)[0]),a.isFetching=!1})},updateData:function(){var t=this;this.isUpdating=!0,this.$api.post("templates/set",Object.assign({page_id:this.page_id},this.values)).then(function(e){"success"==e.result&&t.$parent.close(),t.isUpdating=!1})}},template:'<div class="modal-card"> <header class="modal-card-head"> <p class="modal-card-title" v-if="values.snapshot_id">{{\'Обновление шаблона\'|gettext}}</p> <p class="modal-card-title" v-else>{{\'Добавление шаблона\'|gettext}}</p> <button class="modal-close is-large" @click="$parent.close()"></button> </header> <section class="modal-card-body"> <b-field :label="\'Название\'|gettext"> <input type="text" v-model="values.title" class="input" v-focus> </b-field> <b-field :label="\'Язык\'|gettext" v-if="!isFetching"> <b-select v-model="language_code"> <option v-for="(f, k) in variants.category_id" :value="k">{{variants.language_code[k].title}}</option> </b-select> </b-field> <b-field :label="\'Категория\'|gettext" v-if="!isFetching"> <b-select v-model="values.category_id" :placeholder="\'Не выбрано\'|gettext"> <option :value="null">-- {{\'Не выбрано\'|gettext}} --</option> <optgroup v-for="g in variants.category_id[language_code]" :label="g.title"> <option v-for="f in g.items" :value="f.category_id">{{f.category}}</option> </optgroup> </b-select> </b-field> </section> <footer class="modal-card-foot"> <button class="button is-primary level-item" type="button" @click="updateData" :class="{\'is-loading\': isUpdating}">{{\'Сохранить\'|gettext}}</button> </footer> <b-loading :is-full-page="false" :active.sync="isFetching"></b-loading> </div>'}),window.$app.defineComponent("templates","vue-templates-index",{data:function(){return{isFetching:!1,profiles:[]}},created:function(){this.fetchData()},methods:{fetchData:function(){var l=this;this.isFetching=!0,this.$api.get("templates/list").then(function(e){l.profiles=e.response.templates,l.$nextTick(function(){_.each(l.profiles,function(e,t){var a=".templates-index .theme"+e.theme_id,i={};e.theme=StylesFactory.checkStyles(e.theme),e.data=l.$page.prepareData(e.data,i,e.theme,a,"view");var s=buildStyles(e.theme,"design",a);StylesFactory.updateCSSBlock(s,l.$refs.styles_view[t]),StylesFactory.updateCSSBlock(i,l.$refs.styles_view_sections[t])}),l.isFetching=!1})})}},template:'<div> <div style="background: #fff" class="has-pt-5 has-pb-5"> <div class="container"> <h2>Каталог шаблонов</h2> </div> </div> <div class="templates-index templates-grid container has-mt-3 has-mb-3"> <div class="row"> <div v-for="p in profiles" class="col-sm-3"> <div class="device is-large" :class="\'theme\'+p.theme_id"> <div ref=\'styles_view\'></div> <div ref=\'styles_view_sections\'></div> <section class="modal-card-body is-paddingless screen page page-blocks" v-if="!isFetching"> <vue-pages-page-blocks :page_id="p.page_id" :page-data="p.data" :readonly="true" :show-hidden="false" :account="p.raw" :theme="p.theme"></vue-pages-page-blocks> </section> </div> </div> </div> </div> </div>'}),window.$app.defineModule("templates",[]);
