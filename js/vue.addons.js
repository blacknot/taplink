window.$app.defineComponent("addons","vue-addons-form",{data:function(){return{isUpdating:!1,isFetching:!1,isStep:!1,isAllowSave:!0,currentAddon:null,addon_id:null,isInstalling:!1,options:{},values:{is_installed:!1,is_active:!1,addon_title:null,external_id:null,tariff:"basic",install_link:null},variants:{},currentTab:"description",tabs:[]}},created:function(){this.fetchData(!0)},computed:{buttonTitle:function(){return this.isStep?this.$gettext("Далее"):this.$gettext("Активировать")},allowText:function(){return"pro"==this.values.tariff?this.$gettext("Этот модуль доступен на PRO-тарифе"):this.$gettext("Этот модуль доступен на BUSINESS-тарифе")},isAllow:function(){return this.$auth.isAllowTariff(this.values.tariff)&&this.isAllowSave}},props:["addon_id"],mixins:[FormModel],methods:{fetchData:function(t){var s=this;this.isFetching=t,this.$api.get("addons/addon/get",{addon_id:this.addon_id}).then(function(t){var i,e;s.isFetching=!1,"success"==t.result&&(i=t.response.addons.addon,s.values=i.values,s.variants=i.variants,e="vue-addons-catalog-"+i.values.addon_name+"-options",window.$app.loadComponent(e).then(function(){s.currentAddon=e}),window.i18n.extend(i.phrases),s.tabs=i.tabs,s.currentTab=i.current_tab)})},reload:function(){this.fetchData(!0)},setStep:function(t){this.isStep=t},close:function(){this.$parent.close()},onAction:function(t){var i=this,e=this.$refs.model?this.$refs.model.confirmText:null;switch(t){case"on":case"off":"off"==t&&e?this.$confirm(e,"is-danger").then(function(t){i.values.is_active="on"==t,i.save(!0)}):(this.values.is_active="on"==t,this.save(!0));break;case"delete":this.$confirm(e||this.$gettext("Вы уверены что хотите отключить этот модуль?"),"is-danger").then(function(t){i.$api.get("addons/addon/delete",{addon_id:i.addon_id}).then(function(t){i.$parent.close()})})}},install:function(t){var i=!(0<arguments.length&&void 0!==t)||t;this.values.install_link&&!i?window.open(this.values.install_link,"addon"):(this.isInstalling=!0,this.values.is_active=!0,this.currentTab="options")},action:function(t,i){return this.$api.get("addons/addon/action",{addon_id:this.addon_id,name:t,params:i},this)},onsave:function(){this.save(!0)},save:function(t){var i=this,e=0<arguments.length&&void 0!==t&&t;this.isUpdating=!0,this.$api.post("addons/addon/set",this.values,this.$refs.model).then(function(t){i.isUpdating=!1,"success"==t.result&&(i.values.is_installed=!0,null==i.$refs.model.isSuccess||i.$refs.model.isSuccess()?e&&i.$parent.close():(i.values.external_id=t.response.values.external_id,i.values.options=t.response.values.options,i.variants=t.response.variants))}).catch(function(t){i.isUpdating=!1})}},template:'<div class="modal-card modal-card-large"> <header class="modal-card-head"> <p class="modal-card-title" v-if="values.addon_title">{{values.addon_title}}</p> <p class="modal-card-title" v-else>{{\'Загрузка модуля\'|gettext}}</p> <button class="modal-close is-large" @click="$parent.close()"></button> </header> <ul class="nav nav-tabs has-text-left"> <li :class="{active: currentTab== \'description\'}"><a @click="currentTab = \'description\'">{{\'Описание\'|gettext}}</a></li> <li :class="{active: currentTab== \'options\'}" v-if="values.is_installed || isInstalling"><a @click="currentTab = \'options\'">{{\'Настройки\'|gettext}}</a></li> <li v-for="(t, k) in tabs" :class="{active: currentTab== k}" v-if="values.is_installed || isInstalling"><a @click="currentTab = k">{{t}}</a></li> </ul> <component v-bind:is="currentAddon" ref=\'model\' :values="values" :variants="variants" :is-installing="isInstalling" :is-allow-save.sync="isAllowSave" :is-step="isStep" :addon_id="addon_id" :current-tab="currentTab" v-if="currentAddon"> <template slot="allow"> <div v-if="!isAllow" class=\'message is-danger\'> <div class="message-body">{{allowText}} <a @click="$form.open(\'vue-index-pricing-form\')" class=\'is-pulled-right\'>{{\'Подробнее\'|gettext}} <i class="fa fa-angle-right has-ml-1"></i></a></div> </div> </template> </component> <section class="modal-card-body" v-if="!currentAddon"></section> <footer class="modal-card-foot level" v-if="currentAddon"> <div class="level-left" v-if="values.is_installed"> <vue-component-action-button @action="onAction" :title="\'Действие\'|gettext"> <template slot="actions"> <b-dropdown-item value="off" v-if="values.is_active"><i class="fa fa-toggle-off has-mr-1"></i>{{\'Выключить\'|gettext}}</b-dropdown-item> <b-dropdown-item value="on" v-else><i class="fa fa-toggle-on has-mr-1"></i>{{\'Включить\'|gettext}}</b-dropdown-item> <hr class="dropdown-divider" aria-role="menuitem"> <b-dropdown-item value="delete" class="has-text-danger"><i class="fa fa-trash-alt has-mr-1"></i>{{\'Удалить\'|gettext}}</b-dropdown-item> </template> </vue-component-action-button> </div> <div class="level-left" v-else> <button class="button is-dark is-hidden-tablet" type="button" @click="$parent.close()">{{\'Отмена\'|gettext}}</button> </div> <div class="level-right"> <button class="button is-primary" v-if="values.is_installed" :class="{\'is-loading\': isUpdating}" @click="onsave" :disabled="!isAllow">{{\'Сохранить\'|gettext}}</button> <button class="button is-primary" v-if="!values.is_installed && isInstalling" :class="{\'is-loading\': isUpdating}" :disabled="!isAllow" @click="onsave">{{buttonTitle}}</button> <button class="button is-primary" v-if="!values.is_installed && !isInstalling" :class="{\'is-loading\': isUpdating}" @click="install(false)" :disabled="!isAllow">{{\'Установить\'|gettext}}</button> </div> </footer> <footer class="modal-card-foot" v-if="!currentAddon"> <button class="button is-dark" type="button" @click="$parent.close()">{{\'Закрыть\'|gettext}}</button> </footer> <b-loading :is-full-page="false" :active.sync="isFetching"></b-loading> </div>'}),window.$app.defineComponent("addons","vue-addons-list",{data:function(){return{isFetching:!1,variants:{tariff:[],target:[]},variantsLoaded:!1,fields:[],filter:{query:"",tariff:"",target:""}}},props:["type","page_id"],watch:{type:function(){this.filter.query="",this.fetchData(!0)}},computed:{menu:function(){var i=this,e=[{name:"addons",params:{type:"all"},meta:{title:this.$gettext("Все"),is_category:!1}},{name:"addons",params:{type:"active"},meta:{title:this.$gettext("Активные"),is_category:!1}}];return _.each(this.variants.categories,function(t){e.push({name:"addons",params:{type:t.filename},meta:{title:i.$gettext(t.category),is_category:!0,icon:t.icon}})}),e}},created:function(){this.fetchData(!0),this.$io.on("events:addons.list:refresh",this.fetchData)},destroyed:function(){this.$io.off("events:addons.list:refresh",this.fetchData)},methods:{currentMenuCheck:function(){return!1},statusTitle:function(t){return t.is_active?this.$gettext("Вкл"):this.$gettext("Выкл")},fetchData:function(t){var i=this;this.isFetching=t,this.$api.get(this.variantsLoaded?"addons/list":["addons/list","addons/info"],{filter:this.filter,type:this.type}).then(function(t){i.fields=_.map(t.response.addons.list.fields,function(t){return t.style="background-color:#"+t.cover_background+";background-image:url(/s/i/addons/covers/"+t.addon_id+".png?"+t.cover_version+")",t}),i.variantsLoaded||(i.variants=t.response.addons.info.variants,i.variantsLoaded=!0),i.isFetching=!1}).catch(function(t){throw i.fields=[],i.isFetching=!1,t})},checkPath:function(t){var i=t.path.split("/");return-1!=window.location.pathname.indexOf(i[1])},onFilter:_.debounce(function(){this.fetchData(!0)},500),openForm:function(t){this.$modal("vue-addons-form",{addon_id:t},this)}},template:'<div> <vue-component-submenu :menu="menu" :page_id="page_id" :active_function="currentMenuCheck" class="is-hidden-tablet"/> <div class="container has-mt-4 has-mb-4"> <div class="row"> <div class="col-sm-3 is-hidden-mobile" :style="{opacity: filter.query?.3:1}"> <div class="sidebar-menu"> <router-link :to="{name: \'addons\', params:{type: \'all\'}}"><span><i class="fa fa-bars has-mr-2 has-text-grey"></i>{{\'Все\'|gettext}}</span></router-link> <router-link :to="{name: \'addons\', params:{type: \'active\'}}"><span><i class="fa fa-check has-mr-2 has-text-grey"></i>{{\'Активные\'|gettext}}</span></router-link> <hr> <router-link :to="c" v-for="c in menu" v-if="c.meta.is_category"><span><i :class="c.meta.icon" class="has-mr-2 has-text-grey"></i>{{c.meta.title|gettext}}</span></router-link> </div> </div> <div class="col-xs-12 col-sm-9"> <div class="has-pb-3"> <h1 class="has-text-instagram is-hidden-mobile" style="line-height: 1.2">{{\'Каждый бизнес уникален\'|gettext}}</h1> <h3 class="has-mb-4 has-text-grey is-hidden-mobile">{{\'Найдите модуль, который подходит именно вам\'|gettext}}</h3> <div class="has-grey-input has-mb-2"> <b-input type="text" class="input" v-model="filter.query" :placeholder="\'Поиск\'|gettext" icon="search" @input="onFilter"> </div> </div> <div style="position: relative"> <b-loading :is-full-page="false" :active.sync="isFetching"></b-loading> <div class="row" v-if="fields.length"> <div class="col-sm-6 col-md-4" v-for="(f, i) in fields"> <a class="addon-card" @click="openForm(f.addon_id)"> <div class="addon-card-cover" :style="f.style"> <div v-if="f.tariff == \'pro\' && !$auth.isAllowTariff(f.tariff)" class="tag is-pro" v-tippy :content="\'Этот модуль доступен на PRO-тарифе\'|gettext">pro</div> <div v-if="f.tariff == \'business\' && !$auth.isAllowTariff(f.tariff)" class="tag is-business" v-tippy :content="\'Этот модуль доступен на BUSINESS-тарифе\'|gettext">biz</div> </div> <div class="addon-card-body"> <div class="addon-card-title"><div :class="{\'addon-card-on\': f.is_active, \'addon-card-off\': !f.is_active}" v-tippy :content="statusTitle(f)" v-if="f.is_active !== null"></div> {{f.addon_title}}</div> <div class="addon-card-snippet">{{f.addon_snippet}}</div> </div> </a> </div> </div> <div class="row" v-else> <div class="col-xs-12 has-text-centered" v-if="variantsLoaded"> <i class="fal fa-search fa-5x has-text-grey-light" v-if="filter.query"></i> <h3 v-if="filter.query">{{\'Поиск\'|gettext}}</h3> <div class="has-mb-2">{{\'Не найдено ни одного модуля\'|gettext}}</div> </div> </div> </div> </div> </div> </div> </div>'}),window.$app.defineModule("addons",[]);
